[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Single-cell RNAseq analysis with R/Bioconductor",
    "section": "",
    "text": "Welcome\nThis is the landing page for the “Single-cell RNA-seq analysis with R/Bioconductor” workshop, ed. 2025.\nAuthors: Jacques Serizay [aut, cre], Orr Ashenberg [aut, cre], Fabricio Almeida-Silva [aut, cre]Version: 1.0.0Modified: 2025-11-13Compiled: 2025-11-15Environment: R Under development (unstable) (2025-03-14 r87973), Bioconductor 3.22License: MIT + file LICENSECopyright: J. Serizay, O. Ashenberg & F. Almeida-Silva",
    "crumbs": [
      "Welcome"
    ]
  },
  {
    "objectID": "index.html#program",
    "href": "index.html#program",
    "title": "Single-cell RNAseq analysis with R/Bioconductor",
    "section": "Program",
    "text": "Program\n\n\nDay\nTime\nSession\nInstructor\n\n\n\nDay 1\n14:00 - 15:00\nLecture 1: Introduction to scRNAseq analysis\nJacques\n\n\n\n15:10 - 16:10\nLecture 2: From sequencing reads to expression matrices\nJacques\n\n\n\n16:10 - 17:10\nBreak\n\n\n\n\n17:10 - 18:30\nLab 1: Familiarizing with AWS instance\nJacques\n\n\n\n18:40 - 20:00\nLab 2: From .bcl to count matrix\nFabricio\n\n\nDay 2\n14:00 - 15:00\nLecture 3: Quality control for scRNAseq data\nJacques\n\n\n\n15:10 - 16:30\nLab 3: Introduction to R/Bioconductor\nFabricio\n\n\n\n16:30 - 17:30\nBreak\n\n\n\n\n17:30 - 19:00\nLab 4: scRNAseq data wrangling\nFabricio\n\n\n\n19:10 - 20:00\nFlash talks\nAll\n\n\nDay 3\n14:00 - 15:30\nLecture 4: Identifying cell populations\nJacques\n\n\n\n15:40 - 17:00\nLab 5: Dimension reduction, clustering, and annotations\nFabricio\n\n\n\n17:00 - 18:00\nBreak\n\n\n\n\n18:00 - 19:00\nLecture 5: Data integration and batch effect correction\nJacques\n\n\n\n19:10 - 20:00\nLab 6: Batch correction\nJacques\n\n\nDay 4\n14:00 - 15:00\nLecture 6: Advances in single-cell genomics - The epigenome\nJacques\n\n\n\n15:10 - 16:20\nLab 7: scATACseq analysis workflow\nJacques\n\n\n\n16:20 - 17:20\nBreak\n\n\n\n\n17:20 - 18:20\nLecture 7: Trajectories and pseudotimes\nJacques\n\n\n\n18:30 - 20:00\nLab 8: Pseudotime analyses\nFabricio\n\n\nDay 5\n14:00 - 18:00\nGroup Project: Project work\nJacques\n\n\n\n18:00 - 20:00\nWrap-Up: Finalize Projects and Discussion\n\n\n\n\nMore details about the program can be found here. All the times are in Berlin time (CET).",
    "crumbs": [
      "Welcome"
    ]
  },
  {
    "objectID": "index.html#what",
    "href": "index.html#what",
    "title": "Single-cell RNAseq analysis with R/Bioconductor",
    "section": "What",
    "text": "What\nThis course will introduce biologists and bioinformaticians to the field of single-cell RNA sequencing. We will cover a range of software and analysis workflows that extend over the spectrum from the best practices in the filtering scRNA-seq data\nto the downstream analysis of cell clusters and temporal ordering. This course will help the attendees gain accurate insights in pre-processing, analysis and interpretation of scRNA-seq data.\nWe will start by introducing general concepts about single-cell RNA-sequencing. From there, we will then continue to describe the main analysis steps to go from raw sequencing data to processed and usable data. We will present classical analysis workflows, their output and the possible paths to investigate downstream of this.\nThroughout the workshop, bash tools and R/Bioconductor packages will be used to analyse datasets and learn new approaches.",
    "crumbs": [
      "Welcome"
    ]
  },
  {
    "objectID": "index.html#when",
    "href": "index.html#when",
    "title": "Single-cell RNAseq analysis with R/Bioconductor",
    "section": "When",
    "text": "When\nFrom November 4 to November 8, 2025.",
    "crumbs": [
      "Welcome"
    ]
  },
  {
    "objectID": "index.html#where",
    "href": "index.html#where",
    "title": "Single-cell RNAseq analysis with R/Bioconductor",
    "section": "Where",
    "text": "Where\nThis course will be held online.",
    "crumbs": [
      "Welcome"
    ]
  },
  {
    "objectID": "index.html#how",
    "href": "index.html#how",
    "title": "Single-cell RNAseq analysis with R/Bioconductor",
    "section": "How",
    "text": "How\nThe course is structured in modules over five days. Each day will include formal lectures covering the key concepts required to understand scRNA-seq analysis. The remainder of each day will consist in practical hands-on sessions focusing on analysis of scRNA-seq data. These sessions will involve a combination of both mirroring exercises with the instructor to demonstrate a skill, as well as applying these skills on your own to complete individual exercises.\nDuring and after each exercise, interpretation of results will be discussed as a group.",
    "crumbs": [
      "Welcome"
    ]
  },
  {
    "objectID": "index.html#who",
    "href": "index.html#who",
    "title": "Single-cell RNAseq analysis with R/Bioconductor",
    "section": "Who",
    "text": "Who\nThe course will be mostly beneficial to those who have, or will shortly have, scRNA-seq data ready to analyse.\nThe material is suitable both for experimentalists who want to learn more about data-analysis as well as computational biologists who want to learn about scRNA-seq methods.\nExamples demonstrated in this course can be applied to any experimental protocol or biological system.\nThe requirements for this course are:\n\nWorking knowledge of Unix / command line interface (managing files, running programs, reading manuals!). Basic bash commands (cd, ls, ...) and CLI usage will not be covered in this course. We advice attendees to not register if they lack fundamental experience in CLI.\nProgramming experience in R (writing a function, basic I/O operations, variable types, using packages). Bioconductor experience is a plus.\nFamiliarity with next-generation sequencing data and its analyses (using alignment and quantification tools for bulk sequencing data)",
    "crumbs": [
      "Welcome"
    ]
  },
  {
    "objectID": "index.html#why",
    "href": "index.html#why",
    "title": "Single-cell RNAseq analysis with R/Bioconductor",
    "section": "Why",
    "text": "Why\nAt the end of this course, you should be able to:\n\nUnderstand the pros/cons of different single-cell RNA-seq methods\nProcess and QC of scRNA-seq data\nNormalize scRNA-seq data\nCorrect for batch effects\nVisualise the data and applying dimensionality reduction\nPerform cell clustering and annotation\nPerform differential gene expression analysis\nInfer cell trajectory and pseudotime, and perform temporal differential expression\n\nThroughout the course, we will also have a focus on reproducible research, documented content and interactive reports.",
    "crumbs": [
      "Welcome"
    ]
  },
  {
    "objectID": "index.html#instructors",
    "href": "index.html#instructors",
    "title": "Single-cell RNAseq analysis with R/Bioconductor",
    "section": "Instructors",
    "text": "Instructors\nJacques Serizay\nOrr Ashenberg\nFabrício Almeida-Silva",
    "crumbs": [
      "Welcome"
    ]
  },
  {
    "objectID": "content/program.html",
    "href": "content/program.html",
    "title": "Program",
    "section": "",
    "text": "Monday - Classes from 14:00 to 20:00 (Paris time)",
    "crumbs": [
      "Program"
    ]
  },
  {
    "objectID": "content/program.html#monday---classes-from-1400-to-2000-paris-time",
    "href": "content/program.html#monday---classes-from-1400-to-2000-paris-time",
    "title": "Program",
    "section": "",
    "text": "Lecture 1 - Introduction to scRNA-Seq analysis [Jacques]\n\nGeneral introduction: cell atlas overviews\nComparison of bulk and single cell RNA-Seq\nOverview of available scRNA-seq technologies (10x) and experimental protocols\n\n\n\nLecture 2 - From sequencing reads to expression matrices [Jacques]\n\nscRNA-Seq processing workflow starting with choice of sequencer (NextSeq, HiSeq, MiSeq) / barcode swapping and bcl files\nOverview of Popular tools and algorithms\nCommon single-cell analyses and interpretation\nSequencing data: alignment and quality control\nIGV: Looking at cool things in alignment like where reads are, mutations, splicing\n\n\n\nLab 1 - Familiarizing yourself with the course AWS instance [Jacques]\n\nUsing RStudio\nLogging in AWS\nShell and Unix commands to navigate directories, create folders, open files\nRaw file formats\nGet data from 10x website, single cell portal, from GEO (fastqs, counts)\n\n\n\nLab 2 - From sequencing reads to expression matrices [Fabricio]\n\nMapping sequencing data with Cellranger\nQuality Control reports (CellRanger, dropEst, fastqc)",
    "crumbs": [
      "Program"
    ]
  },
  {
    "objectID": "content/program.html#tuesday---classes-from-1400-to-2000-paris-time",
    "href": "content/program.html#tuesday---classes-from-1400-to-2000-paris-time",
    "title": "Program",
    "section": "Tuesday - Classes from 14:00 to 20:00 (Paris time)",
    "text": "Tuesday - Classes from 14:00 to 20:00 (Paris time)\n\nLecture 3 - Quality control for scRNA-Seq data [Jacques]\n\nWhat CellRanger does for quality filtering\nNormalisation methods\nDoublets, empty droplets, DropletUtils\nBarcode swapping\nRegression with technical covariates\n\n\n\nLab 3 - Introduction to R/Bioconductor [Fabricio]\n\nInstalling packages with CRAN and Bioconductor\nData types, data manipulation, slicing\nI/O for scRNAseq analysis in R\n\n\n\nLab 4 - scRNA-Seq data wrangling [Fabricio]\n\nData structure\nData filtering\nExploratory data analysis\n\n\n\nFlash talks [Everybody]",
    "crumbs": [
      "Program"
    ]
  },
  {
    "objectID": "content/program.html#wednesday---classes-from-1400-to-2000-paris-time",
    "href": "content/program.html#wednesday---classes-from-1400-to-2000-paris-time",
    "title": "Program",
    "section": "Wednesday - Classes from 14:00 to 20:00 (Paris time)",
    "text": "Wednesday - Classes from 14:00 to 20:00 (Paris time)\n\nLecture 4 - Identifying cell populations [Jacques]\n\nFeature selection\nDimensionality reduction\nGraph-based clustering and other cluster methods\nAssigning cluster identity\nDifferential expression tests\n\n\n\nLab 5 - Identifying Cell Populations: dimensionality reduction, clustering and annotation [Fabricio]\n\nFeature selection\nDimensional reduction\nGraph-based clustering\nMarker gene detection\nCell type annotation\nData visualization\n\n\n\nLecture 5 - Data integration and batch effect correction [Jacques]\n\nBatch correction methods (regress out batch, scaling within batch, Seurat v3, MNN, Liger, Harmony, scvi, scgen)\nEvaluation methods for batch correction (ARI, average silhouette width, kBET…)\n\n\n\nLab 6 - Data integration and batch effect correction [Jacques]\n\nComparison of batch correction methods\nChoosing the optimal batch correction approach",
    "crumbs": [
      "Program"
    ]
  },
  {
    "objectID": "content/program.html#thursday---classes-from-1400-to-2000-paris-time",
    "href": "content/program.html#thursday---classes-from-1400-to-2000-paris-time",
    "title": "Program",
    "section": "Thursday - Classes from 14:00 to 20:00 (Paris time)",
    "text": "Thursday - Classes from 14:00 to 20:00 (Paris time)\n\nLecture 6 - Advances in single-cell genomics: the epigenome [Jacques]\n\n\nLab 7 - Single-cell ATAC-Seq analysis [Jacques]\n\n\nLecture 7 - Trajectories and pseudotimes [Jacques]\n\nTrajectory inference\nPopular tools and packages for trajectory analysis (https://github.com/dynverse/dynmethods#list-of-included-methods)\nPseudotime inference\nRNA velocity\nDifferential expression through pseudotime\n\n\n\nLab 8 - Inferring differentiation trajectories and pseudotime [Fabricio]\n\nInfering trajectory in sperm cell lineage\nOrientating a trajectory with RNA veloctiy\nDE analysis along a trajectory",
    "crumbs": [
      "Program"
    ]
  },
  {
    "objectID": "content/program.html#friday---classes-from-1400-to-2000-paris-time",
    "href": "content/program.html#friday---classes-from-1400-to-2000-paris-time",
    "title": "Program",
    "section": "Friday - Classes from 14:00 to 20:00 (Paris time)",
    "text": "Friday - Classes from 14:00 to 20:00 (Paris time)\nFriday will be divided in two parts:\n\nMorning & afternoon (2 * 1h30): Group projects: analysing scRNA-seq data by yourself, from A to Z\nAfternoon (2h): Group presentations (10’ each group, max 5 slides: what/why/where/when/how, conclusions)\n\nHappy hour time!!",
    "crumbs": [
      "Program"
    ]
  },
  {
    "objectID": "content/Rstudio.html",
    "href": "content/Rstudio.html",
    "title": "RStudio",
    "section": "",
    "text": "Rstudio offers a graphical interface to facilitate the interaction between a user and an underlying programming language (this is sometimes called IDE, or integrated development environment). It can be very useful when a user is not necessarily proficent with command line-based computing. However, such graphical interfaces are not always able to connect to services such as AWS.\nSince most of the preliminary analysis we do is on AWS, we’d like to be able to use Rtudio directly from there. To do that, simply go to the following address:\n\n\nhttp://16.146.61.21:8787\n\n\nDon’t forget, you can run a bash terminal from within RStudio! This may come handy if you want to process some data with cellranger, for example. To do this, simply click on the terminal button next on the bottom left panel. You should now be in your own ${home} directory (~).",
    "crumbs": [
      "RStudio"
    ]
  },
  {
    "objectID": "content/prerequisites.html",
    "href": "content/prerequisites.html",
    "title": "Prerequisites",
    "section": "",
    "text": "Local configuration",
    "crumbs": [
      "Prerequisites"
    ]
  },
  {
    "objectID": "content/prerequisites.html#local-configuration",
    "href": "content/prerequisites.html#local-configuration",
    "title": "Prerequisites",
    "section": "",
    "text": "Ideally (though not strictly required), a configured SSH client (it should be already installed on Linux/Mac machines, PuTTY can be set up for Windows).\nIdeally (though not strictly required), a SSH ftp client (Forklift is excellent for Mac, although not free beyond the trial version; cyberduck can be used for Windows; FileZilla can be used for both Mac, Windows and Linux).\nComputer with high-speed internet access (no specific configuration required - everything will be performed on a remote AWS machine).\nZoom visioconference software",
    "crumbs": [
      "Prerequisites"
    ]
  },
  {
    "objectID": "content/prerequisites.html#remote-configuration",
    "href": "content/prerequisites.html#remote-configuration",
    "title": "Prerequisites",
    "section": "Remote configuration",
    "text": "Remote configuration\nThe AWS machine is running with Ubuntu and has been set up as follows:\n## --- Clean up previous R installs and system libraries\nsudo apt purge r-base* r-recommended r-cran-*\nsudo apt autoremove\nsudo apt update\nsudo apt upgrade\nsudo apt update\n\n## --- Libraries\nsudo apt update\nsudo apt install libc6 libicu60 -y \nsudo apt install -y \\\n    gcc g++ perl python3 python3-pip \\\n    automake make cmake less vim nano fort77 \\\n    wget git curl bzip2 gfortran unzip ftp \\\n    libpng-dev libjpeg-dev \\\n    texlive-latex-base default-jre build-essential \\\n    libbz2-dev liblzma-dev libtool \\\n    libxml2 libxml2-dev zlib1g-dev \\\n    libdb-dev libglu1-mesa-dev zlib1g-dev  \\\n    libncurses5-dev libghc-zlib-dev libncurses-dev \\\n    libpcre3-dev libxml2-dev \\\n    libblas-dev libzmq3-dev libreadline-dev libssl-dev \\\n    libcurl4-openssl-dev libx11-dev libxt-dev \\\n    x11-common libcairo2-dev \\\n    libreadline6-dev libgsl0-dev \\\n    libeigen3-dev libboost-all-dev \\\n    libgtk2.0-dev xvfb xauth xfonts-base \\\n    apt-transport-https libhdf5-serial-dev \\\n    libudunits2-dev libgdal-dev libgeos-dev libproj-dev \\\n    libv8-dev \\\n    libmagick++-dev \\\n    libharfbuzz-dev libfribidi-dev \\\n    fftw3\n\n## --- R base install \nsudo add-apt-repository \"deb https://cloud.r-project.org/bin/linux/ubuntu `lsb_release -cs` -cran40/\"\nsudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9\nsudo apt update\nsudo apt install r-base r-recommended r-base-core\nThe following packages have been installed (along with their many dependencies, of course!):\n## --- Install important R packages for single-cell RNA-seq projects\n# USING `sudo R` TO AVOID PERMISSION ISSUES WHEN INSTALLING PACKAGES GLOBALLY\nR_PATH=`sudo which R`\nR_LIBS=`sudo Rscript -e \".libPaths()[1] |&gt; writeLines()\"`\nsudo ${R_PATH}script -e \"remotes::install_deps('home/ubuntu/Share/scRNAseq_Physalia_2025', repos = BiocManager::repositories(), upgrade = FALSE, lib = '${R_LIBS}')\"\n\n## --- Install other softwares (fastQC, samtools, cellranger and cellranger indexes, ffq)\n\n# fastqc samtools\nsudo apt install fastqc samtools python3.8\n\n# cellranger\ncd /opt/\nsudo wget -O cellranger-8.0.1.tar.gz \"https://cf.10xgenomics.com/releases/cell-exp/cellranger-8.0.1.tar.gz?Expires=1730426816&Key-Pair-Id=APKAI7S6A5RYOXBWRPDA&Signature=RCkLqP02kkVLRceyojFWbQ4eXrjemlvkAfWxSxbkad0ZqAIjtxTlSsc5Tn3x7PLj-mZiwuTjqx4o~bcR9J5fSBHdtkUrSG~MUqLxquMxcCPom3eR2Or9vdqGvk4faMhv1-jrXS8GCOD82zU8ZdhqecdE5tJdXjLHz6flWo7bQt0jqHF3-roktu0uuXHtebw586Cg39xqzMIG8x9SkeTsRGsJAKB7~jL65YKCEPpAl~QndTghDIymv43gHO8MWiQ7QLbF-nsF16uhqUJR7sAsPZSjCkKPW0GZTIpUmie1nv2OnoenOw9O6-Wj4gIBzcWVHkt-qkmPwvnF3nXq~0xUUw__\"\nsudo tar -xzvf cellranger-8.0.1.tar.gz\nsudo ln -s /opt/cellranger-8.0.1/cellranger /usr/local/bin/cellranger\nsudo wget https://cf.10xgenomics.com/supp/cell-exp/refdata-gex-mm10-2020-A.tar.gz\nsudo tar -xzvf refdata-gex-mm10-2020-A.tar.gz\nsudo mv refdata-gex-mm10-2020-A ~/Share/\n\n## Copy Share from local to AWS\n# rsync --progress --recursive --verbose ~/Share/ physalia:\n\n# Make sure write permissions are only for the sudo owner, so that userX cannot modify or erase the Share folder and its contents\nsudo chown -R ubuntu:ubuntu ~/Share/\nsudo chmod -R 755 ~/Share\n\n# ffq\nsudo apt install python3-distutils\nsudo pip install ffq\n\n# seqkit\ncd /opt/\nsudo wget -O seqkit_linux_amd64.tar.gz https://github.com/shenwei356/seqkit/releases/download/v2.4.0/seqkit_linux_amd64.tar.gz\nsudo tar -xzvf seqkit_linux_amd64.tar.gz\nsudo ln -s /opt/seqkit /usr/local/bin/seqkit\n\n# bcl2fastq\nsudo apt install alien\ncd /opt/\nsudo wget http://support.illumina.com/content/dam/illumina-support/documents/downloads/software/bcl2fastq/bcl2fastq2-v2.17.1.14-Linux-x86_64.rpm\nsudo alien bcl2fastq2-v2.17.1.14-Linux-x86_64.rpm\nsudo dpkg -i bcl2fastq2_0v2.17.1.14-2_amd64.deb\n\n## Add basilisk external dir to system-wide Renviron\nsudo echo \"BASILISK_EXTERNAL_DIR=/opt/basilisk_envs\" &gt;&gt; /etc/R/Renviron",
    "crumbs": [
      "Prerequisites"
    ]
  },
  {
    "objectID": "content/day1/Lecture1_introduction.html",
    "href": "content/day1/Lecture1_introduction.html",
    "title": "1  Lecture 1 - Introduction to scRNAseq analysis",
    "section": "",
    "text": "Slides here",
    "crumbs": [
      "Day 1",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Lecture 1 - Introduction to scRNAseq analysis</span>"
    ]
  },
  {
    "objectID": "content/day1/Lecture2_Bcl2matrix.html",
    "href": "content/day1/Lecture2_Bcl2matrix.html",
    "title": "2  Lecture 2 - From sequencing reads to expression matrices",
    "section": "",
    "text": "Slides here",
    "crumbs": [
      "Day 1",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Lecture 2 - From sequencing reads to expression matrices</span>"
    ]
  },
  {
    "objectID": "content/day1/Lab1_Intro.html",
    "href": "content/day1/Lab1_Intro.html",
    "title": "\n3  Lab 1: Familiarizing yourself with the course AWS instance\n",
    "section": "",
    "text": "3.1 Connect to RStudio Server\nMost of single-cell RNA-seq analysis takes place either in python or in R. Here, we focus on how to leverage R to investigate scRNAseq data. RStudio is an IDE (Integrated Development Environment, in other words: a nice graphical interface to run R-related commands).\nFor this workshop, we have installed R and RStudio on AWS. We can directly use RStudio (actually, RStudio-server since it is installed on an AWS remote server). Simply open a browser and copy-paste the following address:\nR\n\nwriteLines(\"http://{{&lt; meta IP &gt;}}:8787\")\nAn RStudio log in page will appear; to log in, use your user ID for both ID and password.\nNotice how when you log in Rstudio, there are multiple panels. Familiarize yourself with the different panels.\nThe interactive R console is generally found in the bottom left corner of RStudio(though it may be in another corner sometimes). All the rest (history panel, environment panel, directory explorer panel, editor panel) are extra features provided by RStudio.",
    "crumbs": [
      "Day 1",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Lab 1: Familiarizing yourself with the course AWS instance</span>"
    ]
  },
  {
    "objectID": "content/day1/Lab1_Intro.html#connect-to-rstudio-server",
    "href": "content/day1/Lab1_Intro.html#connect-to-rstudio-server",
    "title": "\n3  Lab 1: Familiarizing yourself with the course AWS instance\n",
    "section": "",
    "text": "Some useful commands in R:\n\n\n\nWithin the R console, you can safely use R-dedicated commands. Do you know the most common ones? The semantics are a different from the terminal commands you may be used to…\n\n\n\nR\n\ngetwd() # equivalent of `pwd` in terminal\ndir.create('~/data/') # equivalent of `mkdir ~/data/` in terminal\nsetwd(\"~/data/\") # equivalent of `cd ~/data/` in terminal\nlist.files(\"~/data/\") # equivalent of `ls` in terminal\ndownload.file(\"...\") # equivalent of `wget ...` in terminal",
    "crumbs": [
      "Day 1",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Lab 1: Familiarizing yourself with the course AWS instance</span>"
    ]
  },
  {
    "objectID": "content/day1/Lab1_Intro.html#use-a-aws-terminal-within-rstudio",
    "href": "content/day1/Lab1_Intro.html#use-a-aws-terminal-within-rstudio",
    "title": "\n3  Lab 1: Familiarizing yourself with the course AWS instance\n",
    "section": "\n3.2 Use a AWS terminal within RStudio",
    "text": "3.2 Use a AWS terminal within RStudio\nA general issue with bioinformatic analyses stems from the fact that nobody works in the same environment:\n\nAre you working on Mac? Linux? Windows?\nDo you have a lot of computational power? Perhaps a GPU card?\nAre you connected to the Internet? With a fast connection? Are you working behind a proxy?\n\nTo ensure that we are all working in the same environment, we rely on AWS (Amazon Web Services) EC2 (Elastic Cloud 2) instances. EC2 instances are “virtual” computers to which you can connect remotely, from a local computer.\nThe instance is common for everybody. We are thus all sharing the same “computer”; this means:\n\nShared resources\nSame access to shared files\nSame access to system-wide softwares and conda environments\n\nThe easiest way for us to launch bash commands from a terminal in AWS is to do it through RStudio: You can open up a terminal directly from within RStudio as follow: go to Tools &gt; Terminal &gt; New terminal. This should open up a new tab in the bottom left corner (next to the R console).\n\n\n\n\n\n\nR console versus terminal:\n\n\n\nFrom here onwards, be sure you completely understand the difference between “R console” and “terminal (or shell)”. They are entirely different things, and can be both accessed within RStudio. It is crucial you understand the difference between the two to not get confused for the rest of the course.",
    "crumbs": [
      "Day 1",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Lab 1: Familiarizing yourself with the course AWS instance</span>"
    ]
  },
  {
    "objectID": "content/day1/Lab1_Intro.html#basic-terminal-commands",
    "href": "content/day1/Lab1_Intro.html#basic-terminal-commands",
    "title": "\n3  Lab 1: Familiarizing yourself with the course AWS instance\n",
    "section": "\n3.3 Basic terminal commands",
    "text": "3.3 Basic terminal commands\nThe same bash commands are available in AWS terminal, regardless of whether you access the terminal from RStudio or through ssh.\nOne can list files, download files, check help pages, …, just like in R.\n\nCheck the your present directory\n\n\n\n\nbash\n\npwd\n\n\n\nCheck history\n\n\n\n\nbash\n\nhistory\n\n\n\nput history into a history.txt file\n\n\n\n\nbash\n\nhistory &gt; history.txt\n\n\n\nmake a new folder called data\n\n\n\n\nbash\n\nmkdir data\n\n\n\nGo to the new data directory\n\n\n\n\nbash\n\ncd data\n\n\n\nmove history.txt file into data directory\n\n\n\n\nbash\n\nmv ../history.txt ./\n\n\n\ncheck manual page of wget command (hit q to exit)\n\n\n\n\nbash\n\nman wget\n\n\n\ncheck specific help for cellranger command and subcommands\n\n\n\n\nbash\n\ncellranger --help\ncellranger count --help\n\n\n\nredirect wget help output into a file called cellranger-help.txt\n\n\n\n\n\nbash\n\ncellranger count --help &gt; cellranger-help.txt\n\n\n\nDownload a file from Internet with wget\n\n\n\n\n\nbash\n\nwget https://cf.10xgenomics.com/supp/cell-exp/cellranger-tiny-bcl-1.2.0.tar.gz\n\n\n\nList all files in a folder\n\n\n\n\nbash\n\nls -l ~/Share/\n\n\n\n\n\n\n\n\nTip\n\n\n\nDownload the git repository for this course from GitHub:\n\n\n\nbash\n\ngit clone https://github.com/js2264/scRNAseq_Physalia_2025.git\n\n\nThis downloads the repository for this course to your home folder on the AWS machine.\nTo get it on your local computer (to save the lectures and exercises), go to the GitHub repo page, click on the green Code button, then Download ZIP. Beware, the download may take a significant time based on your internet connection (several hundreds MB).",
    "crumbs": [
      "Day 1",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Lab 1: Familiarizing yourself with the course AWS instance</span>"
    ]
  },
  {
    "objectID": "content/day1/Lab1_Intro.html#single-cell-rna-seq-datasets",
    "href": "content/day1/Lab1_Intro.html#single-cell-rna-seq-datasets",
    "title": "\n3  Lab 1: Familiarizing yourself with the course AWS instance\n",
    "section": "\n3.4 Single-cell RNA-seq datasets",
    "text": "3.4 Single-cell RNA-seq datasets\n\n“This is a course about single-cell RNA-seq analysis, after all, so where is my data?”\n\nOk, “your” data is (most likely) yet to be sequenced! Or maybe you’re interested in digging already existing databases! I mean, who isn’t interested in this mind-blowing achievement from 10X Genomics??\nHuman Cell Atlas is probably a good place to start digging, if you are interested in mammal-related studies. For instance, let’s say I am interested in epididymis differentiation. Boom: here is an entry from the HCA focusing on epididymis: link to HCA data portal.\n\n3.4.1 Raw fastq reads from GEO\nHere is the link to the actual paper studying epididymis:An atlas of human proximal epididymis reveals cell-specific functions and distinct roles for CFTR.\n\n\n\n\n\n\nQuestion\n\n\n\nFind and check out the corresponding GEO entries for this study. What type of sequencing data is available?\n\n\n\n\n\n\nTip\n\n\n\nHere is the link to the GEO page: link.\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nCan you find links to download the raw data from this paper?\n\n\nThere are several ways to find this information, e.g. ffq command line tool, or using the web-based sra-explorer page (here). You generally will need the GEO corresponding ID or SRA project ID (e.g. SRPxxxxxx…).\n\n\n\n\n\n\nQuestion\n\n\n\nTry to install the ffq tool from the Patcher lab.\n\n\n\n\n\n\nInstalling conda packages\n\n\n\nconda-based environments allow easy installs of packages such as ffq. Your (base) conda environment should be active by default, and you will only have to type:\n\n\n\nbash\n\npip install ffq\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nCheck ffq help and try fetching metadata for the GSE ID GSE148963.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nbash\n\nffq --help\nffq -t GSE GSE148963 &gt; GSE148963_search.txt\nhead -n 30 GSE148963_search.txt\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nCan you find the links to raw data associated with the GSE148963 GEO ID?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nYou can use a grep command: grep returns the lines which match a given pattern (e.g. a link…)!\n\n\n\nbash\n\ngrep 'ftp://' GSE148963_search.txt\n\n\nAnd with a bit of sed magick…\n\n\n\nbash\n\ngrep 'ftp://' GSE148963_search.txt | sed 's,.*ftp:,ftp:,' | sed 's,\".*,,' | grep \".fastq\" &gt; GSE148963_fastqlist.txt\n## `ffq` looks through GEO repository to fing metadata associated with the `GSE148963` entry (including downloading links)\n## grep 'ftp://' recovers the text lines that contain downloading links\n## the `sed` commands clean up the text lines\n## the `wget` command downloads locally the links listed in the generated file (GSE148963_fastqlist.txt)\n# wget -i GSE148963_fastqlist.txt ## Do not run, it would take too long...\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nA subset of the reads has been downloaded and put in the ~/Share/ folder. Have a look at it!\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nbash\n\nzcat ~/Share/SRR11575369_1.fq.gz | head -n 12\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nTry and understand the structure of the fq.gz file. What is the meaning of each line?\nHow many reads are there in the fq.gz file? And how long are they? Can you get a summary of what is in this file? All of these questions can be quickly answered using the seqkit tool:\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nbash\n\nseqkit --help\nseqkit stats --help\nseqkit stat ~/Share/SRR11575369_1.fq.gz\n\n\n\n\n\n\n\n\n3.4.2 Processed count matrices\nMany times, researchers will provide a filtered count matrix when they publish scRNAseq experiments (along with mandatory raw fastq data, of course). It’s way lighter than fastq reads, and you can go ahead with downstream analyses a lot quicker. So how do you get these matrices? Human Cell Atlas Consortium provides many processed datasets. For instance, in our case, the A single cell atlas of the human proximal epididymis reveals cell-type specific functions and distinct roles for CFTR (Leir et al, 2020) study is available at the following link.\nGEO also provides access to both raw and processed files.\n\n\n\n\n\n\nQuestion\n\n\n\nFind GEO-hosted processed files for the Leir et al study.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\nCheck the Geo Dataset search page.\nSearch for Leir 2020 CFTF. You should find the following entry.\nScrolling down to the bottom of the page, there is a box labelled “Supplementary data”. By clicking on “(custom)”, a list of extra supplementary files will appear.\n\n\n\nDownload and check the content of the count matrix, the genes and the barcodes files.\nWhat type of information does each file contain? How is it formatted? is it easily imported in R?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\n\n\nHow many cells were sequenced? How many genes were counted?\nIs it easy to interpret the count matrix? Why is it in such format?\nComment on the file sizes between processed count matrix files and raw reads.",
    "crumbs": [
      "Day 1",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Lab 1: Familiarizing yourself with the course AWS instance</span>"
    ]
  },
  {
    "objectID": "content/day1/Lab1_Intro.html#bonus",
    "href": "content/day1/Lab1_Intro.html#bonus",
    "title": "\n3  Lab 1: Familiarizing yourself with the course AWS instance\n",
    "section": "\n3.5 Bonus",
    "text": "3.5 Bonus\nFor those of you who are already familiar with the basics, you can fast-forward through this lab and start working on scRNAseq data directly. The script in bin/prepare_Ernst.R is a template to process a publicly available scRNAseq dataset. You can start exploring it to see if you understsand the different chunks of code and their importance. All the content from this template will eventually be covered in the next labs.",
    "crumbs": [
      "Day 1",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Lab 1: Familiarizing yourself with the course AWS instance</span>"
    ]
  },
  {
    "objectID": "content/day1/Lab2_processingreads.html",
    "href": "content/day1/Lab2_processingreads.html",
    "title": "\n4  Lab 2: From .bcl to count matrix\n",
    "section": "",
    "text": "4.1 Demultiplexing sequencing data with cellranger mkfastq\nNavigate to your terminal in RStudio on AWS.\nGo to the cellranger mkfastq page and read the Overview.\nFor this workshop, we are going to look at a toy dataset provided by 10x Genomics. The dataset is cellranger-tiny-bcl-1.2.0, provided in the ~/Share/data_wrangling/ folder. With the cellranger-tiny-bcl-1.2.0 dataset, we have a samplesheet file cellranger-tiny-bcl-simple-1.2.0.csv that contains the sample information.\nNow we can demultiplex our bcl files by running the following command in the terminal. To do that, we will use the cellranger mkfastq command.\nbash\n\ncellranger mkfastq --help\n/opt/cellranger/bin\n\ncellranger mkfastq (cellranger-5.0.1)\nCopyright (c) 2020 10x Genomics, Inc.  All rights reserved.\n-------------------------------------------------------------------------------\n\nRun Illumina demultiplexer on sample sheets that contain 10x-specific sample \nindex sets, and generate 10x-specific quality metrics after the demultiplex.  \nAny bcl2fastq argument will work (except a few that are set by the pipeline \nto ensure proper trimming and sample indexing). The FASTQ output generated \nwill be the same as when running bcl2fastq directly.\n\nThese bcl2fastq arguments are overridden by this pipeline:\n    --fastq-cluster-count\n    --minimum-trimmed-read-length\n    --mask-short-adapter-reads\n\nUsage:\n    cellranger mkfastq --run=PATH [options]\n    cellranger mkfastq -h | --help | --version\n\nRequired:\n    --run=PATH          Path of Illumina BCL run folder.\n\nOptional:\n# Sample Sheet\n    --id=NAME           Name of the folder created by mkfastq. If not supplied,\n                            will default to the name of the flowcell referred to\n                            by the --run argument.\n    --csv=PATH\n    --samplesheet=PATH\n    --sample-sheet=PATH\n                        Path to the sample sheet. The sample sheet can either be\n                            a simple CSV with lane, sample and index columns, or\n                            an Illumina Experiment Manager-compatible sample\n                            sheet. Sample sheet indexes can refer to 10x sample\n                            index set names (e.g., SI-GA-A12).\n    --simple-csv=PATH   Deprecated. Same meaning as --csv.\n    --qc                Deprecated: will be removed in a future version.\n                        Calculate both sequencing and 10x-specific metrics,\n                            including per-sample barcode matching rate. Will not\n                            be performed unless this flag is specified.\n    --force-single-index\n                        If 10x-supplied i7/i5 paired indices are specified,\n                            but the flowcell was run with only one sample\n                            index, allow the demultiplex to proceed using\n                                the i7 half of the sample index pair.\n    --filter-single-index\n                        Only demultiplex samples identified\n                            by an i7-only sample index, ignoring dual-indexed\n                            samples.  Dual-indexed samples will not be\n                            demultiplexed.\n    --filter-dual-index\n                        Only demultiplex samples identified\n                          by i7/i5 dual-indices (e.g., SI-TT-A6), ignoring single-\n                          index samples.  Single-index samples will not be \n                          demultiplexed.\n    --rc-i2-override=BOOL\n                        Indicates if the bases in the I2 read are emitted as \n                          reverse complement by the sequencing workflow.\n                          Set to 'true' for Workflow A / NovaSeq Reagent Kit v1.5\n                          or greater. Set to 'false' for Wokflow B / older NovaSeq\n                          Reagent Kits. NOTE: this parameter is autodetected based \n                          and should only be passed in special circumstances.\n    \n# bcl2fastq Pass-Through\n    --lanes=NUMS        Comma-delimited series of lanes to demultiplex. Shortcut\n                            for the --tiles argument.\n    --use-bases-mask=MASK\n                        Same as bcl2fastq; override the read lengths as\n                            specified in RunInfo.xml. See Illumina bcl2fastq\n                            documentation for more information.\n    --delete-undetermined\n                        Delete the Undetermined FASTQ files left by bcl2fastq\n                            Useful if your sample sheet is only expected to\n                            match a subset of the flowcell.\n    --output-dir=PATH   Same as in bcl2fastq. Folder where FASTQs, reports and\n                            stats will be generated.\n    --project=NAME      Custom project name, to override the samplesheet or to\n                            use in conjunction with the --csv argument.\n\n# Martian Runtime\n    --jobmode=MODE      Job manager to use. Valid options: local (default), sge,\n                            lsf, or a .template file\n    --localcores=NUM    Set max cores the pipeline may request at one time. Only\n                            applies to local jobs.\n    --localmem=NUM      Set max GB the pipeline may request at one time. Only\n                            applies to local jobs.\n    --localvmem=NUM     Set max virtual address space in GB for the pipeline.\n                            Only applies to local jobs.\n    --mempercore=NUM    Reserve enough threads for each job to ensure enough\n                        memory will be available, assuming each core on your\n                        cluster has at least this much memory available. Only\n                            applies in cluster jobmodes.\n    --maxjobs=NUM       Set max jobs submitted to cluster at one time. Only\n                            applies in cluster jobmodes.\n    --jobinterval=NUM   Set delay between submitting jobs to cluster, in ms.\n                            Only applies in cluster jobmodes.\n    --overrides=PATH    The path to a JSON file that specifies stage-level\n                            overrides for cores and memory. Finer-grained\n                            than --localcores, --mempercore and --localmem.\n                            Consult the 10x support website for an example\n                            override file.\n\n    --uiport=PORT       Serve web UI at http://localhost:PORT\n    --disable-ui        Do not serve the UI.\n    --noexit            Keep web UI running after pipestance completes or fails.\n    --nopreflight       Skip preflight checks.\n\n    -h --help           Show this message.\n    --version           Show version.\n\nIf you demultiplexed with 'cellranger mkfastq' or directly with Illumina\nbcl2fastq, then set --fastqs to the project folder containing FASTQ files. In\naddition, set --sample to the name prefixed to the FASTQ files comprising\nyour sample. For example, if your FASTQs are named:\n    subject1_S1_L001_R1_001.fastq.gz\nthen set --sample=subject1\nThe output folders can be viewed by running the ls command:\nbash\n\nls -l ~/Share/data_wrangling/tiny-bcl/outs/fastq_path/H35KCBCXY/test_sample\n\n\ntotal 48156\n-rw-r--r-- 1 rsg rsg  3930346 Oct 29  2024 test_sample_S1_L001_I1_001.fastq.gz\n-rw-r--r-- 1 rsg rsg 11093755 Oct 29  2024 test_sample_S1_L001_R1_001.fastq.gz\n-rw-r--r-- 1 rsg rsg 34273874 Oct 29  2024 test_sample_S1_L001_R2_001.fastq.gz\nOpen the html file tiny-bcl/outs/fastq_path/Reports/html/index.html by navigating to the file in RStudio, using the Files Tab. When you click on the file, select the option to View in Web Browser. Take some time to explore the demultiplexed outputs.",
    "crumbs": [
      "Day 1",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Lab 2: From .bcl to count matrix</span>"
    ]
  },
  {
    "objectID": "content/day1/Lab2_processingreads.html#demultiplexing-sequencing-data-with-cellranger-mkfastq",
    "href": "content/day1/Lab2_processingreads.html#demultiplexing-sequencing-data-with-cellranger-mkfastq",
    "title": "\n4  Lab 2: From .bcl to count matrix\n",
    "section": "",
    "text": "Question\n\n\n\nGo to the Terminal tab in your RStudio and take a look at the 10x samplesheet .csv file\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nbash\n\ncat ~/Share/data_wrangling/cellranger-tiny-bcl-simple-1.2.0.csv\n\n\nLane,Sample,Index\n1,test_sample,SI-GA-E3\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nNext, explore the contents of the sequencing directory:\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nbash\n\nls -l ~/Share/data_wrangling/cellranger-tiny-bcl-1.2.0\n\n\ntotal 28\ndrwxr-xr-x 2 rsg rsg 4096 Oct 29  2024 Config\ndrwxr-xr-x 3 rsg rsg 4096 Oct 29  2024 Data\ndrwxr-xr-x 2 rsg rsg 4096 Oct 29  2024 InterOp\n-rw-r--r-- 1 rsg rsg   48 Oct 29  2024 RTAComplete.txt\n-rw-r--r-- 1 rsg rsg  673 Oct 29  2024 RunInfo.xml\n-rw-r--r-- 1 rsg rsg 5366 Oct 29  2024 runParameters.xml\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nWhat is the purpose of --id, --run, and --csv arguments ?\nChoose these arguments wisely and execute the command to demultiplex the sequencing data.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nbash\n\ncellranger mkfastq --id tiny-bcl --run ~/Share/data_wrangling/cellranger-tiny-bcl-1.2.0 --csv ~/Share/data_wrangling/cellranger-tiny-bcl-simple-1.2.0.csv\n\n\n\n/opt/gensoft/exe/cellranger/7.1.0/libexec/bin\ncellranger mkfastq (cellranger-7.1.0)\nCopyright (c) 2021 10x Genomics, Inc.  All rights reserved.\n-------------------------------------------------------------------------------\n\nMartian Runtime - v4.0.10\n2025-11-13 18:54:39 [runtime] Reattaching in local mode.\nServing UI at http://maestro-submit:33167?auth=UT6bG4dNCAFoyY5KH9jUeLvbk0g-HjGeeSnZgLYGHok\n\n2025-11-13 18:54:39 [runtime] (reset-partial)   ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.MAKE_FASTQS_PREFLIGHT_LOCAL.fork0.chnk0\n2025-11-13 18:54:39 [runtime] Found orphaned local stage: ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.MAKE_FASTQS_PREFLIGHT_LOCAL\nChecking run folder...\nChecking RunInfo.xml...\nChecking system environment...\nEmitting run information...\nChecking read specification...\nChecking samplesheet specs...\n2025-11-13 18:54:42 [runtime] (ready)           ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.PREPARE_SAMPLESHEET\n2025-11-13 18:54:42 [runtime] (run:local)       ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.PREPARE_SAMPLESHEET.fork0.chnk0.main\n2025-11-13 18:54:44 [runtime] (chunks_complete) ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.PREPARE_SAMPLESHEET\n2025-11-13 18:54:44 [runtime] (ready)           ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.BCL2FASTQ_WITH_SAMPLESHEET\n2025-11-13 18:54:44 [runtime] (run:local)       ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.BCL2FASTQ_WITH_SAMPLESHEET.fork0.split\n2025-11-13 18:54:45 [runtime] (split_complete)  ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.BCL2FASTQ_WITH_SAMPLESHEET\n2025-11-13 18:54:45 [runtime] (run:local)       ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.BCL2FASTQ_WITH_SAMPLESHEET.fork0.chnk0.main\n2025-11-13 18:54:49 [runtime] (chunks_complete) ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.BCL2FASTQ_WITH_SAMPLESHEET\n2025-11-13 18:54:49 [runtime] (run:local)       ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.BCL2FASTQ_WITH_SAMPLESHEET.fork0.join\n2025-11-13 18:54:50 [runtime] (join_complete)   ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.BCL2FASTQ_WITH_SAMPLESHEET\n2025-11-13 18:54:50 [runtime] (ready)           ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.MERGE_FASTQS_BY_LANE_SAMPLE\n2025-11-13 18:54:50 [runtime] (run:local)       ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.MERGE_FASTQS_BY_LANE_SAMPLE.fork0.split\n2025-11-13 18:54:52 [runtime] (split_complete)  ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.MERGE_FASTQS_BY_LANE_SAMPLE\n2025-11-13 18:54:52 [runtime] (run:local)       ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.MERGE_FASTQS_BY_LANE_SAMPLE.fork0.chnk0.main\n2025-11-13 18:54:54 [runtime] (chunks_complete) ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.MERGE_FASTQS_BY_LANE_SAMPLE\n2025-11-13 18:54:54 [runtime] (run:local)       ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.MERGE_FASTQS_BY_LANE_SAMPLE.fork0.join\n2025-11-13 18:54:56 [runtime] (join_complete)   ID.tiny-bcl.MAKE_FASTQS_CS.MAKE_FASTQS.MERGE_FASTQS_BY_LANE_SAMPLE\n\nOutputs:\n- FASTQ output folder:   /pasteur/appa/homes/jaseriza/tiny-bcl/outs/fastq_path\n- Interop output folder: /pasteur/appa/homes/jaseriza/tiny-bcl/outs/interop_path\n- Input samplesheet:     /pasteur/appa/homes/jaseriza/tiny-bcl/outs/input_samplesheet.csv\n\nWaiting 6 seconds for UI to do final refresh.\nPipestance completed successfully!\n\n2024-10-29 11:43:06 Shutting down.\nSaving pipestance info to \"tiny-bcl/tiny-bcl.mri.tgz\"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nLook at the first reads listed in index read (I1), read 1 (R1), and read (R2) files.\nWhat is the purpose of the index read? What does it contain?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nbash\n\nzcat ~/Share/data_wrangling/tiny-bcl/outs/fastq_path/H35KCBCXY/test_sample/test_sample_S1_L001_I1_001.fastq.gz | head -n 12\n\n\n@D00547:905:H35KCBCXY:1:1101:1284:1973 1:N:0:AGGTATTG\nAGGTATTG\n+\nGGGGGIII\n@D00547:905:H35KCBCXY:1:1101:1729:1981 1:N:0:AGGTATTG\nAGGTATTG\n+\nGAGGGIIG\n@D00547:905:H35KCBCXY:1:1101:2005:1944 1:N:0:AGGTATTG\nAGGTATTG\n+\nAA&lt;G.A.G\n\n\n\n@D00547:905:H35KCBCXY:1:1101:1284:1973 1:N:0:AGGTATTG\nAGGTATTG\n+\nGGGGGIII\n@D00547:905:H35KCBCXY:1:1101:1729:1981 1:N:0:AGGTATTG\nAGGTATTG\n+\nGAGGGIIG\n@D00547:905:H35KCBCXY:1:1101:2005:1944 1:N:0:AGGTATTG\nAGGTATTG\n+\nAA&lt;G.A.G",
    "crumbs": [
      "Day 1",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Lab 2: From .bcl to count matrix</span>"
    ]
  },
  {
    "objectID": "content/day1/Lab2_processingreads.html#generating-gene-count-matrices-with-cellranger-count",
    "href": "content/day1/Lab2_processingreads.html#generating-gene-count-matrices-with-cellranger-count",
    "title": "\n4  Lab 2: From .bcl to count matrix\n",
    "section": "\n4.2 Generating gene count matrices with cellranger count\n",
    "text": "4.2 Generating gene count matrices with cellranger count\n\nGo to the cellranger count algorithm overview and read the section on Alignment (Read Trimming, Genome Alignment, MAPQ adjustment, Transcriptome Alignment, UMI Counting).\nIn bash, the cellranger count command is used to generate gene count matrices from the demultiplexed reads.\n\n\n\nbash\n\ncellranger count --help\n\n\n\ncellranger-count \nCount gene expression (targeted or whole-transcriptome) and/or feature barcode reads from a single sample and GEM well\n\nUSAGE:\n    cellranger count [FLAGS] [OPTIONS] --id &lt;ID&gt; --transcriptome &lt;PATH&gt;\n\nFLAGS:\n        --no-target-umi-filter    Turn off the target UMI filtering subpipeline\n        --no-bam                  Do not generate a bam file\n        --nosecondary             Disable secondary analysis, e.g. clustering. Optional\n        --include-introns         Include intronic reads in count\n        --no-libraries            Proceed with processing using a --feature-ref but no Feature Barcode libraries specified with the 'libraries' flag\n        --dry                     Do not execute the pipeline. Generate a pipeline invocation (.mro) file and stop\n        --disable-ui              Do not serve the web UI\n        --noexit                  Keep web UI running after pipestance completes or fails\n        --nopreflight             Skip preflight checks\n    -h, --help                    Prints help information\n\nOPTIONS:\n        --id &lt;ID&gt;                 A unique run id and output folder name [a-zA-Z0-9_-]+\n        --description &lt;TEXT&gt;      Sample description to embed in output files\n        --transcriptome &lt;PATH&gt;    Path of folder containing 10x-compatible transcriptome reference\n        --fastqs &lt;PATH&gt;...        Path to input FASTQ data\n        --project &lt;TEXT&gt;          Name of the project folder within a mkfastq or bcl2fastq-generated folder to pick FASTQs from\n        --sample &lt;PREFIX&gt;...      Prefix of the filenames of FASTQs to select\n        --lanes &lt;NUMS&gt;...         Only use FASTQs from selected lanes\n        --libraries &lt;CSV&gt;         CSV file declaring input library data sources\n        --feature-ref &lt;CSV&gt;       Feature reference CSV file, declaring Feature Barcode constructs and associated barcodes\n        --target-panel &lt;CSV&gt;      The target panel CSV file declaring the target panel used, if any\n        --expect-cells &lt;NUM&gt;      Expected number of recovered cells\n        --force-cells &lt;NUM&gt;       Force pipeline to use this number of cells, bypassing cell detection\n        --r1-length &lt;NUM&gt;         Hard trim the input Read 1 to this length before analysis\n        --r2-length &lt;NUM&gt;         Hard trim the input Read 2 to this length before analysis\n        --chemistry &lt;CHEM&gt;        Assay configuration. NOTE: by default the assay configuration is detected automatically, which is the recommened mode. You usually will not\n                                  need to specify a chemistry. Options are: 'auto' for autodetection, 'threeprime' for Single Cell 3', 'fiveprime' for  Single Cell 5',\n                                  'SC3Pv1' or 'SC3Pv2' or 'SC3Pv3' for Single Cell 3' v1/v2/v3, 'SC5P-PE' or 'SC5P-R2' for Single Cell 5', paired-end/R2-only, 'SC-FB' for\n                                  Single Cell Antibody-only 3' v2 or 5' [default: auto]\n        --jobmode &lt;MODE&gt;          Job manager to use. Valid options: local (default), sge, lsf, slurm or a .template file. Search for help on \"Cluster Mode\" at\n                                  support.10xgenomics.com for more details on configuring the pipeline to use a compute cluster [default: local]\n        --localcores &lt;NUM&gt;        Set max cores the pipeline may request at one time. Only applies to local jobs\n        --localmem &lt;NUM&gt;          Set max GB the pipeline may request at one time. Only applies to local jobs\n        --localvmem &lt;NUM&gt;         Set max virtual address space in GB for the pipeline. Only applies to local jobs\n        --mempercore &lt;NUM&gt;        Reserve enough threads for each job to ensure enough memory will be available, assuming each core on your cluster has at least this much\n                                  memory available. Only applies in cluster jobmodes\n        --maxjobs &lt;NUM&gt;           Set max jobs submitted to cluster at one time. Only applies in cluster jobmodes\n        --jobinterval &lt;NUM&gt;       Set delay between submitting jobs to cluster, in ms. Only applies in cluster jobmodes\n        --overrides &lt;PATH&gt;        The path to a JSON file that specifies stage-level overrides for cores and memory. Finer-grained than --localcores, --mempercore and\n                                  --localmem. Consult the 10x support website for an example override file\n        --uiport &lt;PORT&gt;           Serve web UI at http://localhost:PORT\n\nNow, we will generate a gene count matrix for the test_sample reads using cellranger count and the transcriptome reference provided in ~/Share/refdata-gex-mm10-2020-A/\n\n\n\n\n\n\nQuestion\n\n\n\nWhat is the purpose of the --id, --transcriptome, --fastqs, --sample, and --create-bam arguments?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nbash\n\ncellranger count --id counts --transcriptome ~/Share/refdata-gex-mm10-2020-A/ --fastqs tiny-bcl/outs/fastq_path/H35KCBCXY/test_sample --sample test_sample --create-bam true\n\n\n\nMartian Runtime - v4.0.10\n2025-11-13 19:17:49 [runtime] Reattaching in local mode.\nServing UI at http://maestro-submit:44641?auth=o3OFtia-5rPZ9nn37zNcvPNwtZ0XLSszXeGPSzNA2Ds\n\n2025-11-13 19:17:49 [runtime] (reset-partial)   ID.counts.SC_RNA_COUNTER_CS.CELLRANGER_PREFLIGHT.fork0.chnk0\n2025-11-13 19:17:49 [runtime] (reset-partial)   ID.counts.SC_RNA_COUNTER_CS.CELLRANGER_PREFLIGHT_LOCAL.fork0.chnk0\n2025-11-13 19:17:49 [runtime] Found orphaned local stage: ID.counts.SC_RNA_COUNTER_CS.CELLRANGER_PREFLIGHT_LOCAL\n2025-11-13 19:17:49 [runtime] Found orphaned local stage: ID.counts.SC_RNA_COUNTER_CS.CELLRANGER_PREFLIGHT\nChecking sample info...\nChecking FASTQ folder...\nChecking reference...\nChecking reference_path (/pasteur/appa/scratch/jaseriza/Share/refdata-gex-mm10-2020-A) on maestro-submit...\nChecking optional arguments...\nmro: v4.0.10\nmrp: v4.0.10\nAnaconda: Python 3.9.7\nnumpy: 1.22.3\nscipy: 1.9.1\npysam: 0.17.0\nh5py: 3.6.0\npandas: 1.3.5\nSTAR: 2.7.2a\nsamtools: samtools 1.12\n2025-11-13 19:17:53 [runtime] (ready)           ID.counts.SC_RNA_COUNTER_CS.WRITE_GENE_INDEX\n2025-11-13 19:17:53 [runtime] (run:local)       ID.counts.SC_RNA_COUNTER_CS.WRITE_GENE_INDEX.fork0.chnk0.main\n2025-11-13 19:17:53 [runtime] (ready)           ID.counts.SC_RNA_COUNTER_CS.SC_MULTI_CORE.MAKE_FULL_CONFIG._MAKE_VDJ_CONFIG\n\n...\n\nOutputs:\n- Run summary HTML:                         /home/rsg/counts/outs/web_summary.html\n- Run summary CSV:                          /home/rsg/counts/outs/metrics_summary.csv\n- BAM:                                      /home/rsg/counts/outs/possorted_genome_bam.bam\n- BAM BAI index:                            /home/rsg/counts/outs/possorted_genome_bam.bam.bai\n- BAM CSI index:                            null\n- Filtered feature-barcode matrices MEX:    /home/rsg/counts/outs/filtered_feature_bc_matrix\n- Filtered feature-barcode matrices HDF5:   /home/rsg/counts/outs/filtered_feature_bc_matrix.h5\n- Unfiltered feature-barcode matrices MEX:  /home/rsg/counts/outs/raw_feature_bc_matrix\n- Unfiltered feature-barcode matrices HDF5: /home/rsg/counts/outs/raw_feature_bc_matrix.h5\n- Secondary analysis output CSV:            /home/rsg/counts/outs/analysis\n- Per-molecule read information:            /home/rsg/counts/outs/molecule_info.h5\n- CRISPR-specific analysis:                 null\n- Antibody aggregate barcodes:              null\n- Loupe Browser file:                       /home/rsg/counts/outs/cloupe.cloupe\n- Feature Reference:                        null\n- Target Panel File:                        null\n- Probe Set File:                           null\n\nWaiting 6 seconds for UI to do final refresh.\nPipestance completed successfully!\n\n2025-11-13 19:19:53 Shutting down.```\n\n:::\n\n:::\n\nWhile the count command is running, read about the [format of the feature-barcode matrices](https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/output/matrices).\n\nOnce the count command is finished running, the pipeline outputs can be viewed with `ls`:\n\n\n\n\n\nbash\n\nls -l ~/Share/data_wrangling/counts/outs\n\n\ntotal 56920\ndrwxr-xr-x 7 rsg rsg     4096 Oct 29  2024 analysis\n-rw-r--r-- 1 rsg rsg  2782024 Oct 29  2024 cloupe.cloupe\ndrwxr-xr-x 2 rsg rsg     4096 Oct 29  2024 filtered_feature_bc_matrix\n-rw-r--r-- 1 rsg rsg   506767 Oct 29  2024 filtered_feature_bc_matrix.h5\n-rw-r--r-- 1 rsg rsg      627 Oct 29  2024 metrics_summary.csv\n-rw-r--r-- 1 rsg rsg  1806311 Oct 29  2024 molecule_info.h5\n-rw-r--r-- 1 rsg rsg 47960294 Oct 29  2024 possorted_genome_bam.bam\n-rw-r--r-- 1 rsg rsg  1744976 Oct 29  2024 possorted_genome_bam.bam.bai\ndrwxr-xr-x 2 rsg rsg     4096 Oct 29  2024 raw_feature_bc_matrix\n-rw-r--r-- 1 rsg rsg   921409 Oct 29  2024 raw_feature_bc_matrix.h5\n-rw-r--r-- 1 rsg rsg  2513806 Oct 29  2024 web_summary.html\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nCan you locate the feature-barcode matrices? What is the difference between the raw_feature_bc_matrix and filtered_feature_bc_matrix data types?\n\n\n\n\n\n\nTip\n\n\n\n\n\n\nbash\n\nls -l ~/Share/data_wrangling/counts/outs/raw_feature_bc_matrix.h5\nls -l ~/Share/data_wrangling/counts/outs/filtered_feature_bc_matrix.h5\n\n\n\n\nHow many cells and genes are stored in each matrix? Comment.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nbash\n\n# Number of genes \nzcat ~/Share/data_wrangling/counts/outs/filtered_feature_bc_matrix/features.tsv.gz | wc -l\nzcat ~/Share/data_wrangling/counts/outs/raw_feature_bc_matrix/features.tsv.gz | wc -l\n\n# Number of cells\nzcat ~/Share/data_wrangling/counts/outs/filtered_feature_bc_matrix/barcodes.tsv.gz | wc -l\nzcat ~/Share/data_wrangling/counts/outs/raw_feature_bc_matrix/barcodes.tsv.gz | wc -l\n\n\n\n\n\nNow open the html file counts/outs/web_summary.html by navigating to the file in RStudio, using the Files Tab. When you click on the file, select the option to View in Web Browser. Take some time to explore the gene expression matrix outputs.",
    "crumbs": [
      "Day 1",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Lab 2: From .bcl to count matrix</span>"
    ]
  },
  {
    "objectID": "content/day2/Lecture3_qualitycontrol.html",
    "href": "content/day2/Lecture3_qualitycontrol.html",
    "title": "5  Lecture 3 - Quality control for scRNA-Seq data",
    "section": "",
    "text": "Slides here",
    "crumbs": [
      "Day 2",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Lecture 3 - Quality control for scRNA-Seq data</span>"
    ]
  },
  {
    "objectID": "content/day2/Lab3_Rbioc.html",
    "href": "content/day2/Lab3_Rbioc.html",
    "title": "\n6  Lab 3: Introduction to R/Bioconductor\n",
    "section": "",
    "text": "6.1 Installing packages in R\nOr, in other words: “how do I install this or that brand new cutting-edge fancy package?”\nR works with packages, available from different sources:\nLet’s start by going over package installation.\nPackage help pages are available at different places, depending on their source. That being said, there is a place I like to go to easily find information related to most packages:\nhttps://rdrr.io/\nFor instance, check out Revelio package help pages.",
    "crumbs": [
      "Day 2",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Lab 3: Introduction to R/Bioconductor</span>"
    ]
  },
  {
    "objectID": "content/day2/Lab3_Rbioc.html#installing-packages-in-r",
    "href": "content/day2/Lab3_Rbioc.html#installing-packages-in-r",
    "title": "\n6  Lab 3: Introduction to R/Bioconductor\n",
    "section": "",
    "text": "“Hey, I’ve heard so many good things about this piece of software, it’s called ‘slingshot’? Heard of it? I really want to try it out on my dataset!!”\n\n\n\n\n\nCRAN, the R developer team and official package provider: CRAN (which can probably win the title of “the worst webpage ever designed that survived until 2023”).\n\nBioconductor, another package provider, with a primary focus on genomic-related packages: Bioconductor.\nOther unofficial sources, such as GitHub.\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nInstall mgcv, HCAData and revelio packages. Each of these three packages is available from a different source:\n\n\nmgcv is a CRAN package\n\nHCAData is a Bioconductor package\n\nrevelio is a GitHub package\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ninstall.packages('mgcv')\n\n\n\nInstalling package into ‘/home/rsg/R/x86_64-pc-linux-gnu-library/4.4’\n(as ‘lib’ is unspecified)\n\ntrying URL 'https://cloud.r-project.org/src/contrib/mgcv_1.9-1.tar.gz'\nContent type 'application/x-gzip' length 1083217 bytes (1.0 MB)\n==================================================\ndownloaded 1.0 MB\n\n* installing *source* package ‘mgcv’ ...\n** package ‘mgcv’ successfully unpacked and MD5 sums checked\n** using staged installation\n** libs\nusing C compiler: ‘gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0’\ngcc -I\"/usr/share/R/include\" -DNDEBUG      -fopenmp -fpic  -g -O2 -fdebug-prefix-map=/build/r-base-4dpK2T/r-base-4.4.1=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2  -c coxph.c -o coxph.o\n\n...\n\ninstalling to /home/rsg/R/x86_64-pc-linux-gnu-library/4.4/00LOCK-mgcv/00new/mgcv/libs\n** R\n** data\n** inst\n** byte-compile and prepare package for lazy loading\n\n** help\n*** installing help indices\n** building package indices\n** testing if installed package can be loaded from temporary location\n** checking absolute paths in shared objects and dynamic libraries\n** testing if installed package can be loaded from final location\n** testing if installed package keeps a record of temporary installation path\n* DONE (mgcv)\n\nThe downloaded source packages are in\n        ‘/tmp/RtmpHmbVYD/downloaded_packages’\n\n\n\n\nR\n\nBiocManager::install('HCAData')\n\n\n\n'getOption(\"repos\")' replaces Bioconductor standard repositories, see 'help(\"repositories\", package = \"BiocManager\")' for details.\nReplacement repositories:\n    CRAN: https://cloud.r-project.org\nBioconductor version 3.22 (BiocManager 1.30.26), R 4.5.1 (2025-06-13)\nInstalling package(s) 'HCAData'\ninstalling the source package ‘HCAData’\n\ntrying URL 'https://bioconductor.org/packages/3.22/data/experiment/src/contrib/HCAData_1.26.0.tar.gz'\nContent type 'application/x-gzip' length 1547692 bytes (1.5 MB)\n==================================================\ndownloaded 1.5 MB\n\nR version 4.5.1 (2025-06-13) -- Great Square Root\n* installing *source* package ‘HCAData’ ...\n** this is package ‘HCAData’ version ‘1.26.0’\n** using staged installation\n** R\n** inst\n** byte-compile and prepare package for lazy loading\nR version 4.5.1 (2025-06-13) -- Great Square Root\n** help\n*** installing help indices\n** building package indices\nR version 4.5.1 (2025-06-13) -- Great Square Root\n** installing vignettes\n** testing if installed package can be loaded from temporary location\nR version 4.5.1 (2025-06-13) -- Great Square Root\n** testing if installed package can be loaded from final location\nR version 4.5.1 (2025-06-13) -- Great Square Root\n** testing if installed package keeps a record of temporary installation path\n* DONE (HCAData)\n\nThe downloaded source packages are in\n        ‘/tmp/RtmpHmbVYD/downloaded_packages’\n\n\n\n\nR\n\ndevtools::install_github('danielschw188/Revelio')\n\n\n\nUsing github PAT from envvar GITHUB_PAT. Use `gitcreds::gitcreds_set()` and unset GITHUB_PAT in .Renviron (or elsewhere) if you want to use the more secure git credential store instead.\nDownloading GitHub repo danielschw188/Revelio@HEAD\nThese packages have more recent versions available.\nIt is recommended to update all of them.\n\n...\n\n** data\n*** moving datasets to lazyload DB\n** byte-compile and prepare package for lazy loading\n** help\n*** installing help indices\n** building package indices\n** testing if installed package can be loaded from temporary location\n** testing if installed package can be loaded from final location\n** testing if installed package keeps a record of temporary installation path\n* DONE (Revelio)\n\n\n\n\n\n\n\n\n\n\nWhat is this package designed for?\nWhat are its main functions? What type of input does it require?",
    "crumbs": [
      "Day 2",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Lab 3: Introduction to R/Bioconductor</span>"
    ]
  },
  {
    "objectID": "content/day2/Lab3_Rbioc.html#basic-r-and-bioconductor-classes",
    "href": "content/day2/Lab3_Rbioc.html#basic-r-and-bioconductor-classes",
    "title": "\n6  Lab 3: Introduction to R/Bioconductor\n",
    "section": "\n6.2 Basic R and Bioconductor classes",
    "text": "6.2 Basic R and Bioconductor classes\nWhile CRAN is a repository of general-purpose packages, Bioconductor is the greatest source of analytical tools, data and workflows dedicated to genomic projects in R. Read more about Bioconductor to fully understand how it builds up on top of R general features, especially with the specific classes it introduces.\nThe two main concepts behind Bioconductor’s success are the non-redundant classes of objects it provides and their inter-operability. Huber et al., Nat. Methods 2015 summarizes it well.\n\n6.2.1 Important R concepts:\n\n6.2.1.1 tibble tables:\ntibbles are built on the fundamental data.frame objects. They follow “tidy” concepts, all gathered in a common tidyverse. This set of key concepts help general data investigation and data visualization through a set of associated packages such as ggplot2.\n\n\n\nR\n\nlibrary(tidyverse)\n\n\n── Attaching core tidyverse packages ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.1     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.2.0     \n── Conflicts ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\ndat &lt;- tibble(\n    x = 1:5, \n    y = 1, \n    z = x ^ 2 + y, \n    class = c('a', 'a', 'b', 'b', 'c')\n)\ndat\n\n# A tibble: 5 × 4\n      x     y     z class\n  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;\n1     1     1     2 a    \n2     2     1     5 a    \n3     3     1    10 b    \n4     4     1    17 b    \n5     5     1    26 c    \n\n\n\nImport a text file into tibbles\n\ntibbles can be created from text files (or Excel files) using the readr package (part of tidyverse)\n\n\n\nR\n\ngenes &lt;- read_tsv('~/Share/GSM4486714_AXH009_genes.tsv', col_names = c('ID', 'Symbol'))\n\n\nRows: 32738 Columns: 2\n── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\nDelimiter: \"\\t\"\nchr (2): ID, Symbol\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\ngenes\n\n# A tibble: 32,738 × 2\n   ID              Symbol       \n   &lt;chr&gt;           &lt;chr&gt;        \n 1 ENSG00000243485 MIR1302-10   \n 2 ENSG00000237613 FAM138A      \n 3 ENSG00000186092 OR4F5        \n 4 ENSG00000238009 RP11-34P13.7 \n 5 ENSG00000239945 RP11-34P13.8 \n 6 ENSG00000237683 AL627309.1   \n 7 ENSG00000239906 RP11-34P13.14\n 8 ENSG00000241599 RP11-34P13.9 \n 9 ENSG00000228463 AP006222.2   \n10 ENSG00000237094 RP4-669L17.10\n# ℹ 32,728 more rows\n\n\n\n6.2.1.2 Handling of tibbles:\ntibbles can be readily “sliced” (i.e. selecting rows by number/name), “filtered” (i.e. selecting rows by condition) and columns can be “selected”. All these operations are performed using verbs (most of them provided by the dplyr package, part of tidyverse).\n\n\n\nR\n\nslice(genes, 1:4)\n\n\n# A tibble: 4 × 2\n  ID              Symbol      \n  &lt;chr&gt;           &lt;chr&gt;       \n1 ENSG00000243485 MIR1302-10  \n2 ENSG00000237613 FAM138A     \n3 ENSG00000186092 OR4F5       \n4 ENSG00000238009 RP11-34P13.7\n\nfilter(genes, Symbol == 'CCDC67')\n\n# A tibble: 1 × 2\n  ID              Symbol\n  &lt;chr&gt;           &lt;chr&gt; \n1 ENSG00000165325 CCDC67\n\nfilter(genes, grepl('^CCDC.*', Symbol))\n\n# A tibble: 159 × 2\n   ID              Symbol  \n   &lt;chr&gt;           &lt;chr&gt;   \n 1 ENSG00000162592 CCDC27  \n 2 ENSG00000160050 CCDC28B \n 3 ENSG00000186409 CCDC30  \n 4 ENSG00000177868 CCDC23  \n 5 ENSG00000159214 CCDC24  \n 6 ENSG00000236624 CCDC163P\n 7 ENSG00000159588 CCDC17  \n 8 ENSG00000122483 CCDC18  \n 9 ENSG00000213085 CCDC19  \n10 ENSG00000117477 CCDC181 \n# ℹ 149 more rows\n\nfilter(genes, grepl('^CCDC.*', Symbol), grepl('.*5$', Symbol))\n\n# A tibble: 9 × 2\n  ID              Symbol \n  &lt;chr&gt;           &lt;chr&gt;  \n1 ENSG00000136710 CCDC115\n2 ENSG00000183323 CCDC125\n3 ENSG00000147419 CCDC25 \n4 ENSG00000149548 CCDC15 \n5 ENSG00000139537 CCDC65 \n6 ENSG00000151838 CCDC175\n7 ENSG00000159625 CCDC135\n8 ENSG00000160994 CCDC105\n9 ENSG00000161609 CCDC155\n\nselect(genes, 1)\n\n# A tibble: 32,738 × 1\n   ID             \n   &lt;chr&gt;          \n 1 ENSG00000243485\n 2 ENSG00000237613\n 3 ENSG00000186092\n 4 ENSG00000238009\n 5 ENSG00000239945\n 6 ENSG00000237683\n 7 ENSG00000239906\n 8 ENSG00000241599\n 9 ENSG00000228463\n10 ENSG00000237094\n# ℹ 32,728 more rows\n\nselect(genes, ID)\n\n# A tibble: 32,738 × 1\n   ID             \n   &lt;chr&gt;          \n 1 ENSG00000243485\n 2 ENSG00000237613\n 3 ENSG00000186092\n 4 ENSG00000238009\n 5 ENSG00000239945\n 6 ENSG00000237683\n 7 ENSG00000239906\n 8 ENSG00000241599\n 9 ENSG00000228463\n10 ENSG00000237094\n# ℹ 32,728 more rows\n\nselect(genes, matches('Sym.*'))\n\n# A tibble: 32,738 × 1\n   Symbol       \n   &lt;chr&gt;        \n 1 MIR1302-10   \n 2 FAM138A      \n 3 OR4F5        \n 4 RP11-34P13.7 \n 5 RP11-34P13.8 \n 6 AL627309.1   \n 7 RP11-34P13.14\n 8 RP11-34P13.9 \n 9 AP006222.2   \n10 RP4-669L17.10\n# ℹ 32,728 more rows\n\n\nColumns can also be quickly added/modified using the mutate verb.\n\n\n\nR\n\nmutate(genes, chr = sample(1:22, n(), replace = TRUE))\n\n\n# A tibble: 32,738 × 3\n   ID              Symbol          chr\n   &lt;chr&gt;           &lt;chr&gt;         &lt;int&gt;\n 1 ENSG00000243485 MIR1302-10       12\n 2 ENSG00000237613 FAM138A           9\n 3 ENSG00000186092 OR4F5             8\n 4 ENSG00000238009 RP11-34P13.7     17\n 5 ENSG00000239945 RP11-34P13.8      5\n 6 ENSG00000237683 AL627309.1       19\n 7 ENSG00000239906 RP11-34P13.14    17\n 8 ENSG00000241599 RP11-34P13.9     12\n 9 ENSG00000228463 AP006222.2       18\n10 ENSG00000237094 RP4-669L17.10     2\n# ℹ 32,728 more rows\n\n\n\n6.2.1.3 |&gt; pipe:\nActions on tibbles can be piped as a chain with |&gt;, just like | pipes stdout as the stdin of the next command in bash. In this case, the first argument is always the output of the previous function and is ommited. Because tidyverse functions generally return a modified version of the input, pipping works remarkably well in such context.\n\n\n\nR\n\nread_tsv('~/Share/GSM4486714_AXH009_genes.tsv', col_names = c('ID', 'Symbol')) |&gt; \n    mutate(chr = sample(1:22, n(), replace = TRUE)) |&gt; \n    filter(chr == 2, grepl('^CCDC.*', Symbol)) |&gt; \n    select(ID) |&gt; \n    slice_head(n = 3)\n\n\nRows: 32738 Columns: 2\n── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\nDelimiter: \"\\t\"\nchr (2): ID, Symbol\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n\n# A tibble: 3 × 1\n  ID             \n  &lt;chr&gt;          \n1 ENSG00000152076\n2 ENSG00000173421\n3 ENSG00000024862\n\n\n\n6.2.2 Important Bioconductor concepts:\n\n6.2.2.1 SummarizedExperiment class:\nThe most fundamental class used to hold the content of large-scale quantitative analyses, such as counts of RNA-seq experiments, or high-throughput cytometry experiments or proteomics experiments.\n\nMake sure you understand the structure of objects from this class. A dedicated workshop that I would recommend quickly going over is available here. Generally speaking, a SummarizedExperiment object contains matrix-like objects (the assays), with rows representing features (e.g. genes, transcripts, …) and each column representing a sample. Information specific to genes and samples are stored in “parallel” data frames, for example to store gene locations, tissue of expression, biotypes (for genes) or batch, generation date, or machine ID (for samples). On top of that, metadata are also stored in the object (to store description of a project, …).\nAn important difference with S3 list-like objects usually used in R is that most of the underlying data (organized in precisely structured \"slots\") is accessed using getter functions, rather than the familiar $ or [. Here are some important getters:\n\n\nassay(), assays(): Extrant matrix-like or list of matrix-like objects of identical dimensions. Since the objects are matrix-like, dim(), dimnames(), and 2-dimensional [, [&lt;- methods are available.\n\ncolData(): Annotations on each column (as a DataFrame): usually, description of each sample\n\nrowData(): Annotations on each row (as a DataFrame): usually, description of each gene\n\nmetadata(): List of unstructured metadata describing the overall content of the object.\n\nLet’s dig into an example (you may need to install the airway package from Bioconductor…)\n\n\n\nR\n\nlibrary(SummarizedExperiment)\n\n\nLoading required package: MatrixGenerics\n\n\nLoading required package: matrixStats\n\n\n\nAttaching package: 'matrixStats'\n\n\nThe following object is masked from 'package:dplyr':\n\n    count\n\n\n\nAttaching package: 'MatrixGenerics'\n\n\nThe following objects are masked from 'package:matrixStats':\n\n    colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse, colCounts, colCummaxs, colCummins, colCumprods, colCumsums, colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs, colMads, colMaxs, colMeans2,\n    colMedians, colMins, colOrderStats, colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds, colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads, colWeightedMeans, colWeightedMedians,\n    colWeightedSds, colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet, rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods, rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,\n    rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins, rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks, rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars, rowWeightedMads,\n    rowWeightedMeans, rowWeightedMedians, rowWeightedSds, rowWeightedVars\n\n\nLoading required package: GenomicRanges\n\n\nLoading required package: stats4\n\n\nLoading required package: BiocGenerics\n\n\nLoading required package: generics\n\n\n\nAttaching package: 'generics'\n\n\nThe following object is masked from 'package:lubridate':\n\n    as.difftime\n\n\nThe following object is masked from 'package:dplyr':\n\n    explain\n\n\nThe following objects are masked from 'package:base':\n\n    as.difftime, as.factor, as.ordered, intersect, is.element, setdiff, setequal, union\n\n\n\nAttaching package: 'BiocGenerics'\n\n\nThe following object is masked from 'package:dplyr':\n\n    combine\n\n\nThe following objects are masked from 'package:stats':\n\n    IQR, mad, sd, var, xtabs\n\n\nThe following objects are masked from 'package:base':\n\n    anyDuplicated, aperm, append, as.data.frame, basename, cbind, colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep, grepl, is.unsorted, lapply, Map, mapply, match, mget, order, paste,\n    pmax, pmax.int, pmin, pmin.int, Position, rank, rbind, Reduce, rownames, sapply, saveRDS, table, tapply, unique, unsplit, which.max, which.min\n\n\nLoading required package: S4Vectors\n\n\n\nAttaching package: 'S4Vectors'\n\n\nThe following objects are masked from 'package:lubridate':\n\n    second, second&lt;-\n\n\nThe following objects are masked from 'package:dplyr':\n\n    first, rename\n\n\nThe following object is masked from 'package:tidyr':\n\n    expand\n\n\nThe following object is masked from 'package:utils':\n\n    findMatches\n\n\nThe following objects are masked from 'package:base':\n\n    expand.grid, I, unname\n\n\nLoading required package: IRanges\n\n\n\nAttaching package: 'IRanges'\n\n\nThe following object is masked from 'package:lubridate':\n\n    %within%\n\n\nThe following objects are masked from 'package:dplyr':\n\n    collapse, desc, slice\n\n\nThe following object is masked from 'package:purrr':\n\n    reduce\n\n\nLoading required package: Seqinfo\n\n\nLoading required package: Biobase\n\n\nWelcome to Bioconductor\n\n    Vignettes contain introductory material; view with 'browseVignettes()'. To cite Bioconductor, see 'citation(\"Biobase\")', and for packages 'citation(\"pkgname\")'.\n\n\n\nAttaching package: 'Biobase'\n\n\nThe following object is masked from 'package:MatrixGenerics':\n\n    rowMedians\n\n\nThe following objects are masked from 'package:matrixStats':\n\n    anyMissing, rowMedians\n\nlibrary(airway)\ndata(airway)\nairway\n\nclass: RangedSummarizedExperiment \ndim: 63677 8 \nmetadata(1): ''\nassays(1): counts\nrownames(63677): ENSG00000000003 ENSG00000000005 ... ENSG00000273492 ENSG00000273493\nrowData names(10): gene_id gene_name ... seq_coord_system symbol\ncolnames(8): SRR1039508 SRR1039509 ... SRR1039520 SRR1039521\ncolData names(9): SampleName cell ... Sample BioSample\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nWhat are the dimensions of the dataset? What type of quantitative data is stored? Which features are assessed?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ndim(airway)\n\n\n[1] 63677     8\n\nrowData(airway)\n\nDataFrame with 63677 rows and 10 columns\n                        gene_id     gene_name  entrezid   gene_biotype gene_seq_start gene_seq_end              seq_name seq_strand seq_coord_system        symbol\n                    &lt;character&gt;   &lt;character&gt; &lt;integer&gt;    &lt;character&gt;      &lt;integer&gt;    &lt;integer&gt;           &lt;character&gt;  &lt;integer&gt;        &lt;integer&gt;   &lt;character&gt;\nENSG00000000003 ENSG00000000003        TSPAN6        NA protein_coding       99883667     99894988                     X         -1               NA        TSPAN6\nENSG00000000005 ENSG00000000005          TNMD        NA protein_coding       99839799     99854882                     X          1               NA          TNMD\nENSG00000000419 ENSG00000000419          DPM1        NA protein_coding       49551404     49575092                    20         -1               NA          DPM1\nENSG00000000457 ENSG00000000457         SCYL3        NA protein_coding      169818772    169863408                     1         -1               NA         SCYL3\nENSG00000000460 ENSG00000000460      C1orf112        NA protein_coding      169631245    169823221                     1          1               NA      C1orf112\n...                         ...           ...       ...            ...            ...          ...                   ...        ...              ...           ...\nENSG00000273489 ENSG00000273489 RP11-180C16.1        NA      antisense      131178723    131182453                     7         -1               NA RP11-180C16.1\nENSG00000273490 ENSG00000273490        TSEN34        NA protein_coding       54693789     54697585 HSCHR19LRC_LRC_J_CTG1          1               NA        TSEN34\nENSG00000273491 ENSG00000273491  RP11-138A9.2        NA        lincRNA      130600118    130603315          HG1308_PATCH          1               NA  RP11-138A9.2\nENSG00000273492 ENSG00000273492    AP000230.1        NA        lincRNA       27543189     27589700                    21          1               NA    AP000230.1\nENSG00000273493 ENSG00000273493  RP11-80H18.4        NA        lincRNA       58315692     58315845                     3          1               NA  RP11-80H18.4\n\ncolData(airway)\n\nDataFrame with 8 rows and 9 columns\n           SampleName     cell      dex    albut        Run avgLength Experiment    Sample    BioSample\n             &lt;factor&gt; &lt;factor&gt; &lt;factor&gt; &lt;factor&gt;   &lt;factor&gt; &lt;integer&gt;   &lt;factor&gt;  &lt;factor&gt;     &lt;factor&gt;\nSRR1039508 GSM1275862  N61311     untrt    untrt SRR1039508       126  SRX384345 SRS508568 SAMN02422669\nSRR1039509 GSM1275863  N61311     trt      untrt SRR1039509       126  SRX384346 SRS508567 SAMN02422675\nSRR1039512 GSM1275866  N052611    untrt    untrt SRR1039512       126  SRX384349 SRS508571 SAMN02422678\nSRR1039513 GSM1275867  N052611    trt      untrt SRR1039513        87  SRX384350 SRS508572 SAMN02422670\nSRR1039516 GSM1275870  N080611    untrt    untrt SRR1039516       120  SRX384353 SRS508575 SAMN02422682\nSRR1039517 GSM1275871  N080611    trt      untrt SRR1039517       126  SRX384354 SRS508576 SAMN02422673\nSRR1039520 GSM1275874  N061011    untrt    untrt SRR1039520       101  SRX384357 SRS508579 SAMN02422683\nSRR1039521 GSM1275875  N061011    trt      untrt SRR1039521        98  SRX384358 SRS508580 SAMN02422677\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nCan you create a subset of the data corresponding to LRG genes in untreated samples?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nuntreated_LRG &lt;- airway[grepl('^LRG_', rownames(airway)), airway$dex == 'untrt']\nuntreated_LRG\n\n\nclass: RangedSummarizedExperiment \ndim: 0 4 \nmetadata(1): ''\nassays(1): counts\nrownames(0):\nrowData names(10): gene_id gene_name ... seq_coord_system symbol\ncolnames(4): SRR1039508 SRR1039512 SRR1039516 SRR1039520\ncolData names(9): SampleName cell ... Sample BioSample\n\n\n\n\n\n\n\n\n6.2.2.2 GenomicRanges class (a.k.a. GRanges):\nGenomicRanges are a type of IntervalRanges, they are useful to describe genomic intervals. Each entry in a GRanges object has a seqnames(), a start() and an end() coordinates, a strand(), as well as associated metadata (mcols()). They can be built from scratch using tibbles converted with makeGRangesFromDataFrame().\n\n\n\nR\n\nlibrary(GenomicRanges)\ngr &lt;- read_tsv('~/Share/GSM4486714_AXH009_genes.tsv', col_names = c('ID', 'Symbol')) |&gt; \n    mutate(\n        chr = sample(1:22, n(), replace = TRUE), \n        start = sample(1:1000, n(), replace = TRUE),\n        end = sample(10000:20000, n(), replace = TRUE),\n        strand = sample(c('-', '+'), n(), replace = TRUE)\n    ) |&gt; \n    makeGRangesFromDataFrame(keep.extra.columns = TRUE)\n\n\nRows: 32738 Columns: 2\n── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\nDelimiter: \"\\t\"\nchr (2): ID, Symbol\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\ngr\n\nGRanges object with 32738 ranges and 2 metadata columns:\n          seqnames    ranges strand |              ID       Symbol\n             &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; |     &lt;character&gt;  &lt;character&gt;\n      [1]       19 558-17646      + | ENSG00000243485   MIR1302-10\n      [2]       14 212-18716      + | ENSG00000237613      FAM138A\n      [3]       11 895-16915      - | ENSG00000186092        OR4F5\n      [4]       20 488-19429      - | ENSG00000238009 RP11-34P13.7\n      [5]       11 791-10309      + | ENSG00000239945 RP11-34P13.8\n      ...      ...       ...    ... .             ...          ...\n  [32734]       21 156-15929      - | ENSG00000215635   AC145205.1\n  [32735]       15 419-18539      + | ENSG00000268590        BAGE5\n  [32736]       15 607-19358      - | ENSG00000251180   CU459201.1\n  [32737]        8 176-11354      + | ENSG00000215616   AC002321.2\n  [32738]       10 787-16208      + | ENSG00000215611   AC002321.1\n  -------\n  seqinfo: 22 sequences from an unspecified genome; no seqlengths\n\nmcols(gr)\n\nDataFrame with 32738 rows and 2 columns\n                   ID       Symbol\n          &lt;character&gt;  &lt;character&gt;\n1     ENSG00000243485   MIR1302-10\n2     ENSG00000237613      FAM138A\n3     ENSG00000186092        OR4F5\n4     ENSG00000238009 RP11-34P13.7\n5     ENSG00000239945 RP11-34P13.8\n...               ...          ...\n32734 ENSG00000215635   AC145205.1\n32735 ENSG00000268590        BAGE5\n32736 ENSG00000251180   CU459201.1\n32737 ENSG00000215616   AC002321.2\n32738 ENSG00000215611   AC002321.1\n\n\nJust like tidyverse in R, tidy functions are provided for GRanges by the plyranges package.\n\n\n\nR\n\nlibrary(plyranges)\n\n\n\nAttaching package: 'plyranges'\n\n\nThe following object is masked from 'package:IRanges':\n\n    slice\n\n\nThe following objects are masked from 'package:dplyr':\n\n    between, n, n_distinct\n\n\nThe following object is masked from 'package:stats':\n\n    filter\n\ngr |&gt; \n    filter(start &lt; 400, end &gt; 12000, end &lt; 15000) |&gt; \n    seqnames() |&gt; \n    table()\n\n\n  1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22 \n195 194 170 159 184 190 170 186 176 166 166 161 190 202 175 184 173 194 164 151 161 183 \n\n\n\n\n\n\n\n\nQuestion\n\n\n\nCan you find a way to easily read common input files such as bed files into GRanges?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nlibrary(rtracklayer)\ngenes2 &lt;- import('~/Share/GRCm39_genes.bed')\ngenes2\n\n\nGRanges object with 53700 ranges and 2 metadata columns:\n          seqnames            ranges strand |               name     score\n             &lt;Rle&gt;         &lt;IRanges&gt;  &lt;Rle&gt; |        &lt;character&gt; &lt;numeric&gt;\n      [1]        1   3143476-3144545      + | ENSMUSG00000102693         0\n      [2]        1   3172239-3172348      + | ENSMUSG00000064842         0\n      [3]        1   3276124-3741721      - | ENSMUSG00000051951         0\n      [4]        1   3322980-3323459      + | ENSMUSG00000102851         0\n      [5]        1   3435954-3438772      - | ENSMUSG00000103377         0\n      ...      ...               ...    ... .                ...       ...\n  [53696]        Y 90763696-90766736      - | ENSMUSG00000095366         0\n  [53697]        Y 90764326-90774754      + | ENSMUSG00000095134         0\n  [53698]        Y 90796007-90827734      + | ENSMUSG00000096768         0\n  [53699]        Y 90848682-90855309      + | ENSMUSG00000099871         0\n  [53700]        Y 90850138-90850446      - | ENSMUSG00000096850         0\n  -------\n  seqinfo: 36 sequences from an unspecified genome; no seqlengths\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nHow would you have proceeded without rtracklayer? Check the start coordinates: what do you see? Comment on the interest of using Bioconductor.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nlibrary(rtracklayer)\ngenes2_manual &lt;- read_tsv('~/Share/GRCm39_genes.bed', col_names = FALSE) |&gt; \n    drop_na() |&gt;\n    purrr::set_names(c('chr', 'start', 'stop', 'id', 'score', 'strand')) |&gt; \n    makeGRangesFromDataFrame(keep.extra.columns = TRUE)\n\n\nRows: 53700 Columns: 6\n── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\nDelimiter: \"\\t\"\nchr (3): X1, X4, X6\ndbl (3): X2, X3, X5\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\ngenes2_manual\n\nGRanges object with 53700 ranges and 2 metadata columns:\n          seqnames            ranges strand |                 id     score\n             &lt;Rle&gt;         &lt;IRanges&gt;  &lt;Rle&gt; |        &lt;character&gt; &lt;numeric&gt;\n      [1]        1   3143475-3144545      + | ENSMUSG00000102693         0\n      [2]        1   3172238-3172348      + | ENSMUSG00000064842         0\n      [3]        1   3276123-3741721      - | ENSMUSG00000051951         0\n      [4]        1   3322979-3323459      + | ENSMUSG00000102851         0\n      [5]        1   3435953-3438772      - | ENSMUSG00000103377         0\n      ...      ...               ...    ... .                ...       ...\n  [53696]        Y 90763695-90766736      - | ENSMUSG00000095366         0\n  [53697]        Y 90764325-90774754      + | ENSMUSG00000095134         0\n  [53698]        Y 90796006-90827734      + | ENSMUSG00000096768         0\n  [53699]        Y 90848681-90855309      + | ENSMUSG00000099871         0\n  [53700]        Y 90850137-90850446      - | ENSMUSG00000096850         0\n  -------\n  seqinfo: 36 sequences from an unspecified genome; no seqlengths\n\nhead(start(genes2))\n\n[1] 3143476 3172239 3276124 3322980 3435954 3445779\n\nhead(start(genes2_manual))\n\n[1] 3143475 3172238 3276123 3322979 3435953 3445778",
    "crumbs": [
      "Day 2",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Lab 3: Introduction to R/Bioconductor</span>"
    ]
  },
  {
    "objectID": "content/day2/Lab3_Rbioc.html#cran-bioconductor-approaches-to-scrnaseq",
    "href": "content/day2/Lab3_Rbioc.html#cran-bioconductor-approaches-to-scrnaseq",
    "title": "\n6  Lab 3: Introduction to R/Bioconductor\n",
    "section": "\n6.3 CRAN & Bioconductor approaches to scRNAseq",
    "text": "6.3 CRAN & Bioconductor approaches to scRNAseq\n\n6.3.1 scRNAseq in Bioconductor\nFor single-cell RNA-seq projects, Bioconductor has been introducting new classes and standards very rapidly in the past few years. Notably, several packages are increasingly becoming central for single-cell analysis:\n\nSingleCellExperiment\nscater\nscran\nscuttle\nbatchelor\nSingleR\nbluster\nDropletUtils\nslingshot\ntradeSeq\n…\n\nSingleCellExperiment is the fundamental class designed to contain single-cell (RNA-seq) data in Bioconductor ecosystem. It is a modified version of the SummarizedExperiment object, so most of the getters/setters are shared with this class.\n\n\n\n\nR\n\nlibrary(SingleCellExperiment)\nsource('~/Share/bin/prepare_Nestorowa.R') # Adapted from Nestorowa et al., Blood 2016 (doi: 10.1182/blood-2016-05-716480)\n\n\nloading from cache\n\n\nrequire(\"ensembldb\")\n\nsce\n\nclass: SingleCellExperiment \ndim: 500 1920 \nmetadata(0):\nassays(2): counts logcounts\nrownames(500): ENSMUSG00000076609 ENSMUSG00000021250 ... ENSMUSG00000009566 ENSMUSG00000033809\nrowData names(0):\ncolnames(1920): HSPC_007 HSPC_013 ... Prog_852 Prog_810\ncolData names(11): gate broad ... label sizeFactor\nreducedDimNames(1): diffusion\nmainExpName: endogenous\naltExpNames(0):\n\nclass(sce)\n\n[1] \"SingleCellExperiment\"\nattr(,\"package\")\n[1] \"SingleCellExperiment\"\n\n\nSeveral slots can be accessed in a SingleCellExperiment object, just like the SummarizedExperiment object it’s been adapted from:\n\n\n\nR\n\ncolData(sce)\n\n\nDataFrame with 1920 rows and 11 columns\n                gate       broad   broad.mpp        fine    fine.mpp     ESLAM      HSC1 projected             metrics       label sizeFactor\n         &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;logical&gt; &lt;logical&gt; &lt;logical&gt;         &lt;DataFrame&gt; &lt;character&gt;  &lt;numeric&gt;\nHSPC_007        HSPC          NA          NA          NA          NA     FALSE     FALSE     FALSE 194829:  5022:0:...        HSPC  0.0272469\nHSPC_013        HSPC        LMPP          NA        LMPP          NA     FALSE     FALSE     FALSE 110530: 15271:0:...        HSPC  0.0904215\nHSPC_019        HSPC        LMPP          NA          NA          NA     FALSE     FALSE     FALSE  86825:  2708:0:...        HSPC  0.0199211\nHSPC_025        HSPC         MPP        MPP1          NA          NA     FALSE     FALSE     FALSE 212206:107278:0:...        HSPC  0.5217920\nHSPC_031        HSPC         MPP       STHSC          NA          NA     FALSE     FALSE     FALSE 690411:227480:0:...        HSPC  1.1062306\n...              ...         ...         ...         ...         ...       ...       ...       ...                 ...         ...        ...\nProg_834        Prog         CMP          NA          NA          NA     FALSE     FALSE     FALSE 471273:296060:0:...        Prog   1.668383\nProg_840        Prog         GMP          NA         GMP          NA     FALSE     FALSE     FALSE 421195:317394:0:...        Prog   1.728596\nProg_846        Prog         GMP          NA          NA          NA     FALSE     FALSE     FALSE 337564:253387:0:...        Prog   1.282827\nProg_852        Prog         MEP          NA         MEP          NA     FALSE     FALSE     FALSE 200193:136478:0:...        Prog   0.643172\nProg_810        Prog         CMP          NA         CMP          NA     FALSE     FALSE     FALSE 857257:396247:0:...        Prog   2.614351\n\nrowData(sce)\n\nDataFrame with 500 rows and 0 columns\n\nmetadata(sce)\n\nlist()\n\ndim(sce)\n\n[1]  500 1920\n\nassays(sce)\n\nList of length 2\nnames(2): counts logcounts\n\n\nQuantitative metrics for scRNAseq studies can also be stored in assays:\n\n\n\nR\n\nassays(sce)\n\n\nList of length 2\nnames(2): counts logcounts\n\nassay(sce, 'counts')[1:10, 1:10]\n\n10 x 10 sparse Matrix of class \"dgCMatrix\"\n\n\n  [[ suppressing 10 column names 'HSPC_007', 'HSPC_013', 'HSPC_019' ... ]]\n\n\n                                                            \nENSMUSG00000076609 30  16  7   17  19   11 1359   13  15   6\nENSMUSG00000021250  3   2  4    .   1    3  118    2  69  41\nENSMUSG00000076617 40  54 13   29 298  417 1107    9  16  15\nENSMUSG00000075602  3 248  7  537 640    7  300 1530 324 971\nENSMUSG00000006389  3   4  1 1171   6    2  271 5497 293 192\nENSMUSG00000041481  3   .  1    3   1    3  177    5   1 192\nENSMUSG00000024190  1  29  1 1733   1    5   20    3   1   1\nENSMUSG00000003949  4  15  3  175 915 1131   41 1465 330 258\nENSMUSG00000052684  1   4  2  144  82    5  142  578   .  78\nENSMUSG00000026358  .  27  6  344   3    9    3 3612 185   .\n\nassay(sce, 'logcounts')[1:10, 1:10]\n\n10 x 10 sparse Matrix of class \"dgCMatrix\"\n\n\n  [[ suppressing 10 column names 'HSPC_007', 'HSPC_013', 'HSPC_019' ... ]]\n\n\n                                                                                                                     \nENSMUSG00000076609 10.105963  7.475320 8.461015  5.069532 4.1839186  4.484632 13.057990  2.7927556 4.907536  4.256554\nENSMUSG00000021250  6.795769  4.530984 7.656727  .        0.9290112  2.772518  9.534081  0.9352591 7.071052  6.963227\nENSMUSG00000076617 10.520673  9.224491 9.352209  5.822162 8.0788620  9.664957 12.762138  2.3519259 4.997638  5.532469\nENSMUSG00000075602  6.795769 11.421912 8.461015 10.008633 9.1787674  3.868916 10.879076  9.4488576 9.293908 11.517886\nENSMUSG00000006389  6.795769  5.499439 5.678018 11.132621 2.6834323  2.289440 10.732488 11.2924799 9.149058  9.181516\nENSMUSG00000041481  6.795769  .        5.678018  2.754763 0.9290112  2.772518 10.118395  1.7139531 1.552981  9.181516\nENSMUSG00000024190  5.236545  8.329662 5.678018 11.697944 0.9290112  3.422457  6.982870  1.2438829 1.552981  2.006833\nENSMUSG00000003949  7.207556  7.382751 7.244071  8.393960 9.6937189 11.103314  8.012640  9.3863182 9.320338  9.607145\nENSMUSG00000052684  5.236545  5.499439 6.663859  8.113597 6.2312326  3.422457  9.800857  8.0478635 .         7.885582\nENSMUSG00000026358  .         8.226901 8.239305  9.366905 1.8921625  4.209375  4.309131 10.6869334 8.487165  .       \n\ncounts(sce)[1:10, 1:10]\n\n10 x 10 sparse Matrix of class \"dgCMatrix\"\n\n\n  [[ suppressing 10 column names 'HSPC_007', 'HSPC_013', 'HSPC_019' ... ]]\n\n\n                                                            \nENSMUSG00000076609 30  16  7   17  19   11 1359   13  15   6\nENSMUSG00000021250  3   2  4    .   1    3  118    2  69  41\nENSMUSG00000076617 40  54 13   29 298  417 1107    9  16  15\nENSMUSG00000075602  3 248  7  537 640    7  300 1530 324 971\nENSMUSG00000006389  3   4  1 1171   6    2  271 5497 293 192\nENSMUSG00000041481  3   .  1    3   1    3  177    5   1 192\nENSMUSG00000024190  1  29  1 1733   1    5   20    3   1   1\nENSMUSG00000003949  4  15  3  175 915 1131   41 1465 330 258\nENSMUSG00000052684  1   4  2  144  82    5  142  578   .  78\nENSMUSG00000026358  .  27  6  344   3    9    3 3612 185   .\n\nlogcounts(sce)[1:10, 1:10]\n\n10 x 10 sparse Matrix of class \"dgCMatrix\"\n\n\n  [[ suppressing 10 column names 'HSPC_007', 'HSPC_013', 'HSPC_019' ... ]]\n\n\n                                                                                                                     \nENSMUSG00000076609 10.105963  7.475320 8.461015  5.069532 4.1839186  4.484632 13.057990  2.7927556 4.907536  4.256554\nENSMUSG00000021250  6.795769  4.530984 7.656727  .        0.9290112  2.772518  9.534081  0.9352591 7.071052  6.963227\nENSMUSG00000076617 10.520673  9.224491 9.352209  5.822162 8.0788620  9.664957 12.762138  2.3519259 4.997638  5.532469\nENSMUSG00000075602  6.795769 11.421912 8.461015 10.008633 9.1787674  3.868916 10.879076  9.4488576 9.293908 11.517886\nENSMUSG00000006389  6.795769  5.499439 5.678018 11.132621 2.6834323  2.289440 10.732488 11.2924799 9.149058  9.181516\nENSMUSG00000041481  6.795769  .        5.678018  2.754763 0.9290112  2.772518 10.118395  1.7139531 1.552981  9.181516\nENSMUSG00000024190  5.236545  8.329662 5.678018 11.697944 0.9290112  3.422457  6.982870  1.2438829 1.552981  2.006833\nENSMUSG00000003949  7.207556  7.382751 7.244071  8.393960 9.6937189 11.103314  8.012640  9.3863182 9.320338  9.607145\nENSMUSG00000052684  5.236545  5.499439 6.663859  8.113597 6.2312326  3.422457  9.800857  8.0478635 .         7.885582\nENSMUSG00000026358  .         8.226901 8.239305  9.366905 1.8921625  4.209375  4.309131 10.6869334 8.487165  .       \n\n\n\n\n\n\n\n\nQuestion\n\n\n\nCheck the colData() output of the sce object. What information is stored there? How can you access the different objects stored in colData?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ncolData(sce)\n\n\nDataFrame with 1920 rows and 11 columns\n                gate       broad   broad.mpp        fine    fine.mpp     ESLAM      HSC1 projected             metrics       label sizeFactor\n         &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;logical&gt; &lt;logical&gt; &lt;logical&gt;         &lt;DataFrame&gt; &lt;character&gt;  &lt;numeric&gt;\nHSPC_007        HSPC          NA          NA          NA          NA     FALSE     FALSE     FALSE 194829:  5022:0:...        HSPC  0.0272469\nHSPC_013        HSPC        LMPP          NA        LMPP          NA     FALSE     FALSE     FALSE 110530: 15271:0:...        HSPC  0.0904215\nHSPC_019        HSPC        LMPP          NA          NA          NA     FALSE     FALSE     FALSE  86825:  2708:0:...        HSPC  0.0199211\nHSPC_025        HSPC         MPP        MPP1          NA          NA     FALSE     FALSE     FALSE 212206:107278:0:...        HSPC  0.5217920\nHSPC_031        HSPC         MPP       STHSC          NA          NA     FALSE     FALSE     FALSE 690411:227480:0:...        HSPC  1.1062306\n...              ...         ...         ...         ...         ...       ...       ...       ...                 ...         ...        ...\nProg_834        Prog         CMP          NA          NA          NA     FALSE     FALSE     FALSE 471273:296060:0:...        Prog   1.668383\nProg_840        Prog         GMP          NA         GMP          NA     FALSE     FALSE     FALSE 421195:317394:0:...        Prog   1.728596\nProg_846        Prog         GMP          NA          NA          NA     FALSE     FALSE     FALSE 337564:253387:0:...        Prog   1.282827\nProg_852        Prog         MEP          NA         MEP          NA     FALSE     FALSE     FALSE 200193:136478:0:...        Prog   0.643172\nProg_810        Prog         CMP          NA         CMP          NA     FALSE     FALSE     FALSE 857257:396247:0:...        Prog   2.614351\n\nlapply(colData(sce), class)\n\n$gate\n[1] \"character\"\n\n$broad\n[1] \"character\"\n\n$broad.mpp\n[1] \"character\"\n\n$fine\n[1] \"character\"\n\n$fine.mpp\n[1] \"character\"\n\n$ESLAM\n[1] \"logical\"\n\n$HSC1\n[1] \"logical\"\n\n$projected\n[1] \"logical\"\n\n$metrics\n[1] \"DFrame\"\nattr(,\"package\")\n[1] \"S4Vectors\"\n\n$label\n[1] \"character\"\n\n$sizeFactor\n[1] \"numeric\"\n\nhead(colData(sce)[[1]])\n\n[1] \"HSPC\" \"HSPC\" \"HSPC\" \"HSPC\" \"HSPC\" \"HSPC\"\n\nhead(colData(sce)[['FACS']])\n\nNULL\n\nhead(sce$sizeFactor)\n\n  HSPC_007   HSPC_013   HSPC_019   HSPC_025   HSPC_031   HSPC_037 \n0.02724693 0.09042153 0.01992108 0.52179199 1.10623062 0.51431538 \n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nAre there any reduced dimensionality representation of the data stored in the sce object? How can we run a PCA using normalized counts?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nreducedDims(sce)\n\n\nList of length 1\nnames(1): diffusion\n\npca &lt;- prcomp(t(logcounts(sce)))\nnames(pca)\n\n[1] \"sdev\"     \"rotation\" \"center\"   \"scale\"    \"x\"       \n\ndim(pca$x)\n\n[1] 1920  500\n\nhead(pca$x[, 1:50])\n\n                PC1        PC2        PC3        PC4       PC5        PC6        PC7        PC8       PC9       PC10       PC11       PC12      PC13       PC14       PC15      PC16       PC17        PC18       PC19      PC20        PC21\nHSPC_007   5.581553 -3.4100947   9.951168 13.0797762  3.545895 10.1226017 -4.1159055 -3.4238633 -7.936727 10.6921786  -1.048376  -4.362441  5.252001  1.7514129 -0.9191112 -4.720843 -2.9529841  1.72653427 -1.1546955  5.967443  -4.9219043\nHSPC_013 -12.193370 -5.3973727   1.573549 13.7750818 -1.316799 -0.9443251 -0.4590312  1.4407575 -4.399518  8.6381255  -3.892309  -3.310407  2.193760  6.3337138  0.6321951  1.247678  2.5258067 -2.27899711  8.3330827  1.203497   0.5654264\nHSPC_019  -3.528223  7.7885911   5.305870 -0.6928286  4.046022  0.3507853 -5.8048713 -5.5745236 -4.817877  6.9710785  -4.621007  -2.086735 10.624674  0.1293415 -6.3774706  7.536987  1.3668570 -0.07492649 -0.9040375 -1.573461  -1.3513760\nHSPC_025 -25.082329  5.2035295   4.627378 14.0209886 -1.869520 -5.9116901 -0.1576345  5.7150177  2.998934  4.4459935   0.259513   2.635814 -6.254529  3.3289181  1.9856744 -5.554629 10.6416059 -9.62351660 -2.4473404  1.696153  -5.6186977\nHSPC_031 -16.159834  8.0498872 -10.116348  4.2919683  2.683031 -6.7923050  8.0293846 -1.9657941 -2.445369  0.9570117  -5.458279 -12.344929  5.930111 -5.9945465 -0.7331365  2.682199  1.3677304 -9.98871025  4.5417044 -6.343339   1.8645220\nHSPC_037 -20.450257 -0.6194833  -7.510092 14.1745410  8.051961  1.0421148 10.5405868  0.7380758 -3.666130 -0.3892389 -10.137915   1.092324  6.488297  2.9905900  3.6858905 -9.673307  0.5212146 -2.05971416 -1.9071441  7.463945 -10.3870858\n               PC22       PC23      PC24      PC25       PC26       PC27       PC28        PC29       PC30       PC31      PC32       PC33      PC34       PC35       PC36      PC37        PC38       PC39      PC40        PC41       PC42\nHSPC_007  2.9618115 -5.5791148 -2.268495  1.095512 -2.3194333 -6.8060168  1.4734275   4.6384342 -1.3155950 -5.7868406 -1.925339   1.104915 -4.904943 -5.7231568  7.0623893 -5.456147   0.3217448  -2.572326 -4.551055  -0.1726143   5.842971\nHSPC_013  4.9754802 -0.5438859 -2.799659  4.265413  0.4714923 -0.4501818  0.7892971   2.6084879 -5.2467188  0.5364803  1.722019   4.990867  4.896010  1.2722998 -3.8090271 -1.647040  -2.6976177   1.103188 -2.356270   1.6141577  -3.259530\nHSPC_019  4.0940259  0.8512859 -1.442058 10.897733  6.1569133  1.4970447  4.0109183 -11.2219306 -6.4404311 -2.7100811  2.059306  -4.575883 -2.260518 -8.2634335 -2.3966379  2.999743  -3.4977372  -4.638447  1.270189   3.3668990   5.400202\nHSPC_025  2.7414756  0.3282526 -1.698754 -7.288994 -0.8159283  2.8763124 -3.5496455   0.1712682  2.6777455 -5.5417113 -1.859348  -0.757561 -5.178513 -0.5872237 -0.8708151  2.772968  -5.2629035  -4.497201 -2.013552  -4.0707202  -1.072854\nHSPC_031 -0.9663505 -5.8157882  6.189554  2.518689  9.3543754  6.1909333  2.5499150   4.2883360 -0.7154207 -8.2774092 -3.288322 -11.886294 -4.332450  6.2491786  3.0642466  3.002628 -11.6083495 -15.142854 -1.293257 -12.9505869 -11.287041\nHSPC_037  1.4925686 -4.0960445 -3.744462  5.418505 -7.6114089 -3.4052990 -0.8200447   0.2419793  3.4306565 -0.3564786 -5.354014  -8.363324  3.751114 -7.3113139  0.2295738  4.045629  -6.4420490   1.771556 -3.322189  -6.1165457  -1.213184\n                PC43      PC44      PC45       PC46       PC47        PC48      PC49      PC50\nHSPC_007 -3.50678908 3.4892276  5.848641 -0.2128977  0.4942121 -0.07747664 -2.827778  2.412009\nHSPC_013 -5.03456958 1.1780332 -1.552541 -2.3808517 -2.9659444 -0.74742282  1.149531  2.472806\nHSPC_019 -3.12221617 3.2583780  1.817843 -3.1729495 -1.1888832 -0.59825631 -9.962968 -2.585295\nHSPC_025 -2.77454846 0.4562519 -6.480854  0.6699326 -5.8678726  0.17369337  7.514302  1.163721\nHSPC_031  0.09341584 3.9700545  2.692311 -3.1757431  1.6065308 -1.97332056 -3.111541 -5.190516\nHSPC_037  3.59481984 7.5068703  1.282379 -7.0477980  3.7969450  1.60118178 -5.204884  9.217837\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nNow, let’s compute a UMAP embedding from this PCA and compare it to the PCA embedding.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\numap &lt;- uwot::umap(pca$x)\ncolnames(umap) &lt;- c('UMAP1', 'UMAP2')\nplot(pca$x[,1], pca$x[,2])\n\n\n\n\n\n\n\nplot(umap[,1], umap[,2])\n\n\n\n\n\n\n\n\n\n\n\n\nWe will see more advanced ways of reducing scRNAseq data dimensionality in the coming lectures and labs.\n\n6.3.2 scRNAseq in R\nSeurat is another very popular ecosystem to investigate scRNAseq data. It is primarily developed and maintained by the Sajita Lab. It originally begun as a single package aiming at encompassing “all” (most) aspects of scRNAseq analysis. However, it rapidly evolved in a much larger project, and now operates along with other “wrappers” and extensions. It also has a very extended support from the lab group. All in all, is provides a (somewhat) simple workflow to start investigating scRNAseq data.\nIt is important to chose one standard that you feel comfortable with yourself. Which standard provides the most intuitive approach for you? Do you prefer an “all-in-one, plug-n-play” workflow (Seurat-style), or a modular approach (Bioconductor-style)? Which documentation is easier to read for you, a central full-featured website with extensive examples (Seurat-style), or “programmatic”-style vignettes (Bioconductor-style)?\nThis course will mostly rely on Bioconductor-based methods, but sometimes use Seurat-based methods.s In the absence of coordination of data structures, the next best solution is to write functions to coerce an object from a certain class to another class (i.e. Seurat to SingleCellExperiment, or vice-versa). Luckily, this is quite straightforward in R for these 2 data classes:\n\n\n\nR\n\nsce_seurat &lt;- Seurat::as.Seurat(sce)\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nWarning: Keys should be one or more alphanumeric characters followed by an underscore, setting key from DC to DC_\n\nsce\n\nclass: SingleCellExperiment \ndim: 500 1920 \nmetadata(0):\nassays(2): counts logcounts\nrownames(500): ENSMUSG00000076609 ENSMUSG00000021250 ... ENSMUSG00000009566 ENSMUSG00000033809\nrowData names(0):\ncolnames(1920): HSPC_007 HSPC_013 ... Prog_852 Prog_810\ncolData names(11): gate broad ... label sizeFactor\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\nAlso defined by 'SeuratObject'\n\n\nreducedDimNames(1): diffusion\nmainExpName: endogenous\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\nAlso defined by 'SeuratObject'\n\n\naltExpNames(0):\n\nsce_seurat\n\nAn object of class Seurat \n500 features across 1920 samples within 1 assay \nActive assay: endogenous (500 features, 0 variable features)\n 2 layers present: counts, data\n 1 dimensional reduction calculated: diffusion\n\nsce2 &lt;- Seurat::as.SingleCellExperiment(sce_seurat)\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nDo you see any change between sce and the corresponding, “back-converted”, sce2 objects? Explain these differences.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nsce\n\n\nclass: SingleCellExperiment \ndim: 500 1920 \nmetadata(0):\nassays(2): counts logcounts\nrownames(500): ENSMUSG00000076609 ENSMUSG00000021250 ... ENSMUSG00000009566 ENSMUSG00000033809\nrowData names(0):\ncolnames(1920): HSPC_007 HSPC_013 ... Prog_852 Prog_810\ncolData names(11): gate broad ... label sizeFactor\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nreducedDimNames(1): diffusion\nmainExpName: endogenous\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\nAlso defined by 'SeuratObject'\n\n\naltExpNames(0):\n\nsce2\n\nclass: SingleCellExperiment \ndim: 500 1920 \nmetadata(0):\nassays(2): counts logcounts\nrownames(500): ENSMUSG00000076609 ENSMUSG00000021250 ... ENSMUSG00000009566 ENSMUSG00000033809\nrowData names(0):\ncolnames(1920): HSPC_007 HSPC_013 ... Prog_852 Prog_810\ncolData names(19): orig.ident nCount_endogenous ... sizeFactor ident\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\nAlso defined by 'SeuratObject'\n\n\nreducedDimNames(1): DIFFUSION\nmainExpName: endogenous\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\nAlso defined by 'SeuratObject'\n\n\naltExpNames(0):\n\n#\ncolData(sce)\n\nDataFrame with 1920 rows and 11 columns\n                gate       broad   broad.mpp        fine    fine.mpp     ESLAM      HSC1 projected             metrics       label sizeFactor\n         &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;logical&gt; &lt;logical&gt; &lt;logical&gt;         &lt;DataFrame&gt; &lt;character&gt;  &lt;numeric&gt;\nHSPC_007        HSPC          NA          NA          NA          NA     FALSE     FALSE     FALSE 194829:  5022:0:...        HSPC  0.0272469\nHSPC_013        HSPC        LMPP          NA        LMPP          NA     FALSE     FALSE     FALSE 110530: 15271:0:...        HSPC  0.0904215\nHSPC_019        HSPC        LMPP          NA          NA          NA     FALSE     FALSE     FALSE  86825:  2708:0:...        HSPC  0.0199211\nHSPC_025        HSPC         MPP        MPP1          NA          NA     FALSE     FALSE     FALSE 212206:107278:0:...        HSPC  0.5217920\nHSPC_031        HSPC         MPP       STHSC          NA          NA     FALSE     FALSE     FALSE 690411:227480:0:...        HSPC  1.1062306\n...              ...         ...         ...         ...         ...       ...       ...       ...                 ...         ...        ...\nProg_834        Prog         CMP          NA          NA          NA     FALSE     FALSE     FALSE 471273:296060:0:...        Prog   1.668383\nProg_840        Prog         GMP          NA         GMP          NA     FALSE     FALSE     FALSE 421195:317394:0:...        Prog   1.728596\nProg_846        Prog         GMP          NA          NA          NA     FALSE     FALSE     FALSE 337564:253387:0:...        Prog   1.282827\nProg_852        Prog         MEP          NA         MEP          NA     FALSE     FALSE     FALSE 200193:136478:0:...        Prog   0.643172\nProg_810        Prog         CMP          NA         CMP          NA     FALSE     FALSE     FALSE 857257:396247:0:...        Prog   2.614351\n\ncolData(sce2)\n\nDataFrame with 1920 rows and 19 columns\n         orig.ident nCount_endogenous nFeature_endogenous        gate       broad   broad.mpp        fine    fine.mpp     ESLAM      HSC1 projected metrics.X__no_feature metrics.X__ambiguous metrics.X__too_low_aQual metrics.X__not_aligned\n           &lt;factor&gt;         &lt;numeric&gt;           &lt;integer&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;logical&gt; &lt;logical&gt; &lt;logical&gt;             &lt;numeric&gt;            &lt;numeric&gt;                &lt;numeric&gt;              &lt;numeric&gt;\nHSPC_007       HSPC              1262                 381        HSPC          NA          NA          NA          NA     FALSE     FALSE     FALSE                194829                 5022                        0                5820455\nHSPC_013       HSPC              5906                 409        HSPC        LMPP          NA        LMPP          NA     FALSE     FALSE     FALSE                110530                15271                        0                1562724\nHSPC_019       HSPC              1002                 355        HSPC        LMPP          NA          NA          NA     FALSE     FALSE     FALSE                 86825                 2708                        0                1407254\nHSPC_025       HSPC             58177                 434        HSPC         MPP        MPP1          NA          NA     FALSE     FALSE     FALSE                212206               107278                        0                1810368\nHSPC_031       HSPC            118570                 435        HSPC         MPP       STHSC          NA          NA     FALSE     FALSE     FALSE                690411               227480                        0                6097116\n...             ...               ...                 ...         ...         ...         ...         ...         ...       ...       ...       ...                   ...                  ...                      ...                    ...\nProg_834       Prog            185771                 476        Prog         CMP          NA          NA          NA     FALSE     FALSE     FALSE                471273               296060                        0                4312094\nProg_840       Prog            245841                 484        Prog         GMP          NA         GMP          NA     FALSE     FALSE     FALSE                421195               317394                        0                3770447\nProg_846       Prog            199277                 483        Prog         GMP          NA          NA          NA     FALSE     FALSE     FALSE                337564               253387                        0                2549458\nProg_852       Prog             56543                 464        Prog         MEP          NA         MEP          NA     FALSE     FALSE     FALSE                200193               136478                        0                1442745\nProg_810       Prog            266651                 480        Prog         CMP          NA         CMP          NA     FALSE     FALSE     FALSE                857257               396247                        0                4518455\n         metrics.X__alignment_not_unique       label sizeFactor                ident\n                               &lt;numeric&gt; &lt;character&gt;  &lt;numeric&gt;             &lt;factor&gt;\nHSPC_007                               0        HSPC  0.0272469 SingleCellExperiment\nHSPC_013                               0        HSPC  0.0904215 SingleCellExperiment\nHSPC_019                               0        HSPC  0.0199211 SingleCellExperiment\nHSPC_025                               0        HSPC  0.5217920 SingleCellExperiment\nHSPC_031                               0        HSPC  1.1062306 SingleCellExperiment\n...                                  ...         ...        ...                  ...\nProg_834                               0        Prog   1.668383 SingleCellExperiment\nProg_840                               0        Prog   1.728596 SingleCellExperiment\nProg_846                               0        Prog   1.282827 SingleCellExperiment\nProg_852                               0        Prog   0.643172 SingleCellExperiment\nProg_810                               0        Prog   2.614351 SingleCellExperiment\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nTry and access the underlying raw or normalized data from the sce_seurat object. How does it compare to data access from an SingleCellExperiment object?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ncolnames(sce_seurat)\n\n\n   [1] \"HSPC_007\"   \"HSPC_013\"   \"HSPC_019\"   \"HSPC_025\"   \"HSPC_031\"   \"HSPC_037\"   \"LT-HSC_001\" \"HSPC_001\"   \"HSPC_008\"   \"HSPC_014\"   \"HSPC_020\"   \"HSPC_026\"   \"HSPC_032\"   \"HSPC_038\"   \"LT-HSC_002\" \"HSPC_002\"   \"HSPC_009\"   \"HSPC_015\"  \n  [19] \"HSPC_021\"   \"HSPC_027\"   \"HSPC_033\"   \"HSPC_039\"   \"LT-HSC_003\" \"HSPC_003\"   \"HSPC_010\"   \"HSPC_016\"   \"HSPC_022\"   \"HSPC_028\"   \"HSPC_034\"   \"HSPC_040\"   \"LT-HSC_004\" \"HSPC_004\"   \"HSPC_011\"   \"HSPC_017\"   \"HSPC_023\"   \"HSPC_029\"  \n  [37] \"HSPC_035\"   \"HSPC_041\"   \"LT-HSC_005\" \"HSPC_005\"   \"HSPC_012\"   \"HSPC_018\"   \"HSPC_024\"   \"HSPC_030\"   \"HSPC_036\"   \"HSPC_042\"   \"LT-HSC_006\" \"HSPC_006\"   \"Prog_007\"   \"Prog_013\"   \"Prog_019\"   \"Prog_025\"   \"Prog_031\"   \"Prog_037\"  \n  [55] \"LT-HSC_007\" \"Prog_001\"   \"Prog_008\"   \"Prog_014\"   \"Prog_020\"   \"Prog_026\"   \"Prog_032\"   \"Prog_038\"   \"LT-HSC_008\" \"Prog_002\"   \"Prog_009\"   \"Prog_015\"   \"Prog_021\"   \"Prog_027\"   \"Prog_033\"   \"Prog_039\"   \"LT-HSC_009\" \"Prog_003\"  \n  [73] \"Prog_010\"   \"Prog_016\"   \"Prog_022\"   \"Prog_028\"   \"Prog_034\"   \"Prog_040\"   \"LT-HSC_010\" \"Prog_004\"   \"Prog_011\"   \"Prog_017\"   \"Prog_023\"   \"Prog_029\"   \"Prog_035\"   \"Prog_041\"   \"LT-HSC_011\" \"Prog_005\"   \"Prog_012\"   \"Prog_018\"  \n  [91] \"Prog_024\"   \"Prog_030\"   \"Prog_036\"   \"Prog_042\"   \"LT-HSC_012\" \"Prog_006\"   \"HSPC_049\"   \"HSPC_055\"   \"HSPC_061\"   \"HSPC_067\"   \"HSPC_073\"   \"HSPC_079\"   \"LT-HSC_013\" \"HSPC_043\"   \"HSPC_050\"   \"HSPC_056\"   \"HSPC_062\"   \"HSPC_068\"  \n [109] \"HSPC_074\"   \"HSPC_080\"   \"LT-HSC_014\" \"HSPC_044\"   \"HSPC_051\"   \"HSPC_057\"   \"HSPC_063\"   \"HSPC_069\"   \"HSPC_075\"   \"HSPC_081\"   \"LT-HSC_015\" \"HSPC_045\"   \"HSPC_052\"   \"HSPC_058\"   \"HSPC_064\"   \"HSPC_070\"   \"HSPC_076\"   \"HSPC_082\"  \n [127] \"LT-HSC_016\" \"HSPC_046\"   \"HSPC_053\"   \"HSPC_059\"   \"HSPC_065\"   \"HSPC_071\"   \"HSPC_077\"   \"HSPC_083\"   \"LT-HSC_017\" \"HSPC_047\"   \"HSPC_054\"   \"HSPC_060\"   \"HSPC_066\"   \"HSPC_072\"   \"HSPC_078\"   \"HSPC_084\"   \"LT-HSC_018\" \"HSPC_048\"  \n [145] \"Prog_049\"   \"Prog_055\"   \"Prog_061\"   \"Prog_067\"   \"Prog_073\"   \"Prog_079\"   \"LT-HSC_019\" \"Prog_043\"   \"Prog_050\"   \"Prog_056\"   \"Prog_062\"   \"Prog_068\"   \"Prog_074\"   \"Prog_080\"   \"LT-HSC_020\" \"Prog_044\"   \"Prog_051\"   \"Prog_057\"  \n [163] \"Prog_063\"   \"Prog_069\"   \"Prog_075\"   \"Prog_081\"   \"LT-HSC_021\" \"Prog_045\"   \"Prog_052\"   \"Prog_058\"   \"Prog_064\"   \"Prog_070\"   \"Prog_076\"   \"Prog_082\"   \"LT-HSC_022\" \"Prog_046\"   \"Prog_053\"   \"Prog_059\"   \"Prog_065\"   \"Prog_071\"  \n [181] \"Prog_077\"   \"Prog_083\"   \"LT-HSC_023\" \"Prog_047\"   \"Prog_054\"   \"Prog_060\"   \"Prog_066\"   \"Prog_072\"   \"Prog_078\"   \"Prog_084\"   \"LT-HSC_024\" \"Prog_048\"   \"HSPC_091\"   \"HSPC_097\"   \"HSPC_103\"   \"HSPC_109\"   \"HSPC_115\"   \"HSPC_121\"  \n [199] \"LT-HSC_025\" \"HSPC_085\"   \"HSPC_092\"   \"HSPC_098\"   \"HSPC_104\"   \"HSPC_110\"   \"HSPC_116\"   \"HSPC_122\"   \"LT-HSC_026\" \"HSPC_086\"   \"HSPC_093\"   \"HSPC_099\"   \"HSPC_105\"   \"HSPC_111\"   \"HSPC_117\"   \"HSPC_123\"   \"LT-HSC_027\" \"HSPC_087\"  \n [217] \"HSPC_094\"   \"HSPC_100\"   \"HSPC_106\"   \"HSPC_112\"   \"HSPC_118\"   \"HSPC_124\"   \"LT-HSC_028\" \"HSPC_088\"   \"HSPC_095\"   \"HSPC_101\"   \"HSPC_107\"   \"HSPC_113\"   \"HSPC_119\"   \"HSPC_125\"   \"LT-HSC_029\" \"HSPC_089\"   \"HSPC_096\"   \"HSPC_102\"  \n [235] \"HSPC_108\"   \"HSPC_114\"   \"HSPC_120\"   \"HSPC_126\"   \"LT-HSC_030\" \"HSPC_090\"   \"Prog_091\"   \"Prog_097\"   \"Prog_103\"   \"Prog_109\"   \"Prog_115\"   \"Prog_121\"   \"LT-HSC_031\" \"Prog_085\"   \"Prog_092\"   \"Prog_098\"   \"Prog_104\"   \"Prog_110\"  \n [253] \"Prog_116\"   \"Prog_122\"   \"LT-HSC_032\" \"Prog_086\"   \"Prog_093\"   \"Prog_099\"   \"Prog_105\"   \"Prog_111\"   \"Prog_117\"   \"Prog_123\"   \"LT-HSC_033\" \"Prog_087\"   \"Prog_094\"   \"Prog_100\"   \"Prog_106\"   \"Prog_112\"   \"Prog_118\"   \"Prog_124\"  \n [271] \"LT-HSC_034\" \"Prog_088\"   \"Prog_095\"   \"Prog_101\"   \"Prog_107\"   \"Prog_113\"   \"Prog_119\"   \"Prog_125\"   \"LT-HSC_035\" \"Prog_089\"   \"Prog_096\"   \"Prog_102\"   \"Prog_108\"   \"Prog_114\"   \"Prog_120\"   \"Prog_126\"   \"LT-HSC_036\" \"Prog_090\"  \n [289] \"HSPC_133\"   \"HSPC_139\"   \"HSPC_145\"   \"HSPC_151\"   \"HSPC_157\"   \"HSPC_163\"   \"LT-HSC_037\" \"HSPC_127\"   \"HSPC_134\"   \"HSPC_140\"   \"HSPC_146\"   \"HSPC_152\"   \"HSPC_158\"   \"HSPC_164\"   \"LT-HSC_038\" \"HSPC_128\"   \"HSPC_135\"   \"HSPC_141\"  \n [307] \"HSPC_147\"   \"HSPC_153\"   \"HSPC_159\"   \"HSPC_165\"   \"LT-HSC_039\" \"HSPC_129\"   \"HSPC_136\"   \"HSPC_142\"   \"HSPC_148\"   \"HSPC_154\"   \"HSPC_160\"   \"HSPC_166\"   \"LT-HSC_040\" \"HSPC_130\"   \"HSPC_137\"   \"HSPC_143\"   \"HSPC_149\"   \"HSPC_155\"  \n [325] \"HSPC_161\"   \"HSPC_167\"   \"LT-HSC_041\" \"HSPC_131\"   \"HSPC_138\"   \"HSPC_144\"   \"HSPC_150\"   \"HSPC_156\"   \"HSPC_162\"   \"HSPC_168\"   \"LT-HSC_042\" \"HSPC_132\"   \"Prog_133\"   \"Prog_139\"   \"Prog_145\"   \"Prog_151\"   \"Prog_157\"   \"Prog_163\"  \n [343] \"LT-HSC_043\" \"Prog_127\"   \"Prog_134\"   \"Prog_140\"   \"Prog_146\"   \"Prog_152\"   \"Prog_158\"   \"Prog_164\"   \"LT-HSC_044\" \"Prog_128\"   \"Prog_135\"   \"Prog_141\"   \"Prog_147\"   \"Prog_153\"   \"Prog_159\"   \"Prog_165\"   \"LT-HSC_045\" \"Prog_129\"  \n [361] \"Prog_136\"   \"Prog_142\"   \"Prog_148\"   \"Prog_154\"   \"Prog_160\"   \"Prog_166\"   \"LT-HSC_046\" \"Prog_130\"   \"Prog_137\"   \"Prog_143\"   \"Prog_149\"   \"Prog_155\"   \"Prog_161\"   \"Prog_167\"   \"LT-HSC_047\" \"Prog_131\"   \"Prog_138\"   \"Prog_144\"  \n [379] \"Prog_150\"   \"Prog_156\"   \"Prog_162\"   \"Prog_168\"   \"LT-HSC_048\" \"Prog_132\"   \"HSPC_175\"   \"HSPC_181\"   \"HSPC_187\"   \"HSPC_193\"   \"HSPC_199\"   \"HSPC_205\"   \"LT-HSC_049\" \"HSPC_169\"   \"HSPC_176\"   \"HSPC_182\"   \"HSPC_188\"   \"HSPC_194\"  \n [397] \"HSPC_200\"   \"HSPC_206\"   \"LT-HSC_050\" \"HSPC_170\"   \"HSPC_177\"   \"HSPC_183\"   \"HSPC_189\"   \"HSPC_195\"   \"HSPC_201\"   \"HSPC_207\"   \"LT-HSC_051\" \"HSPC_171\"   \"HSPC_178\"   \"HSPC_184\"   \"HSPC_190\"   \"HSPC_196\"   \"HSPC_202\"   \"HSPC_208\"  \n [415] \"LT-HSC_052\" \"HSPC_172\"   \"HSPC_179\"   \"HSPC_185\"   \"HSPC_191\"   \"HSPC_197\"   \"HSPC_203\"   \"HSPC_209\"   \"LT-HSC_053\" \"HSPC_173\"   \"HSPC_180\"   \"HSPC_186\"   \"HSPC_192\"   \"HSPC_198\"   \"HSPC_204\"   \"HSPC_210\"   \"LT-HSC_054\" \"HSPC_174\"  \n [433] \"Prog_175\"   \"Prog_181\"   \"Prog_187\"   \"Prog_193\"   \"Prog_199\"   \"Prog_205\"   \"LT-HSC_055\" \"Prog_169\"   \"Prog_176\"   \"Prog_182\"   \"Prog_188\"   \"Prog_194\"   \"Prog_200\"   \"Prog_206\"   \"LT-HSC_056\" \"Prog_170\"   \"Prog_177\"   \"Prog_183\"  \n [451] \"Prog_189\"   \"Prog_195\"   \"Prog_201\"   \"Prog_207\"   \"LT-HSC_057\" \"Prog_171\"   \"Prog_178\"   \"Prog_184\"   \"Prog_190\"   \"Prog_196\"   \"Prog_202\"   \"Prog_208\"   \"LT-HSC_058\" \"Prog_172\"   \"Prog_179\"   \"Prog_185\"   \"Prog_191\"   \"Prog_197\"  \n [469] \"Prog_203\"   \"Prog_209\"   \"LT-HSC_059\" \"Prog_173\"   \"Prog_180\"   \"Prog_186\"   \"Prog_192\"   \"Prog_198\"   \"Prog_204\"   \"Prog_210\"   \"LT-HSC_060\" \"Prog_174\"   \"HSPC_217\"   \"HSPC_223\"   \"HSPC_229\"   \"HSPC_235\"   \"HSPC_241\"   \"HSPC_247\"  \n [487] \"LT-HSC_061\" \"HSPC_211\"   \"HSPC_218\"   \"HSPC_224\"   \"HSPC_230\"   \"HSPC_236\"   \"HSPC_242\"   \"HSPC_248\"   \"LT-HSC_062\" \"HSPC_212\"   \"HSPC_219\"   \"HSPC_225\"   \"HSPC_231\"   \"HSPC_237\"   \"HSPC_243\"   \"HSPC_249\"   \"LT-HSC_063\" \"HSPC_213\"  \n [505] \"HSPC_220\"   \"HSPC_226\"   \"HSPC_232\"   \"HSPC_238\"   \"HSPC_244\"   \"HSPC_250\"   \"LT-HSC_064\" \"HSPC_214\"   \"HSPC_221\"   \"HSPC_227\"   \"HSPC_233\"   \"HSPC_239\"   \"HSPC_245\"   \"HSPC_251\"   \"LT-HSC_065\" \"HSPC_215\"   \"HSPC_222\"   \"HSPC_228\"  \n [523] \"HSPC_234\"   \"HSPC_240\"   \"HSPC_246\"   \"HSPC_252\"   \"LT-HSC_066\" \"HSPC_216\"   \"Prog_217\"   \"Prog_223\"   \"Prog_229\"   \"Prog_235\"   \"Prog_241\"   \"Prog_247\"   \"LT-HSC_067\" \"Prog_211\"   \"Prog_218\"   \"Prog_224\"   \"Prog_230\"   \"Prog_236\"  \n [541] \"Prog_242\"   \"Prog_248\"   \"LT-HSC_068\" \"Prog_212\"   \"Prog_219\"   \"Prog_225\"   \"Prog_231\"   \"Prog_237\"   \"Prog_243\"   \"Prog_249\"   \"LT-HSC_069\" \"Prog_213\"   \"Prog_220\"   \"Prog_226\"   \"Prog_232\"   \"Prog_238\"   \"Prog_244\"   \"Prog_250\"  \n [559] \"LT-HSC_070\" \"Prog_214\"   \"Prog_221\"   \"Prog_227\"   \"Prog_233\"   \"Prog_239\"   \"Prog_245\"   \"Prog_251\"   \"LT-HSC_071\" \"Prog_215\"   \"Prog_222\"   \"Prog_228\"   \"Prog_234\"   \"Prog_240\"   \"Prog_246\"   \"Prog_252\"   \"LT-HSC_072\" \"Prog_216\"  \n [577] \"HSPC_259\"   \"HSPC_265\"   \"HSPC_271\"   \"HSPC_277\"   \"HSPC_283\"   \"HSPC_289\"   \"LT-HSC_073\" \"HSPC_253\"   \"HSPC_260\"   \"HSPC_266\"   \"HSPC_272\"   \"HSPC_278\"   \"HSPC_284\"   \"HSPC_290\"   \"LT-HSC_074\" \"HSPC_254\"   \"HSPC_261\"   \"HSPC_267\"  \n [595] \"HSPC_273\"   \"HSPC_279\"   \"HSPC_285\"   \"HSPC_291\"   \"LT-HSC_075\" \"HSPC_255\"   \"HSPC_262\"   \"HSPC_268\"   \"HSPC_274\"   \"HSPC_280\"   \"HSPC_286\"   \"HSPC_292\"   \"LT-HSC_076\" \"HSPC_256\"   \"HSPC_263\"   \"HSPC_269\"   \"HSPC_275\"   \"HSPC_281\"  \n [613] \"HSPC_287\"   \"HSPC_293\"   \"LT-HSC_077\" \"HSPC_257\"   \"HSPC_264\"   \"HSPC_270\"   \"HSPC_276\"   \"HSPC_282\"   \"HSPC_288\"   \"HSPC_294\"   \"LT-HSC_078\" \"HSPC_258\"   \"Prog_259\"   \"Prog_265\"   \"Prog_271\"   \"Prog_277\"   \"Prog_283\"   \"Prog_289\"  \n [631] \"LT-HSC_079\" \"Prog_253\"   \"Prog_260\"   \"Prog_266\"   \"Prog_272\"   \"Prog_278\"   \"Prog_284\"   \"Prog_290\"   \"LT-HSC_080\" \"Prog_254\"   \"Prog_261\"   \"Prog_267\"   \"Prog_273\"   \"Prog_279\"   \"Prog_285\"   \"Prog_291\"   \"LT-HSC_081\" \"Prog_255\"  \n [649] \"Prog_262\"   \"Prog_268\"   \"Prog_274\"   \"Prog_280\"   \"Prog_286\"   \"Prog_292\"   \"LT-HSC_082\" \"Prog_256\"   \"Prog_263\"   \"Prog_269\"   \"Prog_275\"   \"Prog_281\"   \"Prog_287\"   \"Prog_293\"   \"LT-HSC_083\" \"Prog_257\"   \"Prog_264\"   \"Prog_270\"  \n [667] \"Prog_276\"   \"Prog_282\"   \"Prog_288\"   \"Prog_294\"   \"LT-HSC_084\" \"Prog_258\"   \"HSPC_301\"   \"HSPC_307\"   \"HSPC_313\"   \"HSPC_319\"   \"HSPC_325\"   \"HSPC_331\"   \"LT-HSC_085\" \"HSPC_295\"   \"HSPC_302\"   \"HSPC_308\"   \"HSPC_314\"   \"HSPC_320\"  \n [685] \"HSPC_326\"   \"HSPC_332\"   \"LT-HSC_086\" \"HSPC_296\"   \"HSPC_303\"   \"HSPC_309\"   \"HSPC_315\"   \"HSPC_321\"   \"HSPC_327\"   \"HSPC_333\"   \"LT-HSC_087\" \"HSPC_297\"   \"HSPC_304\"   \"HSPC_310\"   \"HSPC_316\"   \"HSPC_322\"   \"HSPC_328\"   \"HSPC_334\"  \n [703] \"LT-HSC_088\" \"HSPC_298\"   \"HSPC_305\"   \"HSPC_311\"   \"HSPC_317\"   \"HSPC_323\"   \"HSPC_329\"   \"HSPC_335\"   \"LT-HSC_089\" \"HSPC_299\"   \"HSPC_306\"   \"HSPC_312\"   \"HSPC_318\"   \"HSPC_324\"   \"HSPC_330\"   \"HSPC_336\"   \"LT-HSC_090\" \"HSPC_300\"  \n [721] \"Prog_301\"   \"Prog_307\"   \"Prog_313\"   \"Prog_319\"   \"Prog_325\"   \"Prog_331\"   \"LT-HSC_091\" \"Prog_295\"   \"Prog_302\"   \"Prog_308\"   \"Prog_314\"   \"Prog_320\"   \"Prog_326\"   \"Prog_332\"   \"LT-HSC_092\" \"Prog_296\"   \"Prog_303\"   \"Prog_309\"  \n [739] \"Prog_315\"   \"Prog_321\"   \"Prog_327\"   \"Prog_333\"   \"LT-HSC_093\" \"Prog_297\"   \"Prog_304\"   \"Prog_310\"   \"Prog_316\"   \"Prog_322\"   \"Prog_328\"   \"Prog_334\"   \"LT-HSC_094\" \"Prog_298\"   \"Prog_305\"   \"Prog_311\"   \"Prog_317\"   \"Prog_323\"  \n [757] \"Prog_329\"   \"Prog_335\"   \"LT-HSC_095\" \"Prog_299\"   \"Prog_306\"   \"Prog_312\"   \"Prog_318\"   \"Prog_324\"   \"Prog_330\"   \"Prog_336\"   \"LT-HSC_096\" \"Prog_300\"   \"HSPC_343\"   \"HSPC_349\"   \"HSPC_355\"   \"HSPC_361\"   \"HSPC_367\"   \"HSPC_373\"  \n [775] \"LT-HSC_097\" \"HSPC_337\"   \"HSPC_344\"   \"HSPC_350\"   \"HSPC_356\"   \"HSPC_362\"   \"HSPC_368\"   \"HSPC_374\"   \"LT-HSC_098\" \"HSPC_338\"   \"HSPC_345\"   \"HSPC_351\"   \"HSPC_357\"   \"HSPC_363\"   \"HSPC_369\"   \"HSPC_375\"   \"LT-HSC_099\" \"HSPC_339\"  \n [793] \"HSPC_346\"   \"HSPC_352\"   \"HSPC_358\"   \"HSPC_364\"   \"HSPC_370\"   \"HSPC_376\"   \"LT-HSC_100\" \"HSPC_340\"   \"HSPC_347\"   \"HSPC_353\"   \"HSPC_359\"   \"HSPC_365\"   \"HSPC_371\"   \"HSPC_377\"   \"LT-HSC_101\" \"HSPC_341\"   \"HSPC_348\"   \"HSPC_354\"  \n [811] \"HSPC_360\"   \"HSPC_366\"   \"HSPC_372\"   \"HSPC_378\"   \"LT-HSC_102\" \"HSPC_342\"   \"Prog_343\"   \"Prog_349\"   \"Prog_355\"   \"Prog_361\"   \"Prog_367\"   \"Prog_373\"   \"LT-HSC_103\" \"Prog_337\"   \"Prog_344\"   \"Prog_350\"   \"Prog_356\"   \"Prog_362\"  \n [829] \"Prog_368\"   \"Prog_374\"   \"LT-HSC_104\" \"Prog_338\"   \"Prog_345\"   \"Prog_351\"   \"Prog_357\"   \"Prog_363\"   \"Prog_369\"   \"Prog_375\"   \"LT-HSC_105\" \"Prog_339\"   \"Prog_346\"   \"Prog_352\"   \"Prog_358\"   \"Prog_364\"   \"Prog_370\"   \"Prog_376\"  \n [847] \"LT-HSC_106\" \"Prog_340\"   \"Prog_347\"   \"Prog_353\"   \"Prog_359\"   \"Prog_365\"   \"Prog_371\"   \"Prog_377\"   \"LT-HSC_107\" \"Prog_341\"   \"Prog_348\"   \"Prog_354\"   \"Prog_360\"   \"Prog_366\"   \"Prog_372\"   \"Prog_378\"   \"LT-HSC_108\" \"Prog_342\"  \n [865] \"HSPC_385\"   \"HSPC_391\"   \"HSPC_397\"   \"HSPC_403\"   \"HSPC_409\"   \"HSPC_415\"   \"HSPC_421\"   \"HSPC_379\"   \"HSPC_386\"   \"HSPC_392\"   \"HSPC_398\"   \"HSPC_404\"   \"HSPC_410\"   \"HSPC_416\"   \"HSPC_422\"   \"HSPC_380\"   \"HSPC_387\"   \"HSPC_393\"  \n [883] \"HSPC_399\"   \"HSPC_405\"   \"HSPC_411\"   \"HSPC_417\"   \"HSPC_423\"   \"HSPC_381\"   \"HSPC_388\"   \"HSPC_394\"   \"HSPC_400\"   \"HSPC_406\"   \"HSPC_412\"   \"HSPC_418\"   \"HSPC_424\"   \"HSPC_382\"   \"HSPC_389\"   \"HSPC_395\"   \"HSPC_401\"   \"HSPC_407\"  \n [901] \"HSPC_413\"   \"HSPC_419\"   \"HSPC_425\"   \"HSPC_383\"   \"HSPC_390\"   \"HSPC_396\"   \"HSPC_402\"   \"HSPC_408\"   \"HSPC_414\"   \"HSPC_420\"   \"HSPC_426\"   \"HSPC_384\"   \"Prog_385\"   \"Prog_391\"   \"Prog_397\"   \"Prog_403\"   \"Prog_409\"   \"Prog_415\"  \n [919] \"Prog_421\"   \"Prog_379\"   \"Prog_386\"   \"Prog_392\"   \"Prog_398\"   \"Prog_404\"   \"Prog_410\"   \"Prog_416\"   \"Prog_422\"   \"Prog_380\"   \"Prog_387\"   \"Prog_393\"   \"Prog_399\"   \"Prog_405\"   \"Prog_411\"   \"Prog_417\"   \"Prog_423\"   \"Prog_381\"  \n [937] \"Prog_388\"   \"Prog_394\"   \"Prog_400\"   \"Prog_406\"   \"Prog_412\"   \"Prog_418\"   \"Prog_424\"   \"Prog_382\"   \"Prog_389\"   \"Prog_395\"   \"Prog_401\"   \"Prog_407\"   \"Prog_413\"   \"Prog_419\"   \"Prog_425\"   \"Prog_383\"   \"Prog_390\"   \"Prog_396\"  \n [955] \"Prog_402\"   \"Prog_408\"   \"Prog_414\"   \"Prog_420\"   \"Prog_426\"   \"Prog_384\"   \"HSPC_433\"   \"HSPC_439\"   \"HSPC_445\"   \"HSPC_451\"   \"HSPC_457\"   \"HSPC_463\"   \"LT-HSC_109\" \"HSPC_427\"   \"HSPC_434\"   \"HSPC_440\"   \"HSPC_446\"   \"HSPC_452\"  \n [973] \"HSPC_458\"   \"HSPC_464\"   \"LT-HSC_110\" \"HSPC_428\"   \"HSPC_435\"   \"HSPC_441\"   \"HSPC_447\"   \"HSPC_453\"   \"HSPC_459\"   \"HSPC_465\"   \"LT-HSC_111\" \"HSPC_429\"   \"HSPC_436\"   \"HSPC_442\"   \"HSPC_448\"   \"HSPC_454\"   \"HSPC_460\"   \"HSPC_466\"  \n [991] \"LT-HSC_112\" \"HSPC_430\"   \"HSPC_437\"   \"HSPC_443\"   \"HSPC_449\"   \"HSPC_455\"   \"HSPC_461\"   \"HSPC_467\"   \"LT-HSC_113\" \"HSPC_431\"  \n [ reached 'max' / getOption(\"max.print\") -- omitted 920 entries ]\n\nncol(sce_seurat)\n\n[1] 1920\n\nnrow(sce_seurat)\n\n[1] 500\n\n# cells and features access\nhead(Seurat::Cells(sce_seurat))\n\n[1] \"HSPC_007\" \"HSPC_013\" \"HSPC_019\" \"HSPC_025\" \"HSPC_031\" \"HSPC_037\"\n\nhead(rownames(sce_seurat))\n\n[1] \"ENSMUSG00000076609\" \"ENSMUSG00000021250\" \"ENSMUSG00000076617\" \"ENSMUSG00000075602\" \"ENSMUSG00000006389\" \"ENSMUSG00000041481\"\n\n# cell data access\nhead(sce_seurat[[]])\n\n         orig.ident nCount_endogenous nFeature_endogenous gate broad broad.mpp fine fine.mpp ESLAM  HSC1 projected metrics.X__no_feature metrics.X__ambiguous metrics.X__too_low_aQual metrics.X__not_aligned metrics.X__alignment_not_unique\nHSPC_007       HSPC              1262                 381 HSPC  &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt;     &lt;NA&gt; FALSE FALSE     FALSE                194829                 5022                        0                5820455                               0\nHSPC_013       HSPC              5906                 409 HSPC  LMPP      &lt;NA&gt; LMPP     &lt;NA&gt; FALSE FALSE     FALSE                110530                15271                        0                1562724                               0\nHSPC_019       HSPC              1002                 355 HSPC  LMPP      &lt;NA&gt; &lt;NA&gt;     &lt;NA&gt; FALSE FALSE     FALSE                 86825                 2708                        0                1407254                               0\nHSPC_025       HSPC             58177                 434 HSPC   MPP      MPP1 &lt;NA&gt;     &lt;NA&gt; FALSE FALSE     FALSE                212206               107278                        0                1810368                               0\nHSPC_031       HSPC            118570                 435 HSPC   MPP     STHSC &lt;NA&gt;     &lt;NA&gt; FALSE FALSE     FALSE                690411               227480                        0                6097116                               0\nHSPC_037       HSPC             54029                 445 HSPC   MPP     STHSC &lt;NA&gt;     &lt;NA&gt; FALSE FALSE     FALSE                242472               126874                        0                2267894                               0\n         label sizeFactor\nHSPC_007  HSPC 0.02724693\nHSPC_013  HSPC 0.09042153\nHSPC_019  HSPC 0.01992108\nHSPC_025  HSPC 0.52179199\nHSPC_031  HSPC 1.10623062\nHSPC_037  HSPC 0.51431538\n\nhead(sce_seurat$label)\n\nHSPC_007 HSPC_013 HSPC_019 HSPC_025 HSPC_031 HSPC_037 \n  \"HSPC\"   \"HSPC\"   \"HSPC\"   \"HSPC\"   \"HSPC\"   \"HSPC\" \n\n# Counts access\nSeurat::GetAssayData(object = sce_seurat, layer = \"counts\")[1:10, 1:10]\n\n10 x 10 sparse Matrix of class \"dgCMatrix\"\n\n\n  [[ suppressing 10 column names 'HSPC_007', 'HSPC_013', 'HSPC_019' ... ]]\n\n\n                                                            \nENSMUSG00000076609 30  16  7   17  19   11 1359   13  15   6\nENSMUSG00000021250  3   2  4    .   1    3  118    2  69  41\nENSMUSG00000076617 40  54 13   29 298  417 1107    9  16  15\nENSMUSG00000075602  3 248  7  537 640    7  300 1530 324 971\nENSMUSG00000006389  3   4  1 1171   6    2  271 5497 293 192\nENSMUSG00000041481  3   .  1    3   1    3  177    5   1 192\nENSMUSG00000024190  1  29  1 1733   1    5   20    3   1   1\nENSMUSG00000003949  4  15  3  175 915 1131   41 1465 330 258\nENSMUSG00000052684  1   4  2  144  82    5  142  578   .  78\nENSMUSG00000026358  .  27  6  344   3    9    3 3612 185   .\n\nSeurat::GetAssayData(object = sce_seurat, layer = \"data\")[1:10, 1:10]\n\n10 x 10 sparse Matrix of class \"dgCMatrix\"\n\n\n  [[ suppressing 10 column names 'HSPC_007', 'HSPC_013', 'HSPC_019' ... ]]\n\n\n                                                                                                                     \nENSMUSG00000076609 10.105963  7.475320 8.461015  5.069532 4.1839186  4.484632 13.057990  2.7927556 4.907536  4.256554\nENSMUSG00000021250  6.795769  4.530984 7.656727  .        0.9290112  2.772518  9.534081  0.9352591 7.071052  6.963227\nENSMUSG00000076617 10.520673  9.224491 9.352209  5.822162 8.0788620  9.664957 12.762138  2.3519259 4.997638  5.532469\nENSMUSG00000075602  6.795769 11.421912 8.461015 10.008633 9.1787674  3.868916 10.879076  9.4488576 9.293908 11.517886\nENSMUSG00000006389  6.795769  5.499439 5.678018 11.132621 2.6834323  2.289440 10.732488 11.2924799 9.149058  9.181516\nENSMUSG00000041481  6.795769  .        5.678018  2.754763 0.9290112  2.772518 10.118395  1.7139531 1.552981  9.181516\nENSMUSG00000024190  5.236545  8.329662 5.678018 11.697944 0.9290112  3.422457  6.982870  1.2438829 1.552981  2.006833\nENSMUSG00000003949  7.207556  7.382751 7.244071  8.393960 9.6937189 11.103314  8.012640  9.3863182 9.320338  9.607145\nENSMUSG00000052684  5.236545  5.499439 6.663859  8.113597 6.2312326  3.422457  9.800857  8.0478635 .         7.885582\nENSMUSG00000026358  .         8.226901 8.239305  9.366905 1.8921625  4.209375  4.309131 10.6869334 8.487165  .       \n\n# Embeddings \nhead(Seurat::Embeddings(object = sce_seurat, reduction = \"diffusion\"))\n\n                DC_1         DC_2       DC_3\nHSPC_007          NA           NA         NA\nHSPC_013          NA           NA         NA\nHSPC_019          NA           NA         NA\nHSPC_025 -0.01101623 -0.001401563 0.01644595\nHSPC_031 -0.01378359 -0.011040897 0.01367213\nHSPC_037 -0.01377982 -0.003303141 0.03332661",
    "crumbs": [
      "Day 2",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Lab 3: Introduction to R/Bioconductor</span>"
    ]
  },
  {
    "objectID": "content/day2/Lab3_Rbioc.html#reading-scrnaseq-data",
    "href": "content/day2/Lab3_Rbioc.html#reading-scrnaseq-data",
    "title": "\n6  Lab 3: Introduction to R/Bioconductor\n",
    "section": "\n6.4 Reading scRNAseq data",
    "text": "6.4 Reading scRNAseq data\n\n\n\n\n\n\nQuestion\n\n\n\nTry to load the raw 10X single-cell RNA-seq data downloaded yesterday (from Lier et al.) into a SingleCellExperiment object using DropletUtils package\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nlibrary(SingleCellExperiment)\nsce &lt;- DropletUtils::read10xCounts('~/Share/data_wrangling/counts/outs/filtered_feature_bc_matrix.h5')\nsce\n\n\nclass: SingleCellExperiment \ndim: 32285 686 \nmetadata(1): Samples\nassays(1): counts\nrownames(32285): ENSMUSG00000051951 ENSMUSG00000089699 ... ENSMUSG00000095019 ENSMUSG00000095041\nrowData names(3): ID Symbol Type\ncolnames: NULL\ncolData names(2): Sample Barcode\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nreducedDimNames(0):\nmainExpName: NULL\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\nAlso defined by 'SeuratObject'\n\n\naltExpNames(0):\n\ncolData(sce)\n\nDataFrame with 686 rows and 2 columns\n                    Sample            Barcode\n               &lt;character&gt;        &lt;character&gt;\n1   ~/Share/data_wrangli.. AAACCTGAGGGTCTCC-1\n2   ~/Share/data_wrangli.. AAACCTGCACGGCGTT-1\n3   ~/Share/data_wrangli.. AAACGGGTCTGCAAGT-1\n4   ~/Share/data_wrangli.. AAAGATGGTTCGAATC-1\n5   ~/Share/data_wrangli.. AAAGCAAAGGTGGGTT-1\n...                    ...                ...\n682 ~/Share/data_wrangli.. TTTCCTCAGACTCGGA-1\n683 ~/Share/data_wrangli.. TTTCCTCTCGGAGGTA-1\n684 ~/Share/data_wrangli.. TTTGTCAAGTGTCCCG-1\n685 ~/Share/data_wrangli.. TTTGTCACATGGAATA-1\n686 ~/Share/data_wrangli.. TTTGTCAGTCGAGATG-1\n\nrowData(sce)\n\nDataFrame with 32285 rows and 3 columns\n                                   ID      Symbol            Type\n                          &lt;character&gt; &lt;character&gt;     &lt;character&gt;\nENSMUSG00000051951 ENSMUSG00000051951        Xkr4 Gene Expression\nENSMUSG00000089699 ENSMUSG00000089699      Gm1992 Gene Expression\nENSMUSG00000102331 ENSMUSG00000102331     Gm19938 Gene Expression\nENSMUSG00000102343 ENSMUSG00000102343     Gm37381 Gene Expression\nENSMUSG00000025900 ENSMUSG00000025900         Rp1 Gene Expression\n...                               ...         ...             ...\nENSMUSG00000095523 ENSMUSG00000095523  AC124606.1 Gene Expression\nENSMUSG00000095475 ENSMUSG00000095475  AC133095.2 Gene Expression\nENSMUSG00000094855 ENSMUSG00000094855  AC133095.1 Gene Expression\nENSMUSG00000095019 ENSMUSG00000095019  AC234645.1 Gene Expression\nENSMUSG00000095041 ENSMUSG00000095041  AC149090.1 Gene Expression\n\n\n\n\n\n\n\nPublic single-cell RNA-seq data can be retrieved from within R directly, thanks to several data packages, for instance scRNAseq or HCAData.\n\n\n\n\n\n\nQuestion\n\n\n\nCheck out the He et al., Genome Biol. 2020 paper. Can you find a way to load the scRNAseq data from this paper without having to leave the R console?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\norgans &lt;- scRNAseq::HeOrganAtlasData(ensembl = TRUE)\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\n\nloading from cache\n\n\nWarning: Unable to map 1056 of 12021 requested IDs.\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\n\n\nAlso defined by 'SeuratObject'\n\norgans\n\nclass: SingleCellExperiment \ndim: 10965 84363 \nmetadata(0):\nassays(1): counts\nrownames(10965): ENSG00000225880 ENSG00000188976 ... ENSG00000273748 ENSG00000271254\nrowData names(1): originalName\ncolnames(84363): AAACCTGAGACACTAA-1 AAACCTGAGCATGGCA-1 ... TTTGTCATCTCTAGGA-1 TTTGTCATCTGCGACG-1\ncolData names(10): Tissue nCount_RNA ... reclustered.broad reclustered.fine\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\nAlso defined by 'SeuratObject'\n\n\nreducedDimNames(1): TSNE\nmainExpName: NULL\n\n\nFound more than one class \"package_version\" in cache; using the first, from namespace 'alabaster.base'\nAlso defined by 'SeuratObject'\n\n\naltExpNames(0):\n\n\n\n\n\n\n\nThe interest of this approach is that one can recover a full-fledged SingleCellExperiment (often) provided by the authors of the corresponding study. This means that lots of information, such as batch ID, clustering, cell annotation, etc., may be readily available.\n\n\n\n\n\n\nQuestion\n\n\n\nCheck the data available for cells/features in the dataset from He et al..\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ncolData(organs)\n\n\nDataFrame with 84363 rows and 10 columns\n                        Tissue nCount_RNA nFeature_RNA percent.mito RNA_snn_res.orig seurat_clusters Cell_type_in_each_tissue Cell_type_in_merged_data reclustered.broad   reclustered.fine\n                   &lt;character&gt;  &lt;integer&gt;    &lt;integer&gt;    &lt;numeric&gt;        &lt;integer&gt;       &lt;integer&gt;              &lt;character&gt;              &lt;character&gt;       &lt;character&gt;        &lt;character&gt;\nAAACCTGAGACACTAA-1     Bladder       1152          610    0.0789931                7              15         Monocyte Bladder                 Monocyte           Myeloid Classical_Mon_AQP9\nAAACCTGAGCATGGCA-1     Bladder       3551         1415    0.0568854               14               8   Macrophage HLA-DPB1_..          Macrophage C1QB           Myeloid               cDC2\nAAACCTGAGCTGAACG-1     Bladder       1842          632    0.0266015                4               1   T Cell IL7R_high Bla..              T Cell IL7R               CD4           TCM_KLF2\nAAACCTGCAAGCTGGA-1     Bladder       1599          890    0.0268918               13              13   Fibroblast APOD_high..         Fibroblast PTGDS            FibSmo    Fib_CHI3L1_high\nAAACCTGCATTACCTT-1     Bladder       1347          613    0.0541945                1               2   T Cell CCL5_high Bla..              T Cell XCL1                NA                 NA\n...                        ...        ...          ...          ...              ...             ...                      ...                      ...               ...                ...\nTTTGTCATCAGTTGAC-1     Trachea       3334         1461    0.0422915               13              36           B Cell Trachea             B Cell MS4A1      B_and_plasma       Memory_B_TNF\nTTTGTCATCATCATTC-1     Trachea       6634         2271    0.0611999                7               8   Macrophage/Monocyte ..          Macrophage C1QB           Myeloid           Mac_SPP1\nTTTGTCATCTACGAGT-1     Trachea       2255          769    0.2119734               13               2           B Cell Trachea              T Cell XCL1      B_and_plasma    Plasma_IGKV3-20\nTTTGTCATCTCTAGGA-1     Trachea       1568          832    0.0554847                0              21   CD8 T Cell CCL5_high..              T Cell CCL5               CD8           TRM_PRR4\nTTTGTCATCTGCGACG-1     Trachea       1907          999    0.0167803               18              20        NK/T Cell Trachea           NK/T Cell GNLY                NA                 NA\n\ntable(organs$Tissue)\n\n\n         Bladder            Blood Common.bile.duct        Esophagus            Heart            Liver       Lymph.node           Marrow           Muscle           Rectum             Skin  Small.intestine           Spleen          Stomach \n            7572             1407             3160             9117             7881             2839             7771             3230             5732             6280             7710             4312             4512             5318 \n         Trachea \n            7522 \n\ntable(organs$reclustered.fine, organs$Tissue)\n\n                                               \n                                                Bladder Blood Common.bile.duct Esophagus Heart Liver Lymph.node Marrow Muscle Rectum Skin Small.intestine Spleen Stomach Trachea\n  Absorptive Cell                                     0     0                0         0     0     0          0      0      0      0    0             170      0       0       0\n  Basal Epithelial Cell APOE_high                     4     0                0         3     0     0          0      0      0      0  504               1      0       0       1\n  Basal Epithelial Cell IFITM1_high                   0     0                1         2     0     0          0      0      0      0    0               0      0       0     441\n  Basal Epithelial Cell MMP10_high                    0     0                0         0     0     0          0      0      0      0    0               0      0       0    1747\n  Basal Epithelial Cell POSTN_high                    0     0                0         0     0     0          0      0      0      0  545               0      0       0       0\n  Basal Epithelial Cell SERPINB3_high                 0     0                0         0     0     0          0      0      0      0    0               0      0       0     839\n  BEC_ACKR1                                         105     0                2       177   589     2          0      0    179     38   60               0      0       3      55\n  BEC_APOC1                                           0     0                0         0     3     2          0      0     49      0    0               0      0       0       0\n  BEC_CA4                                            13     0                1        13   824     9          0      0     53      6    3               0      0       1       7\n  BEC_CTSC                                           38     0                0        66    38     1          0      0     12      1 1058               0      0       0      70\n  BEC_FABP4                                           3     0                0         1    22     0          0      0    740      1    1               0      0       0       2\n  BEC_IGFBP3                                         19     0               13        63   201    27          0      0     41     18  245               0      0       7      56\n  BEC_PHLDA1                                         80     0                6       449    36     1          0      0      2      3   56               0      0       1      29\n  BEC_PRSS23                                          5     0               74         0     0     3          0      0      0      2    2               0      0       1       5\n  BEC_RTEL1-TNFRSF6B                                 15     0                2        25    14     3          0      0      3     10   11               0      0       7     642\n  BEC_TIMP1                                           0     0                0         0     0   157          0      0      0      0    0               0      0       1       0\n  BEC_TNFRSF4                                         0     0                0         4    22     3          0      0     65      0    3               0      0       0       1\n  cDC1                                               36     0                4         1     1     0         12      0      0      2    1               0      1       0       7\n  cDC2                                              122     0               12       121   117     3          0      2      4     62   13               1      3       5      18\n  Cholangiocyte FXYD2_high                            0     0              625         0     0     6          0      0      0      0    0               0      0       0       0\n  Cholangiocyte HIST1H2AM_high                        0     0               83         0     0     0          0      0      0      0    0               0      0       0       0\n  Classical_Mon_AQP9                                217     0               22        11    21   277          6      1     24     38   13               3     91      37     106\n  Classical_Mon_HCAR3                                13     0              307         2     3    23          3      0      0      4    3               0      0       2      33\n  Classical_Mon_S100A12                              26     1               12         3     9   130          1      0      7      3    9               0     81      21      11\n  Classical_Mon_S100A8                               11    69               67         0     1    86          0     45      1      3    3               0      9       2      14\n  Enterocyte APOA1_high                               0     0                0         0     0     0          0      0      0      0    0             654      0       0       3\n  Enterocyte APOB_high                                0     0                0         0     0     0          0      0      0      0    0             586      0       0       4\n  Enterocyte PCK1_high                                0     0                0         0     0     0          0      0      0      0    0             665      0       0       4\n  Enterocyte PRAP1_high                               0     0                0         0     0     0          0      0      0      0    0             556      0       0       1\n  Enterocyte RBP2_high                                0     0                0         0     0     0          0      0      0      0    0             412      0       0       1\n  Epithelial Cell DCD_high                            1     0                2        41     0     0          0      0      0      0   73               0      0       1       3\n  Epithelial Cell FABP4_high                        116     0                1         0     0     0          0      0      0      0    0               0      0       7       5\n  Fib_ANGPTL7_high                                   82     0               30        86    31     0          0      0      4      2   12               0      0       0      10\n  Fib_APOD_high                                       0     0                0         4     0     0          0      0    850      0    0               0      0       0       0\n  Fib_C1QTNF3_high                                    7     0                1      1291     2     0          0      0      5      3    2               0      0       4       0\n  Fib_CHI3L1_high                                   167     0               40        76     6     0          0      0      1     44    0               0      0       9     329\n  Fib_CRABP1_high                                     0     0                0         1     0     0          0      0      0      0    0               0      0       0     281\n  Fib_CXCL14_high                                    11     0                0         4     4     0          0      0      4      3  687               0      0       0       4\n  Fib_IGFBP3_high                                   635     0                0         2     0     0          0      0      0      6    0               0      0       2       0\n  Fib_IGFBP6_high                                     2     0                0       573     0     0          0      0      0      2    0               0      0       8       0\n  Fib_MT_high                                        22     0                1        74     4     0          0      0      0     21    8               0      0      10      13\n  Fib_PCOLCE2_high                                    4     0                0         0  1251     0          0      0      1      2    2               0      0       3       6\n  Fib_PTGDS_high                                      1     0                2       781     1     0          0      0      0      2    0               0      0       0       1\n  Fib_PTN_high                                        1     0                0        10  2467     1          0      0      1      4    6               0      0       2       7\n  Fib_SFRP2_high                                      5     0                0         0     0     0          0      0      0    328    0               0      0      10       0\n  Fib_SLIT3_high                                   1110     0                7       137    20     0          0      0      0     16    2               0      0      23       3\n  FibSmo_ADAMDEC1_high                                1     0                0         1     0     0          0      0      0     80    0               0      0      30       1\n  FibSmo_FOXF1_high                                 199     0                0         0     0     0          0      0      0      0    0               0      0       0       0\n  FibSmo_LINC01082_high                             922     0                0         0     0     0          0      0      0     10    0               0      0       2       0\n  FibSmo_SLC14A1_high                               841     0                1         0     0     0          0      0      0      0    0               0      0       1       0\n  FibSmo_THBS4_high                                   1     0                0         2     0     0          0      0      0    731    0               0      0       4       1\n  Follicular Epithelial Cell                          0     0                0         1     0     0          0      0      0      0  645               0      0       0       0\n  Goblet Cell                                         0     0                0         0     0     0          0      0      0    205    0              47      0       9      22\n  Granular Epithelial Cell                            0     0                0         0     0     0          0      0      0      0  224               0      0       0       0\n  Hepatic Oval Cell                                   0     0                4         0     0    48          0      0      0      0    0               0      0       0       0\n  High Proliferation Epithelial Cell TOP2A_high       0     0                0         0     0     0          0      0      0      0  229               1      0       0       0\n  High Proliferation Epithelial Cell UBE2C_high       0     0                1       416     0     0          0      0      0      0    6               0      0       0       2\n  IEL_TMIGD2                                          0     0                0         0     0     0          0      0      0      4    0               1      0     443       0\n  IEL_TRBV7-3                                         0     0                1         0     0     0          0      0      0      0    0               0      0       0     243\n  Intermediate_Mon_CCL20                              0     0                0         0     0     0          0      0      0    232    0               0      0       1       3\n  Intermediate_Mon_FN1                               33     0                2         1     9     7          0      0      4    432    0               4      1       4      50\n  Langerhans                                          0     0                0         0     0     0          0      0      0      0   72               0      0       0       0\n  LEC_CCL21                                          14     0                0        48     3    13          0      0      0      5   26               0      0       0      13\n  LEC_FCN3                                            0     0                0         0     0   129          0      0      0      0    0               0      0       0       0\n  Mac_APOE                                            5     0               59         0     0     3          0      0      0      0    1               0      0       1       5\n  Mac_FTL                                            15     2                4         2     3     5          0      2      1      1    0               2      4       0       5\n [ reached 'max' / getOption(\"max.print\") -- omitted 66 rows ]",
    "crumbs": [
      "Day 2",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Lab 3: Introduction to R/Bioconductor</span>"
    ]
  },
  {
    "objectID": "content/day2/Lab3_Rbioc.html#bonus",
    "href": "content/day2/Lab3_Rbioc.html#bonus",
    "title": "\n6  Lab 3: Introduction to R/Bioconductor\n",
    "section": "\n6.5 Bonus",
    "text": "6.5 Bonus\nTo compare the two different approaches, try preparing both a SingleCellExperiment or a Seurat object from scratch, using the matrix files generated in the previous lab. Read the documentation of the two related packages to understand how to do this.\nThis will be extensively covered in the next lab for everybody.",
    "crumbs": [
      "Day 2",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Lab 3: Introduction to R/Bioconductor</span>"
    ]
  },
  {
    "objectID": "content/day2/Lab3_Rbioc.html#session-info",
    "href": "content/day2/Lab3_Rbioc.html#session-info",
    "title": "\n6  Lab 3: Introduction to R/Bioconductor\n",
    "section": "\n6.6 Session info",
    "text": "6.6 Session info",
    "crumbs": [
      "Day 2",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Lab 3: Introduction to R/Bioconductor</span>"
    ]
  },
  {
    "objectID": "content/day2/Lab4_data_wrangling_scRNAseq.html",
    "href": "content/day2/Lab4_data_wrangling_scRNAseq.html",
    "title": "\n7  Lab 4 - Single-cell RNA-seq data wrangling\n",
    "section": "",
    "text": "7.1 Introduction\nData produced in a single cell RNA-seq experiment has several interesting characteristics that make it distinct from data produced in a bulk population RNA-seq experiment.\nTwo characteristics that are important to keep in mind when working with scRNA-Seq are drop-out (the excessive amount of zeros due to limiting mRNA) and the potential for quality control (QC) metrics to be confounded with biology. This combined with the ability to measure heterogeniety from cells in samples has shifted the field away from the typical analysis in population-based RNA-Seq.\nHere we demonstrate some approaches to quality control, followed by identifying and analyzing cell subsets.",
    "crumbs": [
      "Day 2",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Lab 4 - Single-cell RNA-seq data wrangling</span>"
    ]
  },
  {
    "objectID": "content/day2/Lab4_data_wrangling_scRNAseq.html#introduction",
    "href": "content/day2/Lab4_data_wrangling_scRNAseq.html#introduction",
    "title": "\n7  Lab 4 - Single-cell RNA-seq data wrangling\n",
    "section": "",
    "text": "7.1.1 Load necessary packages\nWhen loading libraries, we are asking R to load code for us written by someone else. It is a convenient way to leverage and reproduce methodology developed by others.\n\n\n\n\n\n\nQuestion\n\n\n\nFollowing the previous labs, load the necessary libraries for this analysis.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nlibrary(tidyverse)\n\n\n── Attaching core tidyverse packages ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.1     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.2.0     \n── Conflicts ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(SingleCellExperiment)\n\nLoading required package: SummarizedExperiment\nLoading required package: MatrixGenerics\nLoading required package: matrixStats\n\nAttaching package: 'matrixStats'\n\nThe following object is masked from 'package:dplyr':\n\n    count\n\n\nAttaching package: 'MatrixGenerics'\n\nThe following objects are masked from 'package:matrixStats':\n\n    colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse, colCounts, colCummaxs, colCummins, colCumprods, colCumsums, colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs, colMads, colMaxs, colMeans2,\n    colMedians, colMins, colOrderStats, colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds, colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads, colWeightedMeans, colWeightedMedians,\n    colWeightedSds, colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet, rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods, rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,\n    rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins, rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks, rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars, rowWeightedMads,\n    rowWeightedMeans, rowWeightedMedians, rowWeightedSds, rowWeightedVars\n\nLoading required package: GenomicRanges\nLoading required package: stats4\nLoading required package: BiocGenerics\nLoading required package: generics\n\nAttaching package: 'generics'\n\nThe following object is masked from 'package:lubridate':\n\n    as.difftime\n\nThe following object is masked from 'package:dplyr':\n\n    explain\n\nThe following objects are masked from 'package:base':\n\n    as.difftime, as.factor, as.ordered, intersect, is.element, setdiff, setequal, union\n\n\nAttaching package: 'BiocGenerics'\n\nThe following object is masked from 'package:dplyr':\n\n    combine\n\nThe following objects are masked from 'package:stats':\n\n    IQR, mad, sd, var, xtabs\n\nThe following objects are masked from 'package:base':\n\n    anyDuplicated, aperm, append, as.data.frame, basename, cbind, colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep, grepl, is.unsorted, lapply, Map, mapply, match, mget, order, paste,\n    pmax, pmax.int, pmin, pmin.int, Position, rank, rbind, Reduce, rownames, sapply, saveRDS, table, tapply, unique, unsplit, which.max, which.min\n\nLoading required package: S4Vectors\n\nAttaching package: 'S4Vectors'\n\nThe following objects are masked from 'package:lubridate':\n\n    second, second&lt;-\n\nThe following objects are masked from 'package:dplyr':\n\n    first, rename\n\nThe following object is masked from 'package:tidyr':\n\n    expand\n\nThe following object is masked from 'package:utils':\n\n    findMatches\n\nThe following objects are masked from 'package:base':\n\n    expand.grid, I, unname\n\nLoading required package: IRanges\n\nAttaching package: 'IRanges'\n\nThe following object is masked from 'package:lubridate':\n\n    %within%\n\nThe following objects are masked from 'package:dplyr':\n\n    collapse, desc, slice\n\nThe following object is masked from 'package:purrr':\n\n    reduce\n\nLoading required package: Seqinfo\nLoading required package: Biobase\nWelcome to Bioconductor\n\n    Vignettes contain introductory material; view with 'browseVignettes()'. To cite Bioconductor, see 'citation(\"Biobase\")', and for packages 'citation(\"pkgname\")'.\n\n\nAttaching package: 'Biobase'\n\nThe following object is masked from 'package:MatrixGenerics':\n\n    rowMedians\n\nThe following objects are masked from 'package:matrixStats':\n\n    anyMissing, rowMedians\n\n\n\n\n\n\n\n\n7.1.2 Create a SingleCellExperiment object from scratch\nIn the previous lab, we have been working with airway object (a SummarizedExperiment object) and sce, a SingleCellExperiment object. We will now create a toy SingleCellExperiment object from scratch, using the SingleCellExperiment constructor.\nTo create a SingleCellExperiment object, we need to provide the following:\n\n\ncolData: a data frame (or tibble) with columns corresponding to cell metadata.\n\nrowData: a data frame (or tibble) with columns corresponding to gene metadata.\n\nassays: a list of matrices, each matrix corresponding to a different assay. The first matrix is typically the counts matrix.\n\n\n\n\nR\n\ncd &lt;- tibble(idx = paste0('cell', 1:100))  ## `cd` stands for colData\ncd\n\n\n# A tibble: 100 × 1\n   idx   \n   &lt;chr&gt; \n 1 cell1 \n 2 cell2 \n 3 cell3 \n 4 cell4 \n 5 cell5 \n 6 cell6 \n 7 cell7 \n 8 cell8 \n 9 cell9 \n10 cell10\n# ℹ 90 more rows\n\nrd &lt;- tibble(\n    gene_name = paste0('gene', 1:10),\n    gene_type = factor(rep(c('protein_coding', 'non_coding'), each = 5))\n) ## `rd` stands for rowData\nrd \n\n# A tibble: 10 × 2\n   gene_name gene_type     \n   &lt;chr&gt;     &lt;fct&gt;         \n 1 gene1     protein_coding\n 2 gene2     protein_coding\n 3 gene3     protein_coding\n 4 gene4     protein_coding\n 5 gene5     protein_coding\n 6 gene6     non_coding    \n 7 gene7     non_coding    \n 8 gene8     non_coding    \n 9 gene9     non_coding    \n10 gene10    non_coding    \n\ncnts &lt;- matrix(rpois(1000, 5), ncol = 100) ## `cnts` stands for counts\n\ndim(cd)\n\n[1] 100   1\n\ndim(rd)\n\n[1] 10  2\n\ndim(cnts)\n\n[1]  10 100\n\nnrow(cd) == ncol(cnts)\n\n[1] TRUE\n\nnrow(rd) == nrow(cnts)\n\n[1] TRUE\n\ntoy_sce &lt;- SingleCellExperiment(\n    colData = cd, \n    rowData = rd, \n    assays = list('counts' = cnts)\n)\ntoy_sce\n\nclass: SingleCellExperiment \ndim: 10 100 \nmetadata(0):\nassays(1): counts\nrownames: NULL\nrowData names(2): gene_name gene_type\ncolnames: NULL\ncolData names(1): idx\nreducedDimNames(0):\nmainExpName: NULL\naltExpNames(0):\n\ncolData(toy_sce)\n\nDataFrame with 100 rows and 1 column\n            idx\n    &lt;character&gt;\n1         cell1\n2         cell2\n3         cell3\n4         cell4\n5         cell5\n...         ...\n96       cell96\n97       cell97\n98       cell98\n99       cell99\n100     cell100\n\nrowData(toy_sce)\n\nDataFrame with 10 rows and 2 columns\n     gene_name      gene_type\n   &lt;character&gt;       &lt;factor&gt;\n1        gene1 protein_coding\n2        gene2 protein_coding\n3        gene3 protein_coding\n4        gene4 protein_coding\n5        gene5 protein_coding\n6        gene6 non_coding    \n7        gene7 non_coding    \n8        gene8 non_coding    \n9        gene9 non_coding    \n10      gene10 non_coding    \n\nassays(toy_sce)\n\nList of length 1\nnames(1): counts\n\nassays(toy_sce)[[\"counts\"]][1:10, 1:10]\n\n      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]\n [1,]    5    3    4    6    5    7    5    7    5     4\n [2,]    6    7   10    5    5    3    5    4    6     1\n [3,]    5    6    4    4    6    7    3    1    3     7\n [4,]    9    4    6    3    5    9    4    4    3     5\n [5,]    0    4    2    3    6    2    6    7    5     4\n [6,]    6    6    3    4    5    5    3    5    8     7\n [7,]    6    2    6   12   11    4    8    5    5     4\n [8,]   10    8    3    4    6    3    4    7    6     6\n [9,]    2    4    2    2    4    7    4    2    7     6\n[10,]   10    6    6    9    2    4    8    7    4     5\n\n\n\n7.1.3 Read in Pancreas counts matrix.\nWe will now analyze a real human pancreas scRNAseq dataset. It is freely available from GEO: link. We start by downloading the cell, features and counts matrix.\n\n\n\n\n\n\nQuestion\n\n\n\nInspect the GEO page and get the downloadable links for each file\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ndownload.file('https://ftp.ncbi.nlm.nih.gov/geo/series/GSE114nnn/GSE114802/suppl/GSE114802_org4_barcodes.tsv.gz', 'GSE114802_org4_barcodes.tsv.gz')\ndownload.file('https://ftp.ncbi.nlm.nih.gov/geo/series/GSE114nnn/GSE114802/suppl/GSE114802_org4_genes.tsv.gz', 'GSE114802_org4_genes.tsv.gz')\ndownload.file('https://ftp.ncbi.nlm.nih.gov/geo/series/GSE114nnn/GSE114802/suppl/GSE114802_org4_counts.csv.gz', 'GSE114802_org4_counts.csv.gz')\n\n\n\n\n\n\n\nIn this dataset, the barcodes file contains the cell barcodes, the genes file contains the gene names, and the counts file contains the counts matrix. We can import the data into R using the read_tsv() and read_csv() functions (already available in the loaded tidyverse package).\nFor example, to read the barcodes file, we can use the following command:\n\n\n\nR\n\ncells &lt;- read_tsv('~/Share/GSE114802_org4_barcodes.tsv.gz', col_names = FALSE)\n\n\nRows: 1421 Columns: 1\n── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\nDelimiter: \"\\t\"\nchr (1): X1\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\nhead(cells)\n\n# A tibble: 6 × 1\n  X1                \n  &lt;chr&gt;             \n1 AAACCTGAGGCTCATT-1\n2 AAACCTGAGGTGCACA-1\n3 AAACCTGCAGGTGCCT-1\n4 AAACCTGGTTAGAACA-1\n5 AAACCTGTCACCACCT-1\n6 AAACCTGTCCGAGCCA-1\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nAlso read the genes and counts files into R.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ngenes &lt;- read_tsv('~/Share/GSE114802_org4_genes.tsv.gz', col_names = FALSE)\n\n\nRows: 33694 Columns: 2\n── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\nDelimiter: \"\\t\"\nchr (2): X1, X2\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\ngenes\n\n# A tibble: 33,694 × 2\n   X1              X2           \n   &lt;chr&gt;           &lt;chr&gt;        \n 1 ENSG00000243485 RP11-34P13.3 \n 2 ENSG00000237613 FAM138A      \n 3 ENSG00000186092 OR4F5        \n 4 ENSG00000238009 RP11-34P13.7 \n 5 ENSG00000239945 RP11-34P13.8 \n 6 ENSG00000239906 RP11-34P13.14\n 7 ENSG00000241599 RP11-34P13.9 \n 8 ENSG00000279928 FO538757.3   \n 9 ENSG00000279457 FO538757.2   \n10 ENSG00000228463 AP006222.2   \n# ℹ 33,684 more rows\n\ncounts &lt;- read_csv('~/Share/GSE114802_org4_counts.csv.gz', col_names = TRUE)\n\nNew names:\nRows: 33694 Columns: 1422\n── Column specification\n──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Delimiter: \",\" chr\n(1): ...1 dbl (1421): AAACCTGAGGCTCATT-1, AAACCTGAGGTGCACA-1, AAACCTGCAGGTGCCT-1, AAACCTGGTTAGAACA-1, AAACCTGTCACCACCT-1, AAACCTGTCCGAGCCA-1, AAACCTGTCGTGACAT-1, AAACGGGAGTAGTGCG-1, AAACGGGCAGCGTTCG-1, AAACGGGCATGTTCCC-1,\nAAACGGGGTCTAGTCA-1, AAAG...\nℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n• `` -&gt; `...1`\n\ncounts[1:10, 1:6]\n\n# A tibble: 10 × 6\n   ...1            `AAACCTGAGGCTCATT-1` `AAACCTGAGGTGCACA-1` `AAACCTGCAGGTGCCT-1` `AAACCTGGTTAGAACA-1` `AAACCTGTCACCACCT-1`\n   &lt;chr&gt;                          &lt;dbl&gt;                &lt;dbl&gt;                &lt;dbl&gt;                &lt;dbl&gt;                &lt;dbl&gt;\n 1 ENSG00000243485                    0                    0                    0                    0                    0\n 2 ENSG00000237613                    0                    0                    0                    0                    0\n 3 ENSG00000186092                    0                    0                    0                    0                    0\n 4 ENSG00000238009                    0                    0                    0                    0                    0\n 5 ENSG00000239945                    0                    0                    0                    0                    0\n 6 ENSG00000239906                    0                    0                    0                    0                    0\n 7 ENSG00000241599                    0                    0                    0                    0                    0\n 8 ENSG00000279928                    0                    0                    0                    0                    0\n 9 ENSG00000279457                    0                    0                    0                    0                    0\n10 ENSG00000228463                    0                    0                    3                    2                    0\n\n\n\n\n\nNote how the first column of the counts dataframe is the gene names. We will need to strip this column, and turn the data frame into a matrix.\n\n\n\nR\n\ncounts &lt;- counts[, -1]\ncounts &lt;- as(counts, 'matrix')\ncounts[1:10, 1:6]\n\n\n      AAACCTGAGGCTCATT-1 AAACCTGAGGTGCACA-1 AAACCTGCAGGTGCCT-1 AAACCTGGTTAGAACA-1 AAACCTGTCACCACCT-1 AAACCTGTCCGAGCCA-1\n [1,]                  0                  0                  0                  0                  0                  0\n [2,]                  0                  0                  0                  0                  0                  0\n [3,]                  0                  0                  0                  0                  0                  0\n [4,]                  0                  0                  0                  0                  0                  0\n [5,]                  0                  0                  0                  0                  0                  0\n [6,]                  0                  0                  0                  0                  0                  0\n [7,]                  0                  0                  0                  0                  0                  0\n [8,]                  0                  0                  0                  0                  0                  0\n [9,]                  0                  0                  0                  0                  0                  0\n[10,]                  0                  0                  3                  2                  0                  0\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nCoerce the data into a SingleCellExperiment object.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nsce &lt;- SingleCellExperiment(\n    colData = cells, \n    rowData = genes, \n    assays = list('counts' = counts)\n)\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nExamine the SingleCellExperiment object you’ve just created. Get an idea of the size of the dataset, the different data available, etc.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ncolData(sce)\n\n\nDataFrame with 1421 rows and 1 column\n                                   X1\n                          &lt;character&gt;\nAAACCTGAGGCTCATT-1 AAACCTGAGGCTCATT-1\nAAACCTGAGGTGCACA-1 AAACCTGAGGTGCACA-1\nAAACCTGCAGGTGCCT-1 AAACCTGCAGGTGCCT-1\nAAACCTGGTTAGAACA-1 AAACCTGGTTAGAACA-1\nAAACCTGTCACCACCT-1 AAACCTGTCACCACCT-1\n...                               ...\nTTTGGTTTCGGTGTCG-1 TTTGGTTTCGGTGTCG-1\nTTTGTCAAGGATGGAA-1 TTTGTCAAGGATGGAA-1\nTTTGTCAGTACCTACA-1 TTTGTCAGTACCTACA-1\nTTTGTCAGTCTCACCT-1 TTTGTCAGTCTCACCT-1\nTTTGTCAGTGAAATCA-1 TTTGTCAGTGAAATCA-1\n\nrowData(sce)\n\nDataFrame with 33694 rows and 2 columns\n                   X1           X2\n          &lt;character&gt;  &lt;character&gt;\n1     ENSG00000243485 RP11-34P13.3\n2     ENSG00000237613      FAM138A\n3     ENSG00000186092        OR4F5\n4     ENSG00000238009 RP11-34P13.7\n5     ENSG00000239945 RP11-34P13.8\n...               ...          ...\n33690 ENSG00000277856   AC233755.2\n33691 ENSG00000275063   AC233755.1\n33692 ENSG00000271254   AC240274.1\n33693 ENSG00000277475   AC213203.1\n33694 ENSG00000268674      FAM231B\n\nmetadata(sce)\n\nlist()\n\ndim(sce)\n\n[1] 33694  1421\n\nassays(sce)\n\nList of length 1\nnames(1): counts\n\ncounts(sce)[1:10, 1:10]\n\n      AAACCTGAGGCTCATT-1 AAACCTGAGGTGCACA-1 AAACCTGCAGGTGCCT-1 AAACCTGGTTAGAACA-1 AAACCTGTCACCACCT-1 AAACCTGTCCGAGCCA-1 AAACCTGTCGTGACAT-1 AAACGGGAGTAGTGCG-1 AAACGGGCAGCGTTCG-1 AAACGGGCATGTTCCC-1\n [1,]                  0                  0                  0                  0                  0                  0                  0                  0                  0                  0\n [2,]                  0                  0                  0                  0                  0                  0                  0                  0                  0                  0\n [3,]                  0                  0                  0                  0                  0                  0                  0                  0                  0                  0\n [4,]                  0                  0                  0                  0                  0                  0                  0                  0                  0                  0\n [5,]                  0                  0                  0                  0                  0                  0                  0                  0                  0                  0\n [6,]                  0                  0                  0                  0                  0                  0                  0                  0                  0                  0\n [7,]                  0                  0                  0                  0                  0                  0                  0                  0                  0                  0\n [8,]                  0                  0                  0                  0                  0                  0                  0                  0                  0                  0\n [9,]                  0                  0                  0                  0                  0                  0                  0                  0                  0                  0\n[10,]                  0                  0                  3                  2                  0                  0                  0                  0                  1                  0\n\nreducedDims(sce)\n\nList of length 0\nnames(0):",
    "crumbs": [
      "Day 2",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Lab 4 - Single-cell RNA-seq data wrangling</span>"
    ]
  },
  {
    "objectID": "content/day2/Lab4_data_wrangling_scRNAseq.html#basic-qcs",
    "href": "content/day2/Lab4_data_wrangling_scRNAseq.html#basic-qcs",
    "title": "\n7  Lab 4 - Single-cell RNA-seq data wrangling\n",
    "section": "\n7.2 Basic QCs",
    "text": "7.2 Basic QCs\nYou can learn a lot about your scRNA-seq data’s quality with simple plotting.\nLet’s do some plotting to look at the number of reads per cell, reads per genes, expressed genes per cell (often called complexity), and rarity of genes (cells expressing genes).\n\n\n\n\n\n\nQuestion\n\n\n\nPlot the number of counts per cell, the number of expressed genes per cell, and the relationship between the two.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ncounts_per_cell &lt;- Matrix::colSums(counts)\ncounts_per_gene &lt;- Matrix::rowSums(counts)\ngenes_per_cell &lt;- Matrix::colSums(counts &gt; 0) # count gene only if it has non-zero reads mapped.\nhist(log10(counts_per_cell+1), main = '# of counts per cell', col = 'wheat')\n\n\n\n\n\n\n\nhist(log10(genes_per_cell+1), main = '# of expressed genes per cell', col = 'wheat')\n\n\n\n\n\n\nplot(counts_per_cell, genes_per_cell, log = 'xy', col = 'wheat')\ntitle('Counts vs genes per cell')\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nLook at the summary counts for genes and cells. Can you plot a histogram of counts per gene in log10 scale?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ncells_per_gene &lt;- Matrix::rowSums(counts &gt; 0) # only count cells where the gene is expressed\nhist(log10(cells_per_gene+1), main = '# of cells expressing each gene', col = 'wheat')\n\n\n\n\n\n\n\n\n\n\n\n\n\nA very useful plot is the distribution of library complexity in the sequencing run, typically shown as a lineplot of the number of detected UMI per cell, with cells ranked in decreasing order. One can use such plot to investigate observations (potential cells) that are actually failed libraries (lower end outliers) or observations that are cell doublets (higher end outliers).\n\n\n\n\n\n\nQuestion\n\n\n\nPlot cells ranked by their number of detected genes. Comment.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nplot(\n    sort(genes_per_cell, decreasing = TRUE), \n    xlab = 'cell', log = 'y', main = '# of genes per cell (ordered)', \n    type = 'l'\n)\n\n\n\n\n\n\n\n\n\n\n\n\n\nSeveral QCs can be automatically computed using quickPerCellQC().\n\n\n\nR\n\ntoy_sce &lt;- scuttle::quickPerCellQC(toy_sce)\ncolData(toy_sce)\n\n\nDataFrame with 90 rows and 7 columns\n            idx       sum  detected     total     low_lib_size   low_n_features   discard\n    &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;outlier.filter&gt; &lt;outlier.filter&gt; &lt;logical&gt;\n1         cell2        50        10        50            FALSE            FALSE     FALSE\n2         cell3        46        10        46            FALSE            FALSE     FALSE\n3         cell4        52        10        52            FALSE            FALSE     FALSE\n4         cell5        55        10        55            FALSE            FALSE     FALSE\n5         cell6        51        10        51            FALSE            FALSE     FALSE\n...         ...       ...       ...       ...              ...              ...       ...\n86       cell96        48        10        48            FALSE            FALSE     FALSE\n87       cell97        53        10        53            FALSE            FALSE     FALSE\n88       cell98        47        10        47            FALSE            FALSE     FALSE\n89       cell99        52        10        52            FALSE            FALSE     FALSE\n90      cell100        45        10        45            FALSE            FALSE     FALSE\n\ntable(toy_sce$low_lib_size)\n\n\nFALSE \n   90 \n\ntable(toy_sce$low_n_features)\n\n\nFALSE \n   90 \n\n\n\n\n\n\n\n\nQuestion\n\n\n\nRun quickPerCellQC() on the SingleCellExperiment object. Inspect the new colData of the object.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nsce &lt;- scuttle::quickPerCellQC(sce)\ncolData(sce)\n\n\nDataFrame with 1420 rows and 7 columns\n                                   X1       sum  detected     total     low_lib_size   low_n_features   discard\n                          &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;outlier.filter&gt; &lt;outlier.filter&gt; &lt;logical&gt;\nAAACCTGAGGCTCATT-1 AAACCTGAGGCTCATT-1     18836      4512     18836            FALSE            FALSE     FALSE\nAAACCTGAGGTGCACA-1 AAACCTGAGGTGCACA-1     22583      3915     22583            FALSE            FALSE     FALSE\nAAACCTGCAGGTGCCT-1 AAACCTGCAGGTGCCT-1     34931      6449     34931            FALSE            FALSE     FALSE\nAAACCTGGTTAGAACA-1 AAACCTGGTTAGAACA-1     14382      3910     14382            FALSE            FALSE     FALSE\nAAACCTGTCACCACCT-1 AAACCTGTCACCACCT-1     19542      4469     19542            FALSE            FALSE     FALSE\n...                               ...       ...       ...       ...              ...              ...       ...\nTTTGGTTTCGGTGTCG-1 TTTGGTTTCGGTGTCG-1    139350     10354    139350            FALSE            FALSE     FALSE\nTTTGTCAAGGATGGAA-1 TTTGTCAAGGATGGAA-1     10629      2382     10629            FALSE            FALSE     FALSE\nTTTGTCAGTACCTACA-1 TTTGTCAGTACCTACA-1     11836      3140     11836            FALSE            FALSE     FALSE\nTTTGTCAGTCTCACCT-1 TTTGTCAGTCTCACCT-1     19054      3316     19054            FALSE            FALSE     FALSE\nTTTGTCAGTGAAATCA-1 TTTGTCAGTGAAATCA-1     12646      3268     12646            FALSE            FALSE     FALSE",
    "crumbs": [
      "Day 2",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Lab 4 - Single-cell RNA-seq data wrangling</span>"
    ]
  },
  {
    "objectID": "content/day2/Lab4_data_wrangling_scRNAseq.html#access-to-stored-informations",
    "href": "content/day2/Lab4_data_wrangling_scRNAseq.html#access-to-stored-informations",
    "title": "\n7  Lab 4 - Single-cell RNA-seq data wrangling\n",
    "section": "\n7.3 Access to stored informations",
    "text": "7.3 Access to stored informations\n\n7.3.1 Assay slots\nFor typical scRNA-seq experiments, a SingleCellExperiment can have multiple assays, corresponding to different metrics. The most basic one is counts.\nDifferent assays store different ‘transformations’ of the counts(e.g. `logcounts).\nFor example, one can compute mean-centered counts and store it in a new slot.\n\n\n\nR\n\nmean_centered_counts &lt;- scale(counts(toy_sce), center = TRUE, scale = FALSE)\nassay(toy_sce, 'mean_centered') &lt;- mean_centered_counts\nassays(toy_sce)\n\n\nList of length 2\nnames(2): counts mean_centered\n\nassay(toy_sce, 'mean_centered')[1:10, 1:10]\n\n      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]\n [1,]   -2 -0.6  0.8 -0.5  1.9    0  2.1 -0.2 -0.9   0.4\n [2,]    2  5.4 -0.2 -0.5 -2.1    0 -0.9  0.8 -3.9  -0.6\n [3,]    1 -0.6 -1.2  0.5  1.9   -2 -3.9 -2.2  2.1  -1.6\n [4,]   -1  1.4 -2.2 -0.5  3.9   -1 -0.9 -2.2  0.1   4.4\n [5,]   -1 -2.6 -2.2  0.5 -3.1    1  2.1 -0.2 -0.9  -0.6\n [6,]    1 -1.6 -1.2 -0.5 -0.1   -2  0.1  2.8  2.1  -2.6\n [7,]   -3  1.4  6.8  5.5 -1.1    3  0.1 -0.2 -0.9  -1.6\n [8,]    3 -1.6 -1.2  0.5 -2.1   -1  2.1  0.8  1.1   0.4\n [9,]   -1 -2.6 -3.2 -1.5  1.9   -1 -2.9  1.8  1.1   3.4\n[10,]    1  1.4  3.8 -3.5 -1.1    3  2.1 -1.2  0.1  -1.6\n\nmean(assay(toy_sce, 'mean_centered'))\n\n[1] 5.155984e-19\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nTry to manually compute logcounts from counts and store it in a new slot.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nassay(sce, 'logcounts') &lt;- log10(counts(sce) + 1)\nlogcounts(sce)[1:10, 1:10]\n\n\n      AAACCTGAGGCTCATT-1 AAACCTGAGGTGCACA-1 AAACCTGCAGGTGCCT-1 AAACCTGGTTAGAACA-1 AAACCTGTCACCACCT-1 AAACCTGTCCGAGCCA-1 AAACCTGTCGTGACAT-1 AAACGGGAGTAGTGCG-1 AAACGGGCAGCGTTCG-1 AAACGGGCATGTTCCC-1\n [1,]                  0                  0            0.00000          0.0000000                  0                  0                  0                  0            0.00000                  0\n [2,]                  0                  0            0.00000          0.0000000                  0                  0                  0                  0            0.00000                  0\n [3,]                  0                  0            0.00000          0.0000000                  0                  0                  0                  0            0.00000                  0\n [4,]                  0                  0            0.00000          0.0000000                  0                  0                  0                  0            0.00000                  0\n [5,]                  0                  0            0.00000          0.0000000                  0                  0                  0                  0            0.00000                  0\n [6,]                  0                  0            0.00000          0.0000000                  0                  0                  0                  0            0.00000                  0\n [7,]                  0                  0            0.00000          0.0000000                  0                  0                  0                  0            0.00000                  0\n [8,]                  0                  0            0.00000          0.0000000                  0                  0                  0                  0            0.00000                  0\n [9,]                  0                  0            0.00000          0.0000000                  0                  0                  0                  0            0.00000                  0\n[10,]                  0                  0            0.60206          0.4771213                  0                  0                  0                  0            0.30103                  0\n\n\n\n\n\n\n\n\n7.3.2 Embeddings\nEmbeddings allow for a representation of large-scale data (N cells x M genes) into smaller dimensions (e.g. 2-50 dimensions). Typical embeddings can be PCA, t-SNE, UMAP, etc… Many embeddings can be computed using run...() functions from Bioconductor packages (e.g. scran, scater, …).\nFor example, one can compute PCA and store it in a new slot.\n\n\n\nR\n\nlibrary(scater)\n\n\nLoading required package: scuttle\n\nlogcounts(toy_sce) &lt;- log10(counts(toy_sce) + 1)\ntoy_sce &lt;- scater::runPCA(toy_sce)\n\nWarning in check_numbers(k = k, nu = nu, nv = nv, limit = min(dim(x)) - : more singular values/vectors requested than available\n\n\nWarning in (function (A, nv = 5, nu = nv, maxit = 1000, work = nv + 7, reorth = TRUE, : You're computing too large a percentage of total singular values, use a standard svd instead.\n\n\nWarning in (function (A, nv = 5, nu = nv, maxit = 1000, work = nv + 7, reorth = TRUE, : did not converge--results might be invalid!; try increasing work or maxit\n\nreducedDims(toy_sce)\n\nList of length 1\nnames(1): PCA\n\nreducedDim(toy_sce, 'PCA')[1:10, ]\n\n              PC1         PC2         PC3          PC4         PC5         PC6          PC7          PC8          PC9\n [1,] -0.10188550 -0.23960174  0.15536503 -0.080775594 -0.13690322  0.06965383  0.043806221  0.055637858  0.123582832\n [2,]  0.37215335  0.17368706  0.26644099 -0.228314901  0.04338170  0.02321382  0.067101649  0.044882642  0.011083826\n [3,]  0.36654612 -0.07860097  0.04431092 -0.246706533  0.25737652 -0.16367687  0.003723941 -0.006892653 -0.089377143\n [4,]  0.15524959  0.12332265 -0.33819216 -0.024038955 -0.09504966 -0.19346908  0.006407067 -0.086882585  0.095588686\n [5,] -0.21158239  0.29559076  0.15367895  0.004994796  0.05350840 -0.09506797  0.269603509 -0.174721545 -0.009004378\n [6,]  0.14659364  0.03076939  0.01774083 -0.077196822  0.21168535 -0.10431330 -0.217529146  0.119906426 -0.060522731\n [7,]  0.01972163 -0.10345740 -0.11369716 -0.329725443  0.04859178 -0.04461984 -0.214182583  0.261427871 -0.375919741\n [8,] -0.10890088 -0.07557911 -0.22883877 -0.083608108  0.15183109  0.07007486 -0.023776399 -0.028014496 -0.004730487\n [9,] -0.30964089 -0.11813574 -0.02746707  0.140264610  0.02586798 -0.28076820  0.258990812  0.033153159 -0.054846467\n[10,] -0.24325096  0.49796709  0.06435883  0.009012581 -0.05896095  0.15746412  0.108314868  0.474050801  0.044619857\n\nplotReducedDim(toy_sce, 'PCA')\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nTry to compute PCA, t-SNE and UMAP embeddings of the pancreas dataset using runPCA(), runTSNE() and runUMAP() from scater package.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nsce &lt;- scater::runPCA(sce)\nplotReducedDim(sce, \"PCA\")\n\n\n\n\n\n\n\nsce &lt;- scater::runTSNE(sce)\nplotReducedDim(sce, \"TSNE\")\n\n\n\n\n\n\nsce &lt;- scater::runUMAP(sce)\nplotReducedDim(sce, \"UMAP\", colour_by = 'sum')\n\n\n\n\n\n\nplotReducedDim(sce, \"UMAP\", colour_by = 'detected')",
    "crumbs": [
      "Day 2",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Lab 4 - Single-cell RNA-seq data wrangling</span>"
    ]
  },
  {
    "objectID": "content/day2/Lab4_data_wrangling_scRNAseq.html#filtering-cells-and-features",
    "href": "content/day2/Lab4_data_wrangling_scRNAseq.html#filtering-cells-and-features",
    "title": "\n7  Lab 4 - Single-cell RNA-seq data wrangling\n",
    "section": "\n7.4 Filtering cells and features",
    "text": "7.4 Filtering cells and features\n\n7.4.1 Pre-filtering\nFiltering operations are often performed on the SingleCellExperiment object, for example to remove low-quality cells (columns) or genes (rows).\nTo do this, one can use standard R syntax to subset the SingleCellExperiment object.\n\n\n\nR\n\ntoy_sce_filtered &lt;- toy_sce[rowData(toy_sce)$gene_type == 'protein_coding', toy_sce$sum &gt; 50]\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nFilter the SCE to only include cells that have a complexity of 2000 genes or more and genes that are are expressed in 10 or more cells.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nsce_filtered &lt;- sce[\n    Matrix::rowSums(counts(sce) &gt; 0) &gt; 10, \n    Matrix::colSums(counts(sce) &gt; 0) &gt; 2000\n]\nsce_filtered\n\n\nclass: SingleCellExperiment \ndim: 16606 1419 \nmetadata(0):\nassays(2): counts logcounts\nrownames: NULL\nrowData names(2): X1 X2\ncolnames(1419): AAACCTGAGGCTCATT-1 AAACCTGAGGTGCACA-1 ... TTTGTCAGTCTCACCT-1 TTTGTCAGTGAAATCA-1\ncolData names(7): X1 sum ... low_n_features discard\nreducedDimNames(3): PCA TSNE UMAP\nmainExpName: NULL\naltExpNames(1): ATAC_counts\n\n\n\n\n\n\n\nAlmost all our analysis will be on this single object, of class SingleCellExperiment. This object contains various “slots” that will store not only the raw count data, but also the results from various computations below. This has the advantage that we do not need to keep track of inidividual variables of interest - they can all be collapsed into a single object as long as these slots are pre-defined.\n\n7.4.2 Filtering low-quality cells: mitochondrial counts\nFor each cell, we can calculate the percentage of counts mapping on mitochondrial genes and store it in a column percent_mito in our colData().\n\n\n\nR\n\nrowData(sce_filtered)\n\n\nDataFrame with 16606 rows and 2 columns\n                   X1            X2\n          &lt;character&gt;   &lt;character&gt;\n1     ENSG00000279457    FO538757.2\n2     ENSG00000228463    AP006222.2\n3     ENSG00000237094 RP4-669L17.10\n4     ENSG00000237491 RP11-206L10.9\n5     ENSG00000225880     LINC00115\n...               ...           ...\n16602 ENSG00000198727        MT-CYB\n16603 ENSG00000276256    AC011043.1\n16604 ENSG00000273748    AL592183.1\n16605 ENSG00000278817    AC007325.4\n16606 ENSG00000271254    AC240274.1\n\nmito_genes &lt;- rownames(sce_filtered)[grep(pattern = \"^MT-\", x = rowData(sce_filtered)$X2)]\nmito_genes_counts &lt;- counts(sce_filtered)[mito_genes, ]\npercent_mito &lt;- colSums(mito_genes_counts) / sce_filtered$total\nhist(percent_mito*100, main = '% of total counts over mitochondrial genes', col = 'wheat')\n\n\n\n\n\n\ncolData(sce_filtered)$percent_mito &lt;- percent_mito\ntable(colData(sce_filtered)$percent_mito &gt; 0.1)\n\n\nFALSE \n 1419 \n\n\n\n\n\n\n\n\nQuestion\n\n\n\nRemove cells with a % of mitochondrial counts greater than 10%.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nsce_filtered &lt;- sce_filtered[\n    , \n    sce_filtered$percent_mito &lt;= 0.10\n]\nsce_filtered\n\n\nclass: SingleCellExperiment \ndim: 16606 1419 \nmetadata(0):\nassays(2): counts logcounts\nrownames: NULL\nrowData names(2): X1 X2\ncolnames(1419): AAACCTGAGGCTCATT-1 AAACCTGAGGTGCACA-1 ... TTTGTCAGTCTCACCT-1 TTTGTCAGTGAAATCA-1\ncolData names(8): X1 sum ... discard percent_mito\nreducedDimNames(3): PCA TSNE UMAP\nmainExpName: NULL\naltExpNames(1): ATAC_counts\n\n\n\n\n\n\n\n\n7.4.3 Checking housekeeping genes\nAnother metric we use is the number of house keeping genes expressed in a cell. These genes reflect commomn processes active in a cell and hence are a good global quality measure. They are also abundant and are usually steadliy expressed in cells, thus less sensitive to the high dropout.\nWe first load the list of housekeeping genes (from ~/Share/tirosh_house_keeping.txt), match them to the genes in the rowData of the SingleCellExperiment object (using match and rownames), remove NAs (genes not found in the rowData), and store the list of housekeeping genes in a new variable.\n\n\n\nR\n\n# Load the list of housekeeping genes\nhkgenes &lt;- read.table(\"~/Share/tirosh_house_keeping.txt\", skip = 2)\nhkgenes &lt;- as.vector(hkgenes$V1)\nhkgenes &lt;- rownames(sce_filtered)[match(hkgenes, rowData(sce_filtered)$X2)]\nhkgenes &lt;- hkgenes[!is.na(hkgenes)]\nhkgenes\n\n\nNULL\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nCalculate the number of expressed housekeeping genes per cell (genes with a count &gt; 0) and store the number of expressed housekeeping genes per cell in colData.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ncolData(sce_filtered)$n_expressed_hkgenes &lt;- Matrix::colSums(counts(sce_filtered)[hkgenes, ] &gt; 0)\ntable(colData(sce_filtered)$n_expressed_hkgenes)\n\n\n\n   0 \n1419 \n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nPlot (in a boxplot) the relationship between the # of detected housekeeping genes and the total UMI count (or # of detected genes) per cell. Comment.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ncolData(sce_filtered)$n_expressed_hkgenes &lt;- Matrix::colSums(counts(sce_filtered)[hkgenes, ] &gt; 0)\nboxplot(colData(sce_filtered)$total ~ colData(sce_filtered)$n_expressed_hkgenes)\n\n\n\n\n\n\n\nboxplot(colData(sce_filtered)$detected ~ colData(sce_filtered)$n_expressed_hkgenes)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nRemove cells with a # of expressed housekeeping genes greater than 85.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nsce_filtered &lt;- sce_filtered[, sce_filtered$n_expressed_hkgenes &lt;= 85]\nsce_filtered\n\n\nclass: SingleCellExperiment \ndim: 16606 1419 \nmetadata(0):\nassays(2): counts logcounts\nrownames: NULL\nrowData names(2): X1 X2\ncolnames(1419): AAACCTGAGGCTCATT-1 AAACCTGAGGTGCACA-1 ... TTTGTCAGTCTCACCT-1 TTTGTCAGTGAAATCA-1\ncolData names(9): X1 sum ... percent_mito n_expressed_hkgenes\nreducedDimNames(3): PCA TSNE UMAP\nmainExpName: NULL\naltExpNames(1): ATAC_counts\n\n\n\n\n\n\n\n\n7.4.4 Checking gene set expression\nSometimes we want to ask what is the expression of a gene / a set of a genes across cells. This set of genes may make up a gene expression program we are interested in. Another benefit at looking at gene sets is it reduces the effects of drop outs.\nLet’s look at genes involved in the stress signature upon cell dissociation. We calculate these genes average expression levels on the single cell level.\n\n\n\nR\n\ngenes_dissoc &lt;- c(\"ATF3\", \"BTG2\", \"CEBPB\", \"CEBPD\", \"CXCL3\", \"CXCL2\", \"CXCL1\", \"DNAJA1\", \"DNAJB1\", \"DUSP1\", \"EGR1\", \"FOS\", \"FOSB\", \"HSP90AA1\", \"HSP90AB1\", \"HSPA1A\", \"HSPA1B\", \"HSPA1A\", \"HSPA1B\", \"HSPA8\", \"HSPB1\", \"HSPE1\", \"HSPH1\", \"ID3\", \"IER2\", \"JUN\", \"JUNB\", \"JUND\", \"MT1X\", \"NFKBIA\", \"NR4A1\", \"PPP1R15A\", \"SOCS3\", \"ZFP36\")\ngenes_dissoc &lt;- rownames(sce_filtered)[match(genes_dissoc, rowData(sce_filtered)$X2)]\ngenes_dissoc &lt;- unique(genes_dissoc[!is.na(genes_dissoc)])\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nCalculate the average gene set expression for each cell.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nave_expr_genes_dissoc &lt;- colMeans(logcounts(sce_filtered[genes_dissoc, ]))\ncolData(sce_filtered)$ave_expr_genes_dissoc &lt;- ave_expr_genes_dissoc\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nPlot an embedding of the dataset, using a color scale representing the average expression of genes involved in the stress signature upon cell dissociation. Comment.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nplotReducedDim(sce_filtered, dimred = 'PCA', colour_by = 'ave_expr_genes_dissoc')",
    "crumbs": [
      "Day 2",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Lab 4 - Single-cell RNA-seq data wrangling</span>"
    ]
  },
  {
    "objectID": "content/day2/Lab4_data_wrangling_scRNAseq.html#session-info",
    "href": "content/day2/Lab4_data_wrangling_scRNAseq.html#session-info",
    "title": "\n7  Lab 4 - Single-cell RNA-seq data wrangling\n",
    "section": "\n7.5 Session info",
    "text": "7.5 Session info\n\n\n─ Session info ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.5.1 (2025-06-13)\n os       Ubuntu 24.04.2 LTS\n system   x86_64, linux-gnu\n ui       X11\n language (EN)\n collate  en_IN.utf8\n ctype    en_IN.utf8\n tz       Europe/Paris\n date     2025-11-14\n pandoc   3.1.3 @ /usr/bin/ (via rmarkdown)\n quarto   1.5.55 @ /opt/quarto/bin/quarto\n\n─ Packages ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n package              * version date (UTC) lib source\n abind                  1.4-8   2024-09-12 [1] CRAN (R 4.5.1)\n beachmat               2.26.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n beeswarm               0.4.0   2021-06-01 [1] CRAN (R 4.5.1)\n Biobase              * 2.70.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocGenerics         * 0.56.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocNeighbors          2.4.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocParallel           1.44.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocSingular           1.26.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n bit                    4.6.0   2025-03-06 [1] CRAN (R 4.5.0)\n bit64                  4.6.0-1 2025-01-16 [1] CRAN (R 4.5.0)\n cachem                 1.1.0   2024-05-16 [1] CRAN (R 4.5.1)\n cli                    3.6.5   2025-04-23 [1] CRAN (R 4.5.1)\n codetools              0.2-20  2024-03-31 [2] CRAN (R 4.5.1)\n cowplot                1.2.0   2025-07-07 [1] CRAN (R 4.5.1)\n crayon                 1.5.3   2024-06-20 [1] CRAN (R 4.5.1)\n DelayedArray           0.36.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n devtools               2.4.6   2025-10-03 [1] CRAN (R 4.5.1)\n dichromat              2.0-0.1 2022-05-02 [1] CRAN (R 4.5.1)\n digest                 0.6.38  2025-11-12 [1] CRAN (R 4.5.1)\n dplyr                * 1.1.4   2023-11-17 [1] CRAN (R 4.5.1)\n ellipsis               0.3.2   2021-04-29 [1] CRAN (R 4.5.1)\n evaluate               1.0.5   2025-08-27 [1] CRAN (R 4.5.1)\n farver                 2.1.2   2024-05-13 [1] CRAN (R 4.5.1)\n fastmap                1.2.0   2024-05-15 [1] CRAN (R 4.5.1)\n FNN                    1.1.4.1 2024-09-22 [1] CRAN (R 4.5.1)\n forcats              * 1.0.1   2025-09-25 [1] CRAN (R 4.5.1)\n fs                     1.6.6   2025-04-12 [1] CRAN (R 4.5.1)\n generics             * 0.1.4   2025-05-09 [1] CRAN (R 4.5.1)\n GenomicRanges        * 1.62.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n ggbeeswarm             0.7.2   2023-04-29 [1] CRAN (R 4.5.1)\n ggplot2              * 4.0.1   2025-11-14 [1] CRAN (R 4.5.1)\n ggrepel                0.9.6   2024-09-07 [1] CRAN (R 4.5.1)\n glue                   1.8.0   2024-09-30 [1] CRAN (R 4.5.1)\n gridExtra              2.3     2017-09-09 [1] CRAN (R 4.5.1)\n gtable                 0.3.6   2024-10-25 [1] CRAN (R 4.5.1)\n hms                    1.1.4   2025-10-17 [1] CRAN (R 4.5.1)\n htmltools              0.5.8.1 2024-04-04 [1] CRAN (R 4.5.1)\n htmlwidgets            1.6.4   2023-12-06 [1] CRAN (R 4.5.1)\n IRanges              * 2.44.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n irlba                  2.3.5.1 2022-10-03 [1] CRAN (R 4.5.1)\n jsonlite               2.0.0   2025-03-27 [1] CRAN (R 4.5.1)\n knitr                  1.50    2025-03-16 [1] CRAN (R 4.5.1)\n labeling               0.4.3   2023-08-29 [1] CRAN (R 4.5.1)\n lattice                0.22-7  2025-04-02 [2] CRAN (R 4.5.1)\n lifecycle              1.0.4   2023-11-07 [1] CRAN (R 4.5.1)\n lubridate            * 1.9.4   2024-12-08 [1] CRAN (R 4.5.0)\n magrittr               2.0.4   2025-09-12 [1] CRAN (R 4.5.1)\n Matrix                 1.7-3   2025-03-11 [1] CRAN (R 4.5.1)\n MatrixGenerics       * 1.22.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n matrixStats          * 1.5.0   2025-01-07 [1] CRAN (R 4.5.0)\n memoise                2.0.1   2021-11-26 [1] CRAN (R 4.5.1)\n pillar                 1.11.1  2025-09-17 [1] CRAN (R 4.5.1)\n pkgbuild               1.4.8   2025-05-26 [1] CRAN (R 4.5.1)\n pkgconfig              2.0.3   2019-09-22 [1] CRAN (R 4.5.1)\n pkgload                1.4.1   2025-09-23 [1] CRAN (R 4.5.1)\n purrr                * 1.2.0   2025-11-04 [1] CRAN (R 4.5.1)\n R6                     2.6.1   2025-02-15 [1] CRAN (R 4.5.0)\n RColorBrewer           1.1-3   2022-04-03 [1] CRAN (R 4.5.1)\n Rcpp                   1.1.0   2025-07-02 [1] CRAN (R 4.5.1)\n readr                * 2.1.5   2024-01-10 [1] CRAN (R 4.5.1)\n remotes                2.5.0   2024-03-17 [1] CRAN (R 4.5.1)\n rlang                  1.1.6   2025-04-11 [1] CRAN (R 4.5.1)\n rmarkdown              2.30    2025-09-28 [1] CRAN (R 4.5.1)\n RSpectra               0.16-2  2024-07-18 [1] CRAN (R 4.5.1)\n rsvd                   1.0.5   2021-04-16 [1] CRAN (R 4.5.1)\n Rtsne                  0.17    2023-12-07 [1] CRAN (R 4.5.1)\n S4Arrays               1.10.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n S4Vectors            * 0.48.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n S7                     0.2.0   2024-11-07 [1] CRAN (R 4.5.1)\n ScaledMatrix           1.18.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n scales                 1.4.0   2025-04-24 [1] CRAN (R 4.5.1)\n scater               * 1.38.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n scuttle              * 1.20.0  2025-10-30 [1] Bioconductor 3.22 (R 4.5.1)\n Seqinfo              * 1.0.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n sessioninfo            1.2.3   2025-02-05 [1] CRAN (R 4.5.0)\n SingleCellExperiment * 1.32.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n SparseArray            1.10.1  2025-10-31 [1] Bioconductor 3.22 (R 4.5.1)\n stringi                1.8.7   2025-03-27 [1] CRAN (R 4.5.1)\n stringr              * 1.6.0   2025-11-04 [1] CRAN (R 4.5.1)\n SummarizedExperiment * 1.40.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n tibble               * 3.3.0   2025-06-08 [1] CRAN (R 4.5.1)\n tidyr                * 1.3.1   2024-01-24 [1] CRAN (R 4.5.1)\n tidyselect             1.2.1   2024-03-11 [1] CRAN (R 4.5.1)\n tidyverse            * 2.0.0   2023-02-22 [1] CRAN (R 4.5.1)\n timechange             0.3.0   2024-01-18 [1] CRAN (R 4.5.1)\n tzdb                   0.5.0   2025-03-15 [1] CRAN (R 4.5.1)\n usethis                3.2.1   2025-09-06 [1] CRAN (R 4.5.1)\n utf8                   1.2.6   2025-06-08 [1] CRAN (R 4.5.1)\n uwot                   0.2.4   2025-11-10 [1] CRAN (R 4.5.1)\n vctrs                  0.6.5   2023-12-01 [1] CRAN (R 4.5.1)\n vipor                  0.4.7   2023-12-18 [1] CRAN (R 4.5.1)\n viridis                0.6.5   2024-01-29 [1] CRAN (R 4.5.1)\n viridisLite            0.4.2   2023-05-02 [1] CRAN (R 4.5.1)\n vroom                  1.6.6   2025-09-19 [1] CRAN (R 4.5.1)\n withr                  3.0.2   2024-10-28 [1] CRAN (R 4.5.1)\n xfun                   0.54    2025-10-30 [1] CRAN (R 4.5.1)\n XVector                0.50.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n\n [1] /home/rsg/R/x86_64-pc-linux-gnu-library/4.5\n [2] /opt/R/4.5.1/lib/R/library\n * ── Packages attached to the search path.\n\n──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────",
    "crumbs": [
      "Day 2",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Lab 4 - Single-cell RNA-seq data wrangling</span>"
    ]
  },
  {
    "objectID": "content/day3/Lecture4_clustering.html",
    "href": "content/day3/Lecture4_clustering.html",
    "title": "8  Lecture 4 - Identifying cell populations",
    "section": "",
    "text": "Slides here",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Lecture 4 - Identifying cell populations</span>"
    ]
  },
  {
    "objectID": "content/day3/Lab5_clustering.html",
    "href": "content/day3/Lab5_clustering.html",
    "title": "\n9  Lab 5: Dimension reduction, clustering and annotation\n",
    "section": "",
    "text": "9.1 Dimensional reduction for clustering",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Lab 5: Dimension reduction, clustering and annotation</span>"
    ]
  },
  {
    "objectID": "content/day3/Lab5_clustering.html#dimensional-reduction-for-clustering",
    "href": "content/day3/Lab5_clustering.html#dimensional-reduction-for-clustering",
    "title": "\n9  Lab 5: Dimension reduction, clustering and annotation\n",
    "section": "",
    "text": "9.1.1 Preparing dataset\nWe will prepare scRNAseq data from a PBMC run, provided by 10X and hosted by Bioconductor as a package.\n\n\n\n\n\n\nQuestion\n\n\n\nWhich package from Bioconductor gives streamlined access to PBMC scRNAseq dataset from 10X Genomics?\nWhat does the object contain (type of data, number of cells, batches, organism, …)? Can you get the same data from somewhere else?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nlibrary(tidyverse)\n\n\n── Attaching core tidyverse packages ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.1     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.2.0     \n── Conflicts ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(SingleCellExperiment)\n\nLoading required package: SummarizedExperiment\nLoading required package: MatrixGenerics\nLoading required package: matrixStats\n\nAttaching package: 'matrixStats'\n\nThe following object is masked from 'package:dplyr':\n\n    count\n\n\nAttaching package: 'MatrixGenerics'\n\nThe following objects are masked from 'package:matrixStats':\n\n    colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse, colCounts, colCummaxs, colCummins, colCumprods, colCumsums, colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs, colMads, colMaxs, colMeans2,\n    colMedians, colMins, colOrderStats, colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds, colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads, colWeightedMeans, colWeightedMedians,\n    colWeightedSds, colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet, rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods, rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,\n    rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins, rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks, rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars, rowWeightedMads,\n    rowWeightedMeans, rowWeightedMedians, rowWeightedSds, rowWeightedVars\n\nLoading required package: GenomicRanges\nLoading required package: stats4\nLoading required package: BiocGenerics\nLoading required package: generics\n\nAttaching package: 'generics'\n\nThe following object is masked from 'package:lubridate':\n\n    as.difftime\n\nThe following object is masked from 'package:dplyr':\n\n    explain\n\nThe following objects are masked from 'package:base':\n\n    as.difftime, as.factor, as.ordered, intersect, is.element, setdiff, setequal, union\n\n\nAttaching package: 'BiocGenerics'\n\nThe following object is masked from 'package:dplyr':\n\n    combine\n\nThe following objects are masked from 'package:stats':\n\n    IQR, mad, sd, var, xtabs\n\nThe following objects are masked from 'package:base':\n\n    anyDuplicated, aperm, append, as.data.frame, basename, cbind, colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep, grepl, is.unsorted, lapply, Map, mapply, match, mget, order, paste,\n    pmax, pmax.int, pmin, pmin.int, Position, rank, rbind, Reduce, rownames, sapply, saveRDS, table, tapply, unique, unsplit, which.max, which.min\n\nLoading required package: S4Vectors\n\nAttaching package: 'S4Vectors'\n\nThe following objects are masked from 'package:lubridate':\n\n    second, second&lt;-\n\nThe following objects are masked from 'package:dplyr':\n\n    first, rename\n\nThe following object is masked from 'package:tidyr':\n\n    expand\n\nThe following object is masked from 'package:utils':\n\n    findMatches\n\nThe following objects are masked from 'package:base':\n\n    expand.grid, I, unname\n\nLoading required package: IRanges\n\nAttaching package: 'IRanges'\n\nThe following object is masked from 'package:lubridate':\n\n    %within%\n\nThe following objects are masked from 'package:dplyr':\n\n    collapse, desc, slice\n\nThe following object is masked from 'package:purrr':\n\n    reduce\n\nLoading required package: Seqinfo\nLoading required package: Biobase\nWelcome to Bioconductor\n\n    Vignettes contain introductory material; view with 'browseVignettes()'. To cite Bioconductor, see 'citation(\"Biobase\")', and for packages 'citation(\"pkgname\")'.\n\n\nAttaching package: 'Biobase'\n\nThe following object is masked from 'package:MatrixGenerics':\n\n    rowMedians\n\nThe following objects are masked from 'package:matrixStats':\n\n    anyMissing, rowMedians\n\nsce &lt;- TENxPBMCData::TENxPBMCData('pbmc4k')\n\nsee ?TENxPBMCData and browseVignettes('TENxPBMCData') for documentation\ndownloading 1 resources\nretrieving 1 resource\n\n\nloading from cache\n\nrownames(sce) &lt;- scuttle::uniquifyFeatureNames(rowData(sce)$ENSEMBL_ID, rowData(sce)$Symbol_TENx)\nsce\n\nclass: SingleCellExperiment \ndim: 33694 4340 \nmetadata(0):\nassays(1): counts\nrownames(33694): RP11-34P13.3 FAM138A ... AC213203.1 FAM231B\nrowData names(3): ENSEMBL_ID Symbol_TENx Symbol\ncolnames: NULL\ncolData names(11): Sample Barcode ... Individual Date_published\nreducedDimNames(0):\nmainExpName: NULL\naltExpNames(0):\n\nrowData(sce)\n\nDataFrame with 33694 rows and 3 columns\n                  ENSEMBL_ID  Symbol_TENx       Symbol\n                 &lt;character&gt;  &lt;character&gt;  &lt;character&gt;\nRP11-34P13.3 ENSG00000243485 RP11-34P13.3           NA\nFAM138A      ENSG00000237613      FAM138A      FAM138A\nOR4F5        ENSG00000186092        OR4F5        OR4F5\nRP11-34P13.7 ENSG00000238009 RP11-34P13.7 LOC100996442\nRP11-34P13.8 ENSG00000239945 RP11-34P13.8           NA\n...                      ...          ...          ...\nAC233755.2   ENSG00000277856   AC233755.2           NA\nAC233755.1   ENSG00000275063   AC233755.1 LOC102723407\nAC240274.1   ENSG00000271254   AC240274.1 LOC102724250\nAC213203.1   ENSG00000277475   AC213203.1           NA\nFAM231B      ENSG00000268674      FAM231B      FAM231C\n\ncolData(sce)\n\nDataFrame with 4340 rows and 11 columns\n          Sample            Barcode         Sequence   Library Cell_ranger_version Tissue_status Barcode_type   Chemistry Sequence_platform    Individual Date_published\n     &lt;character&gt;        &lt;character&gt;      &lt;character&gt; &lt;integer&gt;         &lt;character&gt;   &lt;character&gt;  &lt;character&gt; &lt;character&gt;       &lt;character&gt;   &lt;character&gt;    &lt;character&gt;\n1         pbmc4k AAACCTGAGAAGGCCT-1 AAACCTGAGAAGGCCT         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08\n2         pbmc4k AAACCTGAGACAGACC-1 AAACCTGAGACAGACC         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08\n3         pbmc4k AAACCTGAGATAGTCA-1 AAACCTGAGATAGTCA         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08\n4         pbmc4k AAACCTGAGCGCCTCA-1 AAACCTGAGCGCCTCA         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08\n5         pbmc4k AAACCTGAGGCATGGT-1 AAACCTGAGGCATGGT         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08\n...          ...                ...              ...       ...                 ...           ...          ...         ...               ...           ...            ...\n4336      pbmc4k TTTGGTTTCGCTAGCG-1 TTTGGTTTCGCTAGCG         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08\n4337      pbmc4k TTTGTCACACTTAACG-1 TTTGTCACACTTAACG         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08\n4338      pbmc4k TTTGTCACAGGTCCAC-1 TTTGTCACAGGTCCAC         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08\n4339      pbmc4k TTTGTCAGTTAAGACA-1 TTTGTCAGTTAAGACA         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08\n4340      pbmc4k TTTGTCATCCCAAGAT-1 TTTGTCATCCCAAGAT         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08\n\ntable(sce$Library)\n\n\n   1 \n4340 \n\n\n\n\n\n\n\n\n9.1.2 Normalize counts using scran\n\nJust like in bulk high-throughput sequencing experiments, scRNAseq counts have to be normalized to the sequencing depth for each cell. We can define the library size as the total sum of counts across all genes for each cell, the expected value of which is assumed to scale with any cell-specific biases. However, this relies on the assumption that within the entire dataset, most genes are non-differentially expressed and expressed roughly within the same range. Depending on the set up of the scRNAseq experiment, this can be entirely false. To avoid relying on this hypothesis, we can (1) quickly pre-cluster cells, then (2) normalize cells using their library size factor separately in each cluster, then (3) rescaling size factors so that they are comparable across clusters.\nAll of this can be done very simply using the combo quickCluster() + computeSumFactors() + logNormCounts() from scran/scuttle packages.\n\n\n\n\n\n\nQuestion\n\n\n\nWhat is the purpose of the quickCluster() function? What does it return?\nWhat is the purpose of the computeSumFactors() function? What does it return?\nWhat is the purpose of the logNormCounts() function? What does it return?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nclusters &lt;- scran::quickCluster(sce)\ntable(clusters)\n\n\nclusters\n  1   2   3   4   5   6   7   8   9  10  11 \n588 361 264 161 866 365 531 536 360 207 101 \n\nsce &lt;- scran::computeSumFactors(sce, cluster = clusters)\ncolData(sce)\n\nDataFrame with 4340 rows and 12 columns\n          Sample            Barcode         Sequence   Library Cell_ranger_version Tissue_status Barcode_type   Chemistry Sequence_platform    Individual Date_published sizeFactor\n     &lt;character&gt;        &lt;character&gt;      &lt;character&gt; &lt;integer&gt;         &lt;character&gt;   &lt;character&gt;  &lt;character&gt; &lt;character&gt;       &lt;character&gt;   &lt;character&gt;    &lt;character&gt;  &lt;numeric&gt;\n1         pbmc4k AAACCTGAGAAGGCCT-1 AAACCTGAGAAGGCCT         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08   0.403246\n2         pbmc4k AAACCTGAGACAGACC-1 AAACCTGAGACAGACC         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08   0.739777\n3         pbmc4k AAACCTGAGATAGTCA-1 AAACCTGAGATAGTCA         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08   0.429493\n4         pbmc4k AAACCTGAGCGCCTCA-1 AAACCTGAGCGCCTCA         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08   0.527001\n5         pbmc4k AAACCTGAGGCATGGT-1 AAACCTGAGGCATGGT         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08   0.600344\n...          ...                ...              ...       ...                 ...           ...          ...         ...               ...           ...            ...        ...\n4336      pbmc4k TTTGGTTTCGCTAGCG-1 TTTGGTTTCGCTAGCG         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08   1.422566\n4337      pbmc4k TTTGTCACACTTAACG-1 TTTGTCACACTTAACG         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08   0.947146\n4338      pbmc4k TTTGTCACAGGTCCAC-1 TTTGTCACAGGTCCAC         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08   1.962193\n4339      pbmc4k TTTGTCAGTTAAGACA-1 TTTGTCAGTTAAGACA         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08   0.615199\n4340      pbmc4k TTTGTCATCCCAAGAT-1 TTTGTCATCCCAAGAT         1                v2.1            NA     Chromium Chromium_v2         Hiseq4000 HealthyDonor1     2017-11-08   0.771550\n\nsce &lt;- scuttle::logNormCounts(sce)\nassays(sce)\n\nList of length 2\nnames(2): counts logcounts\n\n\n\n\n\n\n\n\n9.1.3 Feature selection\nWe often use scRNAseq data in exploratory analyses to characterize heterogeneity across cells. Procedures like clustering and dimensionality reduction compare cells based on their gene expression profiles. The choice of genes to include in this comparison may have a major impact on the performance of downstream methods. Ideally, one wants to only select genes that contain useful information about the biology of the system while removing genes that contain random noise. This aims to preserve interesting biological structure without the variance that obscures that structure.\nThe simplest approach to feature selection is to compute the variance of the log-normalized expression values, to select the most variable genes. Modelling of the mean-variance relationship can be achieved by the modelGeneVar() function from the scran package.\n\n\n\n\n\n\nQuestion\n\n\n\nApply the modelGeneVar() function to the normalized counts. What does the returned object contain?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nsce_filtered_variance &lt;- scran::modelGeneVar(sce)\nsce_filtered_variance\n\n\nDataFrame with 33694 rows and 6 columns\n                    mean       total        tech          bio   p.value       FDR\n               &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;    &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;\nRP11-34P13.3 0.000000000 0.000000000 0.000000000  0.00000e+00       NaN       NaN\nFAM138A      0.000000000 0.000000000 0.000000000  0.00000e+00       NaN       NaN\nOR4F5        0.000000000 0.000000000 0.000000000  0.00000e+00       NaN       NaN\nRP11-34P13.7 0.001973297 0.002003373 0.002046038 -4.26643e-05  0.549850  0.744658\nRP11-34P13.8 0.000491705 0.000531807 0.000509831  2.19764e-05  0.397824  0.744658\n...                  ...         ...         ...          ...       ...       ...\nAC233755.2    0.00000000   0.0000000   0.0000000   0.00000000       NaN       NaN\nAC233755.1    0.00000000   0.0000000   0.0000000   0.00000000       NaN       NaN\nAC240274.1    0.00961767   0.0112683   0.0099722   0.00129611  0.217433  0.744658\nAC213203.1    0.00000000   0.0000000   0.0000000   0.00000000       NaN       NaN\nFAM231B       0.00000000   0.0000000   0.0000000   0.00000000       NaN       NaN\n\n\n\n\n\nIdentify the top 10% most variable genes from this object.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nHVGs &lt;- scran::getTopHVGs(sce_filtered_variance, prop = 0.1)\nrowData(sce)$isHVG &lt;- rownames(sce) %in% HVGs\nhead(rowData(sce))\n\n\nDataFrame with 6 rows and 4 columns\n                   ENSEMBL_ID   Symbol_TENx       Symbol     isHVG\n                  &lt;character&gt;   &lt;character&gt;  &lt;character&gt; &lt;logical&gt;\nRP11-34P13.3  ENSG00000243485  RP11-34P13.3           NA     FALSE\nFAM138A       ENSG00000237613       FAM138A      FAM138A     FALSE\nOR4F5         ENSG00000186092         OR4F5        OR4F5     FALSE\nRP11-34P13.7  ENSG00000238009  RP11-34P13.7 LOC100996442     FALSE\nRP11-34P13.8  ENSG00000239945  RP11-34P13.8           NA     FALSE\nRP11-34P13.14 ENSG00000239906 RP11-34P13.14           NA     FALSE\n\ntable(rowData(sce)$isHVG)\n\n\nFALSE  TRUE \n32424  1270 \n\n\n\n\n\nVisualize the mean-variance fit of the data, coloring points by whether they are in the top 10% most variable genes.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ndf &lt;- tibble(\n    mean = metadata(sce_filtered_variance)$mean, \n    var = metadata(sce_filtered_variance)$var, \n    trend = metadata(sce_filtered_variance)$trend(mean), \n    HVG = rowData(sce)$isHVG\n)\nggplot(df) + \n    geom_point(aes(x = mean, y = var, col = HVG), alpha = 0.4) + \n    geom_line(aes(x = mean, y = trend), col = 'darkred') +\n    theme_minimal() + \n    labs(x = 'Gene mean exp. (norm.)', y = 'Gene exp. variance')\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n9.1.4 PCA on filtered dataset\nWe now have normalized counts filtered for the top 500 genes varying with the greatest biological significance.\nStill, that represents a 500 x nCells (~8,000) dataset (each row being a feature). This is still too big to reliably use in standard clustering approaches. We can further compress the dataset. The most widely used approach is PCA: it computes a small number of “components” (typically 5-50) optimally summarizing the variability of the whole dataset, while retaining linearity of the underlying numerical data and being computationallt quite efficient.\n\n\n\n\n\n\nQuestion\n\n\n\nLeverage the scater package to compute a PCA embedding of the filtered data by taking into account the technical variability.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nsce &lt;- scran::denoisePCA(\n    sce, \n    technical = sce_filtered_variance, \n    subset.row = HVGs, \n    min.rank = 15\n)\np &lt;- scater::plotReducedDim(sce, 'PCA', colour_by = 'sizeFactor') + ggtitle('denoised PCA')\np",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Lab 5: Dimension reduction, clustering and annotation</span>"
    ]
  },
  {
    "objectID": "content/day3/Lab5_clustering.html#clustering",
    "href": "content/day3/Lab5_clustering.html#clustering",
    "title": "\n9  Lab 5: Dimension reduction, clustering and annotation\n",
    "section": "\n9.2 Clustering",
    "text": "9.2 Clustering\nClustering is an unsupervised learning procedure that is used in scRNA-seq data analysis to empirically define groups of cells with similar expression profiles. Its primary purpose is to summarize the data in a digestible format for human interpretation.\nAfter annotation based on marker genes, the clusters can be treated as proxies for more abstract biological concepts such as cell types or states. Clustering is thus a critical step for extracting biological insights from scRNA-seq data.\n\n9.2.1 Clustering algorithms\nThree main approaches can be used:\n\nHierarchical clustering\nk-means clustering\nGraph-based clustering\n\nToday, we will focus on graph-based clustering, as it is becoming the standard for scRNAseq: it is a flexible and scalable technique for clustering even the largest scRNA-seq datasets. We first build a graph where each node is a cell that is connected by edges to its nearest neighbors in the high-dimensional space. Edges are weighted based on the similarity between the cells involved, with higher weight given to cells that are more closely related.\n\n\n\n\n\n\nQuestion\n\n\n\nCompute a graph-based clustering of the PBMC dataset.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ngraph &lt;- scran::buildSNNGraph(\n    sce, \n    k = 5, \n    use.dimred = 'PCA'\n)\nsce_clust &lt;- igraph::cluster_louvain(graph)$membership\nsce$clusters_graph &lt;- factor(sce_clust)\ntable(sce$clusters_graph)\n\n\n\n  1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18 \n514 384 689  40 129 374  61 195 391 375 313 219 191 152  87 198  10  18 \n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nWhat are the main parameters to choose when building the graph? How do they impact the clustering?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ngraph2 &lt;- scran::buildSNNGraph(\n    sce, \n    k = 50, \n    use.dimred = 'PCA'\n)\nsce_clust2 &lt;- igraph::cluster_louvain(graph2)$membership\ntable(sce_clust, sce_clust2)\n\n\n         sce_clust2\nsce_clust   1   2   3   4   5   6   7   8\n       1  514   0   0   0   0   0   0   0\n       2    0 327  48   0   0   9   0   0\n       3    0  15 674   0   0   0   0   0\n       4    0   0   0  37   1   0   2   0\n       5   23   0   0 106   0   0   0   0\n       6    0   1   0   0 373   0   0   0\n       7   58   0   1   0   2   0   0   0\n       8    0 181  14   0   0   0   0   0\n       9  365   0   0   1   0   0   0  25\n       10   0   1   0   0   0 373   1   0\n       11   0   1 312   0   0   0   0   0\n       12   0   0   0   0 219   0   0   0\n       13   0   0   0   0   1  23 167   0\n       14   0   0   0   0   0 152   0   0\n       15   0   0   0   0   0   0   0  87\n       16   0 169   1   0   0  28   0   0\n       17   0   5   2   1   2   0   0   0\n       18   0   0   0   0  15   3   0   0\n\n\n\n\n\n\n\n\n9.2.2 Dimensional reduction for clustering visualization\nPCA is a powerful linear approach to compress large datasets into smaller dimensional spaces. However, it struggles at emphasizing the existence of clusters in complex datasets, when visualized in 2D.\nscater provides a handy way to perform more complex data embeddings:\n- tSNE\n- UMAP\n- Diffusion Map\n- Multi-Dimensional Scaling (MDS)\n- Non-negative Matrix Factorization (NMF)\n\n\n\n\n\n\nQuestion\n\n\n\nExplore the different dimensional reduction algorithms, trying different hyperparameters combinations.\nWhen you run these commands, pay attention to how long each command takes to run! While this run, check the Help page for each function (e.g. ?runTSNE)\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nreducedDims(sce)\n\n\nList of length 1\nnames(1): PCA\n\nsce &lt;- scater::runTSNE(sce, subset_row = HVGs)\nsce &lt;- scater::runUMAP(sce, subset_row = HVGs)\nreducedDims(sce)\n\nList of length 3\nnames(3): PCA TSNE UMAP\n\nreducedDim(sce, 'UMAP')[1:10, ]\n\n           UMAP1       UMAP2\n [1,]  -9.031262   1.1058465\n [2,]  -8.480495   1.1084198\n [3,]  -8.472293   2.0415627\n [4,]   5.516679   4.0178343\n [5,]   5.099442   6.6821410\n [6,]   5.719905   1.8656587\n [7,] -10.495358 -11.3759941\n [8,]  -7.322145  -2.7512127\n [9,]  -2.773917 -14.4595874\n[10,] -10.519395   0.2750243\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nUse the scater::plotReducedDim() function to plot cells in each embedding. Comment.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nlibrary(patchwork)\np&lt;- scater::plotReducedDim(sce, 'PCA', colour_by = 'clusters_graph') + ggtitle('denoised PCA') +\n    scater::plotReducedDim(sce, 'TSNE', colour_by = 'clusters_graph') + ggtitle('tSNE') +\n    scater::plotReducedDim(sce, 'UMAP', colour_by = 'clusters_graph') + ggtitle('UMAP')\np\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n9.2.3 BONUS For the pros of clustering… Compare different clustering approaches\nLeveraging the bluster package, different clustering approaches can be performed using a uniformed syntax, to compare their output.\n\n\n\n\n\n\nQuestion\n\n\n\nUsing clusterSweep(), compare the effect of different k neighbor values when performing graph-based clustering.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nclusters &lt;- bluster::clusterSweep(\n    reducedDim(sce, 'PCA'), \n    BLUSPARAM = bluster::SNNGraphParam(),\n    k = c(5L, 15L, 25L, 50L), \n    cluster.fun = c(\"louvain\")\n)\ncolnames(clusters$clusters)\n\n\n[1] \"k.5_cluster.fun.louvain\"  \"k.15_cluster.fun.louvain\" \"k.25_cluster.fun.louvain\" \"k.50_cluster.fun.louvain\"\n\nhead(clusters$clusters)\n\nDataFrame with 6 rows and 4 columns\n  k.5_cluster.fun.louvain k.15_cluster.fun.louvain k.25_cluster.fun.louvain k.50_cluster.fun.louvain\n                 &lt;factor&gt;                 &lt;factor&gt;                 &lt;factor&gt;                 &lt;factor&gt;\n1                       1                        1                        1                        1\n2                       1                        1                        1                        1\n3                       1                        1                        1                        1\n4                       2                        2                        2                        2\n5                       3                        3                        3                        3\n6                       2                        2                        2                        3\n\nclusters$parameters\n\nDataFrame with 4 rows and 2 columns\n                                 k cluster.fun\n                         &lt;integer&gt; &lt;character&gt;\nk.5_cluster.fun.louvain          5     louvain\nk.15_cluster.fun.louvain        15     louvain\nk.25_cluster.fun.louvain        25     louvain\nk.50_cluster.fun.louvain        50     louvain\n\nlibrary(ggraph)\np &lt;- cowplot::plot_grid(\n    clustree::clustree(\n        clusters$clusters %&gt;% setNames(1:ncol(.)) %&gt;% as.data.frame(),\n        prefix = 'X',\n        edge_arrow=FALSE\n    ), \n    cowplot::plot_grid(\n        scater::plotReducedDim(sce, 'TSNE', colour_by = I(clusters$clusters[, 'k.5_cluster.fun.louvain'])) + ggtitle('k = 5'),\n        scater::plotReducedDim(sce, 'TSNE', colour_by = I(clusters$clusters[, 'k.15_cluster.fun.louvain'])) + ggtitle('k = 15'),\n        scater::plotReducedDim(sce, 'TSNE', colour_by = I(clusters$clusters[, 'k.25_cluster.fun.louvain'])) + ggtitle('k = 25'),\n        scater::plotReducedDim(sce, 'TSNE', colour_by = I(clusters$clusters[, 'k.50_cluster.fun.louvain'])) + ggtitle('k = 50')\n    ), \n    nrow = 2, \n    rel_heights = c(0.3, 0.7)\n)\np\n\n\n\n\n\n\ntable(clusters$clusters[, 'k.5_cluster.fun.louvain'])\n\n\n  1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18 \n440 370 645  40 129 372  61 197 373 425 374 221 190 153 127 195  10  18",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Lab 5: Dimension reduction, clustering and annotation</span>"
    ]
  },
  {
    "objectID": "content/day3/Lab5_clustering.html#cell-annotation",
    "href": "content/day3/Lab5_clustering.html#cell-annotation",
    "title": "\n9  Lab 5: Dimension reduction, clustering and annotation\n",
    "section": "\n9.3 Cell annotation",
    "text": "9.3 Cell annotation\n\n9.3.1 Find marker genes\nTo interpret clustering results, one needs to identify the genes that drive separation between clusters. These marker genes allow to assign biological meaning to each cluster based on their functional annotation. In the most obvious case, the marker genes for each cluster are a priori associated with particular cell types, allowing us to treat the clustering as a proxy for cell type identity.\nA general strategy is to perform DE tests between pairs of clusters and then combine results into a single ranking of marker genes for each cluster.\n\n\n\nR\n\nmarkers &lt;- scran::findMarkers(sce, groups = sce$clusters_graph)\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nFind markers strongly overexpressed in each cluster. Check ?scran::findMarkers to find the right options to use.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nmarkers &lt;- scran::findMarkers(\n    sce, \n    groups = sce$clusters_graph, \n    direction = \"up\", \n    lfc = 1\n)\nhead(markers[[1]])\n\n\nDataFrame with 6 rows and 21 columns\n              Top      p.value          FDR summary.logFC   logFC.2   logFC.3   logFC.4   logFC.5   logFC.6   logFC.7   logFC.8   logFC.9  logFC.10  logFC.11  logFC.12  logFC.13  logFC.14  logFC.15  logFC.16  logFC.17  logFC.18\n        &lt;integer&gt;    &lt;numeric&gt;    &lt;numeric&gt;     &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;\nS100A9          1  0.00000e+00  0.00000e+00       5.40387   5.42188   5.40387   5.37922   3.52168   5.40893  1.294656   5.30392  1.644270   5.50240   5.29065   5.25418   5.57545   5.38674   4.26055   5.40085   5.33183   5.16891\nS100A12         1 1.97522e-192 5.11947e-189       3.16111   3.14262   3.14895   3.05717   2.74610   3.16205  1.314524   3.13096  1.608067   3.14936   3.10250   3.13837   3.16111   3.13134   3.11511   3.10348   3.05426   3.15831\nS100A8          1  0.00000e+00  0.00000e+00       5.34448   5.38882   5.34448   5.23651   3.99067   5.36191  1.417517   5.32596  1.867977   5.42891   5.41001   5.36173   5.56272   5.42103   4.95055   5.45431   5.40752   5.25355\nMNDA            1 4.43265e-177 9.33460e-174       2.68947   2.62575   2.65169   2.68193   1.03566   2.63344  0.865663   2.61798  0.533280   2.67706   2.66449   2.63511   2.68947   2.67121   1.24065   2.66263   2.70210   2.65352\nVCAN            1 1.00809e-134 1.41527e-131       2.34337   2.31745   2.32817   2.35183   1.70646   2.32578  0.688140   2.34337  1.001976   2.32735   2.32037   2.30718   2.31799   2.33561   2.27122   2.33429   2.30372   2.27966\nLYZ             1  0.00000e+00  0.00000e+00       5.28329   5.27335   5.28329   5.32915   0.76238   5.23420  1.000078   5.33499  0.503247   5.31456   5.25931   5.31248   5.49477   5.27839   3.55637   5.27388   5.19983   5.14920\n\nmarkers &lt;- lapply(markers, function(df) {\n    rownames(df[df$Top &lt;= 5,])\n})\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nPlot average expression of the first marker of the first cluster in UMAP.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\np &lt;- scater::plotReducedDim(sce, 'TSNE', colour_by = markers[[2]][[1]])\np\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n9.3.2 Automated cell annotation\nMany cell type reference databases are available over the Internet. Today, we will use a reference constructed from Blueprint and ENCODE data (Martens and Stunnenberg 2013; The ENCODE Project Consortium 2012). This reference is available as a SummarizedExperiment containing log-normalized gene expression for manually annotated samples.\n\n\n\nR\n\nref &lt;- celldex::BlueprintEncodeData()\nprediction_types &lt;- SingleR::SingleR(\n    test = sce, \n    ref = ref, \n    labels = ref$label.main\n)\nsce$annotation &lt;- prediction_types$labels\ntable(sce$annotation)\n\n\n\n     B-cells CD4+ T-cells CD8+ T-cells           DC          HSC    Monocytes     NK cells \n         616          881         1390            1           14         1201          237 \n\ntable(sce$annotation, sce$clusters_graph)\n\n              \n                 1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18\n  B-cells        0   0   0  14   0 374   0   0   0   0   0 219   0   0   0   0   1   8\n  CD4+ T-cells   0 176 481   0   0   0   1  97   0   0  34   0   0   0   0  92   0   0\n  CD8+ T-cells   0 208 208   0   0   0   0  98   0 341 279   0   4 137   0 106   0   9\n  DC             0   0   0   0   1   0   0   0   0   0   0   0   0   0   0   0   0   0\n  HSC            0   0   0   5   0   0   0   0   0   0   0   0   0   0   0   0   9   0\n  Monocytes    514   0   0  21 128   0  60   0 391   0   0   0   0   0  87   0   0   0\n  NK cells       0   0   0   0   0   0   0   0   0  34   0   0 187  15   0   0   0   1\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nUsing scater and SingleR utilities, visually compare the annotation scores for cells in each cluster.\nDid the automated annotation work robuslty? How does it compare to our clustering? Is automated annotation as sensitive as graph-based clustering?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\np &lt;- SingleR::plotScoreHeatmap(prediction_types)\np\n\n\n\n\n\n\n\np &lt;- scater::plotReducedDim(sce, 'TSNE', colour_by = 'annotation') + ggtitle('Automated annotation')\np\n\n\n\n\n\n\np &lt;- pheatmap::pheatmap(\n    log2(table(Annotation = sce$annotation, Cluster = sce$clusters_graph)+10), \n    color = colorRampPalette(c(\"white\", \"darkred\"))(101)\n)",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Lab 5: Dimension reduction, clustering and annotation</span>"
    ]
  },
  {
    "objectID": "content/day3/Lab5_clustering.html#bonus",
    "href": "content/day3/Lab5_clustering.html#bonus",
    "title": "\n9  Lab 5: Dimension reduction, clustering and annotation\n",
    "section": "\n9.4 Bonus",
    "text": "9.4 Bonus\nTry to fill in the analysis template in bin/prepare_Ernst.R to execute the different processing/analysis steps we covered in the previous exercises and this one. If you prefer using Seurat, don’t hesitate to modify the base template!",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Lab 5: Dimension reduction, clustering and annotation</span>"
    ]
  },
  {
    "objectID": "content/day3/Lab5_clustering.html#acknowledgements",
    "href": "content/day3/Lab5_clustering.html#acknowledgements",
    "title": "\n9  Lab 5: Dimension reduction, clustering and annotation\n",
    "section": "\n9.5 Acknowledgements",
    "text": "9.5 Acknowledgements\nThis exercise was adapted from Chapts. 7-12 of Orchestrating Single-Cell Analysis with Bioconductor.",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Lab 5: Dimension reduction, clustering and annotation</span>"
    ]
  },
  {
    "objectID": "content/day3/Lab5_clustering.html#session-info",
    "href": "content/day3/Lab5_clustering.html#session-info",
    "title": "\n9  Lab 5: Dimension reduction, clustering and annotation\n",
    "section": "\n9.6 Session info",
    "text": "9.6 Session info\n\n\n─ Session info ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.5.1 (2025-06-13)\n os       Ubuntu 24.04.2 LTS\n system   x86_64, linux-gnu\n ui       X11\n language (EN)\n collate  en_IN.utf8\n ctype    en_IN.utf8\n tz       Europe/Paris\n date     2025-11-14\n pandoc   3.1.3 @ /usr/bin/ (via rmarkdown)\n quarto   1.5.55 @ /opt/quarto/bin/quarto\n\n─ Packages ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n package              * version  date (UTC) lib source\n abind                * 1.4-8    2024-09-12 [1] CRAN (R 4.5.1)\n alabaster.base         1.10.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n alabaster.matrix       1.10.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n alabaster.ranges       1.10.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n alabaster.schemas      1.10.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n alabaster.se           1.10.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n AnnotationDbi          1.72.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n AnnotationHub          4.0.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n backports              1.5.0    2024-05-23 [1] CRAN (R 4.5.1)\n beachmat               2.26.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n beeswarm               0.4.0    2021-06-01 [1] CRAN (R 4.5.1)\n Biobase              * 2.70.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocFileCache          3.0.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocGenerics         * 0.56.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocManager            1.30.27  2025-11-14 [1] CRAN (R 4.5.1)\n BiocNeighbors          2.4.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocParallel           1.44.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocSingular           1.26.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocVersion            3.22.0   2025-04-15 [1] Bioconductor 3.22 (R 4.5.1)\n Biostrings             2.78.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n bit                    4.6.0    2025-03-06 [1] CRAN (R 4.5.0)\n bit64                  4.6.0-1  2025-01-16 [1] CRAN (R 4.5.0)\n blob                   1.2.4    2023-03-17 [1] CRAN (R 4.5.1)\n bluster                1.20.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n cachem                 1.1.0    2024-05-16 [1] CRAN (R 4.5.1)\n celldex                1.20.0   2025-11-04 [1] Bioconductor 3.22 (R 4.5.1)\n checkmate              2.3.3    2025-08-18 [1] CRAN (R 4.5.1)\n cli                    3.6.5    2025-04-23 [1] CRAN (R 4.5.1)\n cluster                2.1.8.1  2025-03-12 [2] CRAN (R 4.5.1)\n clustree               0.5.1    2023-11-05 [1] CRAN (R 4.5.1)\n codetools              0.2-20   2024-03-31 [2] CRAN (R 4.5.1)\n cowplot                1.2.0    2025-07-07 [1] CRAN (R 4.5.1)\n crayon                 1.5.3    2024-06-20 [1] CRAN (R 4.5.1)\n curl                   7.0.0    2025-08-19 [1] CRAN (R 4.5.1)\n DBI                    1.2.3    2024-06-02 [1] CRAN (R 4.5.1)\n dbplyr                 2.5.1    2025-09-10 [1] CRAN (R 4.5.1)\n DelayedArray         * 0.36.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n DelayedMatrixStats     1.32.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n devtools               2.4.6    2025-10-03 [1] CRAN (R 4.5.1)\n dichromat              2.0-0.1  2022-05-02 [1] CRAN (R 4.5.1)\n digest                 0.6.38   2025-11-12 [1] CRAN (R 4.5.1)\n dplyr                * 1.1.4    2023-11-17 [1] CRAN (R 4.5.1)\n dqrng                  0.4.1    2024-05-28 [1] CRAN (R 4.5.1)\n edgeR                  4.8.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n ellipsis               0.3.2    2021-04-29 [1] CRAN (R 4.5.1)\n evaluate               1.0.5    2025-08-27 [1] CRAN (R 4.5.1)\n ExperimentHub          3.0.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n farver                 2.1.2    2024-05-13 [1] CRAN (R 4.5.1)\n fastmap                1.2.0    2024-05-15 [1] CRAN (R 4.5.1)\n filelock               1.0.3    2023-12-11 [1] CRAN (R 4.5.1)\n forcats              * 1.0.1    2025-09-25 [1] CRAN (R 4.5.1)\n fs                     1.6.6    2025-04-12 [1] CRAN (R 4.5.1)\n generics             * 0.1.4    2025-05-09 [1] CRAN (R 4.5.1)\n GenomicRanges        * 1.62.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n ggbeeswarm             0.7.2    2023-04-29 [1] CRAN (R 4.5.1)\n ggforce                0.5.0    2025-06-18 [1] CRAN (R 4.5.1)\n ggplot2              * 4.0.1    2025-11-14 [1] CRAN (R 4.5.1)\n ggraph               * 2.2.2    2025-08-24 [1] CRAN (R 4.5.1)\n ggrepel                0.9.6    2024-09-07 [1] CRAN (R 4.5.1)\n glue                   1.8.0    2024-09-30 [1] CRAN (R 4.5.1)\n graphlayouts           1.2.2    2025-01-23 [1] CRAN (R 4.5.0)\n gridExtra              2.3      2017-09-09 [1] CRAN (R 4.5.1)\n gtable                 0.3.6    2024-10-25 [1] CRAN (R 4.5.1)\n gypsum                 1.6.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n h5mread              * 1.2.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n HDF5Array            * 1.38.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n hms                    1.1.4    2025-10-17 [1] CRAN (R 4.5.1)\n htmltools              0.5.8.1  2024-04-04 [1] CRAN (R 4.5.1)\n htmlwidgets            1.6.4    2023-12-06 [1] CRAN (R 4.5.1)\n httr                   1.4.7    2023-08-15 [1] CRAN (R 4.5.1)\n httr2                  1.2.1    2025-07-22 [1] CRAN (R 4.5.1)\n igraph                 2.2.1    2025-10-27 [1] CRAN (R 4.5.1)\n IRanges              * 2.44.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n irlba                  2.3.5.1  2022-10-03 [1] CRAN (R 4.5.1)\n jsonlite               2.0.0    2025-03-27 [1] CRAN (R 4.5.1)\n KEGGREST               1.50.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n knitr                  1.50     2025-03-16 [1] CRAN (R 4.5.1)\n labeling               0.4.3    2023-08-29 [1] CRAN (R 4.5.1)\n lattice                0.22-7   2025-04-02 [2] CRAN (R 4.5.1)\n lifecycle              1.0.4    2023-11-07 [1] CRAN (R 4.5.1)\n limma                  3.66.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n locfit                 1.5-9.12 2025-03-05 [1] CRAN (R 4.5.0)\n lubridate            * 1.9.4    2024-12-08 [1] CRAN (R 4.5.0)\n magrittr               2.0.4    2025-09-12 [1] CRAN (R 4.5.1)\n MASS                   7.3-65   2025-02-28 [2] CRAN (R 4.5.1)\n Matrix               * 1.7-3    2025-03-11 [1] CRAN (R 4.5.1)\n MatrixGenerics       * 1.22.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n matrixStats          * 1.5.0    2025-01-07 [1] CRAN (R 4.5.0)\n memoise                2.0.1    2021-11-26 [1] CRAN (R 4.5.1)\n metapod                1.18.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n patchwork            * 1.3.2    2025-08-25 [1] CRAN (R 4.5.1)\n pheatmap               1.0.13   2025-06-05 [1] CRAN (R 4.5.1)\n pillar                 1.11.1   2025-09-17 [1] CRAN (R 4.5.1)\n pkgbuild               1.4.8    2025-05-26 [1] CRAN (R 4.5.1)\n pkgconfig              2.0.3    2019-09-22 [1] CRAN (R 4.5.1)\n pkgload                1.4.1    2025-09-23 [1] CRAN (R 4.5.1)\n png                    0.1-8    2022-11-29 [1] CRAN (R 4.5.1)\n polyclip               1.10-7   2024-07-23 [1] CRAN (R 4.5.1)\n purrr                * 1.2.0    2025-11-04 [1] CRAN (R 4.5.1)\n R6                     2.6.1    2025-02-15 [1] CRAN (R 4.5.0)\n rappdirs               0.3.3    2021-01-31 [1] CRAN (R 4.5.1)\n RColorBrewer           1.1-3    2022-04-03 [1] CRAN (R 4.5.1)\n Rcpp                   1.1.0    2025-07-02 [1] CRAN (R 4.5.1)\n RcppAnnoy              0.0.22   2024-01-23 [1] CRAN (R 4.5.1)\n readr                * 2.1.5    2024-01-10 [1] CRAN (R 4.5.1)\n remotes                2.5.0    2024-03-17 [1] CRAN (R 4.5.1)\n rhdf5                * 2.54.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n rhdf5filters           1.22.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n Rhdf5lib               1.32.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n rlang                  1.1.6    2025-04-11 [1] CRAN (R 4.5.1)\n rmarkdown              2.30     2025-09-28 [1] CRAN (R 4.5.1)\n RSpectra               0.16-2   2024-07-18 [1] CRAN (R 4.5.1)\n RSQLite                2.4.4    2025-11-10 [1] CRAN (R 4.5.1)\n rsvd                   1.0.5    2021-04-16 [1] CRAN (R 4.5.1)\n Rtsne                  0.17     2023-12-07 [1] CRAN (R 4.5.1)\n S4Arrays             * 1.10.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n S4Vectors            * 0.48.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n S7                     0.2.0    2024-11-07 [1] CRAN (R 4.5.1)\n ScaledMatrix           1.18.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n scales                 1.4.0    2025-04-24 [1] CRAN (R 4.5.1)\n scater                 1.38.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n scran                  1.38.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n scuttle                1.20.0   2025-10-30 [1] Bioconductor 3.22 (R 4.5.1)\n Seqinfo              * 1.0.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n sessioninfo            1.2.3    2025-02-05 [1] CRAN (R 4.5.0)\n SingleCellExperiment * 1.32.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n SingleR                2.12.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n SparseArray          * 1.10.1   2025-10-31 [1] Bioconductor 3.22 (R 4.5.1)\n sparseMatrixStats      1.22.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n statmod                1.5.1    2025-10-09 [1] CRAN (R 4.5.1)\n stringi                1.8.7    2025-03-27 [1] CRAN (R 4.5.1)\n stringr              * 1.6.0    2025-11-04 [1] CRAN (R 4.5.1)\n SummarizedExperiment * 1.40.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n TENxPBMCData         * 1.28.0   2025-11-04 [1] Bioconductor 3.22 (R 4.5.1)\n tibble               * 3.3.0    2025-06-08 [1] CRAN (R 4.5.1)\n tidygraph              1.3.1    2024-01-30 [1] CRAN (R 4.5.1)\n tidyr                * 1.3.1    2024-01-24 [1] CRAN (R 4.5.1)\n tidyselect             1.2.1    2024-03-11 [1] CRAN (R 4.5.1)\n tidyverse            * 2.0.0    2023-02-22 [1] CRAN (R 4.5.1)\n timechange             0.3.0    2024-01-18 [1] CRAN (R 4.5.1)\n tweenr                 2.0.3    2024-02-26 [1] CRAN (R 4.5.1)\n tzdb                   0.5.0    2025-03-15 [1] CRAN (R 4.5.1)\n usethis                3.2.1    2025-09-06 [1] CRAN (R 4.5.1)\n uwot                   0.2.4    2025-11-10 [1] CRAN (R 4.5.1)\n vctrs                  0.6.5    2023-12-01 [1] CRAN (R 4.5.1)\n vipor                  0.4.7    2023-12-18 [1] CRAN (R 4.5.1)\n viridis                0.6.5    2024-01-29 [1] CRAN (R 4.5.1)\n viridisLite            0.4.2    2023-05-02 [1] CRAN (R 4.5.1)\n withr                  3.0.2    2024-10-28 [1] CRAN (R 4.5.1)\n xfun                   0.54     2025-10-30 [1] CRAN (R 4.5.1)\n XVector                0.50.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n yaml                   2.3.10   2024-07-26 [1] CRAN (R 4.5.1)\n\n [1] /home/rsg/R/x86_64-pc-linux-gnu-library/4.5\n [2] /opt/R/4.5.1/lib/R/library\n * ── Packages attached to the search path.\n\n──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Lab 5: Dimension reduction, clustering and annotation</span>"
    ]
  },
  {
    "objectID": "content/day3/Lecture5_batchcorrection.html",
    "href": "content/day3/Lecture5_batchcorrection.html",
    "title": "10  Lecture 5 - Data integration and batch effect correction",
    "section": "",
    "text": "Slides here",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Lecture 5 - Data integration and batch effect correction</span>"
    ]
  },
  {
    "objectID": "content/day3/Lab6_batch_correction.html",
    "href": "content/day3/Lab6_batch_correction.html",
    "title": "\n11  Lab 6: Batch correction\n",
    "section": "",
    "text": "11.1 Read in pancreas expression matrices\nFour different datasets are provided in the ~/Share/batch_correction/ directory. These datasets were collected using different single cell RNA-seq technologies.",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Lab 6: Batch correction</span>"
    ]
  },
  {
    "objectID": "content/day3/Lab6_batch_correction.html#read-in-pancreas-expression-matrices",
    "href": "content/day3/Lab6_batch_correction.html#read-in-pancreas-expression-matrices",
    "title": "\n11  Lab 6: Batch correction\n",
    "section": "",
    "text": "Question\n\n\n\nImport the four datasets into R. What is the size and sparsity of each dataset?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ncelseq.data &lt;- read.table(\"~/Share/batch_correction/pancreas_multi_celseq_expression_matrix.txt.gz\")\ncelseq2.data &lt;- read.table(\"~/Share/batch_correction/pancreas_multi_celseq2_expression_matrix.txt.gz\")\nfluidigmc1.data &lt;- read.table(\"~/Share/batch_correction/pancreas_multi_fluidigmc1_expression_matrix.txt.gz\")\nsmartseq2.data &lt;- read.table(\"~/Share/batch_correction/pancreas_multi_smartseq2_expression_matrix.txt.gz\")\n\n\nCoerce each dataset to a sparse matrix for efficiency.\n\n\n\nR\n\n# Convert to sparse matrices for efficiency\nlibrary(Matrix)\ncelseq.data &lt;- as(as.matrix(celseq.data), \"dgCMatrix\")\ncelseq2.data &lt;- as(as.matrix(celseq2.data), \"dgCMatrix\")\nfluidigmc1.data &lt;- as(as.matrix(fluidigmc1.data), \"dgCMatrix\")\nsmartseq2.data &lt;- as(as.matrix(smartseq2.data), \"dgCMatrix\")",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Lab 6: Batch correction</span>"
    ]
  },
  {
    "objectID": "content/day3/Lab6_batch_correction.html#analyze-each-pancreas-dataset-without-batch-correction",
    "href": "content/day3/Lab6_batch_correction.html#analyze-each-pancreas-dataset-without-batch-correction",
    "title": "\n11  Lab 6: Batch correction\n",
    "section": "\n11.2 Analyze each pancreas dataset without batch correction",
    "text": "11.2 Analyze each pancreas dataset without batch correction\nWe will first analyze each dataset separately to see if there are any differences between the datasets.\n\n\n\n\n\n\nQuestion\n\n\n\nWhat is the size of each single cell RNA-seq dataset?\nBriefly describe the technology used to collect each dataset.\nWhich datasets do you expect to be different and which do you expect to be similar?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ndim(celseq.data)\n\n\n[1] 20148  1728\n\ndim(celseq2.data)\n\n[1] 19140  3072\n\ndim(fluidigmc1.data)\n\n[1] 25463   638\n\ndim(smartseq2.data)\n\n[1] 26179  3514\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nCreate a Seurat object for each dataset, and look at the distributions of number of genes per cell.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nlibrary(Seurat)\n\n\nLoading required package: SeuratObject\n\n\nLoading required package: sp\n\n\n\nAttaching package: 'SeuratObject'\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, t\n\n# CEL-Seq (https://www.cell.com/cell-reports/fulltext/S2211-1247(12)00228-8)\ncelseq &lt;- CreateSeuratObject(counts = celseq.data)\nVlnPlot(celseq, \"nFeature_RNA\")\n\nWarning: Default search for \"data\" layer in \"RNA\" assay yielded no results; utilizing \"counts\" layer instead.\n\n\n\n\n\n\n\n# CEL-Seq2 https://www.cell.com/molecular-cell/fulltext/S1097-2765(09)00641-8\ncelseq2 &lt;- CreateSeuratObject(counts = celseq2.data)\n\nWarning: Feature names cannot have underscores ('_'), replacing with dashes ('-')\n\nVlnPlot(celseq2, \"nFeature_RNA\")\n\nWarning: Default search for \"data\" layer in \"RNA\" assay yielded no results; utilizing \"counts\" layer instead.\n\n\n\n\n\n\n\n# Fluidigm C1\nfluidigmc1 &lt;- CreateSeuratObject(counts = fluidigmc1.data)\n\nWarning: Feature names cannot have underscores ('_'), replacing with dashes ('-')\n\nVlnPlot(fluidigmc1, \"nFeature_RNA\")\n\nWarning: Default search for \"data\" layer in \"RNA\" assay yielded no results; utilizing \"counts\" layer instead.\n\n\n\n\n\n\n\n# SMART-Seq2\nsmartseq2 &lt;- CreateSeuratObject(counts = smartseq2.data)\n\nWarning: Feature names cannot have underscores ('_'), replacing with dashes ('-')\n\nVlnPlot(smartseq2, \"nFeature_RNA\")\n\nWarning: Default search for \"data\" layer in \"RNA\" assay yielded no results; utilizing \"counts\" layer instead.\n\n\n\n\n\n\n\n\n\n\n\n\n\nNow we will subset the data to remove cells with low gene counts and normalize the data.\n\n\n\n\n\n\nQuestion\n\n\n\nSubset the data to remove cells with:\n\nfewer than 1750 genes for CEL-Seq;\nfewer than 2500 genes for CEL-Seq2;\nfewer than 2500 genes for SMART-Seq2.\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ncelseq &lt;- subset(celseq, subset = nFeature_RNA &gt; 1750)\nVlnPlot(celseq, \"nFeature_RNA\")\n\n\nWarning: Default search for \"data\" layer in \"RNA\" assay yielded no results; utilizing \"counts\" layer instead.\n\n\n\n\n\n\n\ncelseq2 &lt;- subset(celseq2, subset = nFeature_RNA &gt; 2500)\nVlnPlot(celseq2, \"nFeature_RNA\")\n\nWarning: Default search for \"data\" layer in \"RNA\" assay yielded no results; utilizing \"counts\" layer instead.\n\n\n\n\n\n\n\nsmartseq2 &lt;- subset(smartseq2, subset = nFeature_RNA &gt; 2500)\nVlnPlot(smartseq2, \"nFeature_RNA\")\n\nWarning: Default search for \"data\" layer in \"RNA\" assay yielded no results; utilizing \"counts\" layer instead.\n\n\n\n\n\n\n\n\n\n\n\n\n\nNow we will subsample each dataset to only have 500 cells. This is to speed up subsequent analyses. Often when we are setting up our analysis, we work with a subset of the data to make iteration across analysis decisions faster, and once we have finalized how we want to do the analysis, we work with the full dataset.\n\n\n\n\n\n\nQuestion\n\n\n\n\nWithin metadata dataframe, save what technology each dataset was generated with.\nRandomly subsample each full dataset to 500 cells.\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ncelseq[[\"tech\"]] &lt;- \"celseq\"\ncelseq2[[\"tech\"]] &lt;- \"celseq2\"\nfluidigmc1[[\"tech\"]] &lt;- \"fluidigmc1\"\nsmartseq2[[\"tech\"]] &lt;- \"smartseq2\"\nIdents(celseq) &lt;- \"tech\"\nIdents(celseq2) &lt;- \"tech\"\nIdents(fluidigmc1) &lt;- \"tech\"\nIdents(smartseq2) &lt;- \"tech\"\n\n# This code sub-samples the data in order to speed up calculations and not use too much memory.\ncelseq &lt;- subset(celseq, downsample = 500, seed = 1)\ncelseq2 &lt;- subset(celseq2, downsample = 500, seed = 1)\nfluidigmc1 &lt;- subset(fluidigmc1, downsample = 500, seed = 1)\nsmartseq2 &lt;- subset(smartseq2, downsample = 500, seed = 1)",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Lab 6: Batch correction</span>"
    ]
  },
  {
    "objectID": "content/day3/Lab6_batch_correction.html#cluster-pancreatic-datasets-without-batch-correction",
    "href": "content/day3/Lab6_batch_correction.html#cluster-pancreatic-datasets-without-batch-correction",
    "title": "\n11  Lab 6: Batch correction\n",
    "section": "\n11.3 Cluster pancreatic datasets without batch correction",
    "text": "11.3 Cluster pancreatic datasets without batch correction\nWe will first merge all the cells from the four different experiments together, and cluster all the pancreatic islet datasets to see whether there is a batch effect.\n\n\n\n\n\n\nQuestion\n\n\n\nMerge the datasets into a single Seurat object.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\n# Merge Seurat objects. Original sample identities are stored in gcdata[[\"tech\"]].\n# Cell names will now have the format tech_cellID (smartseq2_cell1...)\nadd.cell.ids &lt;- c(\"celseq\", \"celseq2\", \"fluidigmc1\", \"smartseq2\")\ngcdata &lt;- merge(x = celseq, y = list(celseq2, fluidigmc1, smartseq2), add.cell.ids = add.cell.ids, merge.data = FALSE)\n\n# Examine gcdata. Notice that there are now 4 counts layers, one layer for each technology.\ngcdata\n\n\nAn object of class Seurat \n33633 features across 2000 samples within 1 assay \nActive assay: RNA (33633 features, 0 variable features)\n 4 layers present: counts.1, counts.2, counts.3, counts.4\n\nVlnPlot(gcdata, \"nFeature_RNA\", group.by = \"tech\")\n\nWarning: Default search for \"data\" layer in \"RNA\" assay yielded no results; utilizing \"counts\" layer instead.\n\n\n\n\n\n\n\n\n\n\n\n\n\nAfter merging, we normalize the data with LogNormalize method, and identify the 2000 most variable genes for each dataset, using the vst approach. Then we scale the data using ScaleData.\n\n\n\n\n\n\nQuestion\n\n\n\nWhat is the difference between SelectIntegrationFeatures and FindVariableFeatures in Seurat? Take a look at the documentation for both functions.\nRun NormalizeData, FindVariableFeatures, and ScaleData on the merged dataset.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ngcdata &lt;- NormalizeData(gcdata, normalization.method = \"LogNormalize\", scale.factor = 10000)\n\n\nNormalizing layer: counts.1\n\n\nNormalizing layer: counts.2\n\n\nNormalizing layer: counts.3\n\n\nNormalizing layer: counts.4\n\ngcdata &lt;- FindVariableFeatures(gcdata, nfeatures = 2000, verbose = TRUE, selection.method = \"vst\")\n\nFinding variable features for layer counts.1\n\n\nFinding variable features for layer counts.2\n\n\nFinding variable features for layer counts.3\n\n\nFinding variable features for layer counts.4\n\ngcdata &lt;- ScaleData(gcdata, features = VariableFeatures(gcdata))\n\nCentering and scaling data matrix\n\n\n\n\n\n\n\nNow that data is merged, normalized, and scaled, we will perform principal component analysis (PCA) and visualize the data.\n\n\n\n\n\n\nQuestion\n\n\n\nDo PCA on data including only the variable genes.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ngcdata &lt;- RunPCA(gcdata, features = VariableFeatures(gcdata), npcs = 40, ndims.print = 1:5, nfeatures.print = 5)\n\n\nPC_ 1 \nPositive:  CHGB, SCG2, ABCC8, PAM, CHGA \nNegative:  IFITM3, ZFP36L1, TACSTD2, ANXA4, LGALS3 \nPC_ 2 \nPositive:  KRT8, CLDN4, ELF3, GATM, CFB \nNegative:  SPARC, COL1A2, COL3A1, COL15A1, COL5A1 \nPC_ 3 \nPositive:  CCDC142, RAMP2-AS1, L2HGDH, NLRP12, TMEM212 \nNegative:  PDGFRB, COL15A1, SFRP2, COL1A2, BGN \nPC_ 4 \nPositive:  CFTR, AQP1, VTCN1, SPP1, KRT19 \nNegative:  CPA2, CTRC, CTRB1, CPA1, CTRB2 \nPC_ 5 \nPositive:  PFKFB2, HADH, INS, IAPP, ADCYAP1 \nNegative:  TM4SF4, GC, IRX2, ARX, CRYBA2 \n\n\n\n\n\nColor the PCA biplot by the scRNA-seq technology.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nDimPlot(gcdata, reduction = \"pca\", dims = c(1, 2), group.by = \"tech\")\n\n\n\n\n\n\n\n\n\n\n\n\n\nNow we will cluster the cells and visualize the clusters in reduced dimensional space.\n\n\n\n\n\n\nQuestion\n\n\n\n\nFind the k=20 nearest neighbors for each cell in the PCA space, using the first 20 principal components.\nCluster the cells.\nPerform UMAP embedding and visualize clustering results in 2D.\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\n# Cluster the cells using the first twenty principal components.\ngcdata &lt;- FindNeighbors(gcdata, reduction = \"pca\", dims = 1:20, k.param = 20)\n\n\nComputing nearest neighbor graph\n\n\nComputing SNN\n\ngcdata &lt;- FindClusters(gcdata, resolution = 0.8, algorithm = 1, random.seed = 100)\n\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 2000\nNumber of edges: 59992\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9181\nNumber of communities: 16\nElapsed time: 0 seconds\n\n# Create a UMAP visualization. \ngcdata &lt;- RunUMAP(gcdata, dims = 1:20, reduction = \"pca\", n.neighbors = 15, min.dist = 0.5, spread = 1, metric = \"euclidean\", seed.use = 1)  \n\nWarning: The default method for RunUMAP has changed from calling Python UMAP via reticulate to the R-native UWOT using the cosine metric\nTo use Python UMAP via reticulate, set umap.method to 'umap-learn' and metric to 'correlation'\nThis message will be shown once per session\n\n\n16:34:30 UMAP embedding parameters a = 0.583 b = 1.334\n\n\n16:34:30 Read 2000 rows and found 20 numeric columns\n\n\n16:34:30 Using FNN for neighbor search, n_neighbors = 15\n\n\n16:34:30 Commencing smooth kNN distance calibration using 1 thread with target n_neighbors = 15\n16:34:31 Initializing from normalized Laplacian + noise (using RSpectra)\n16:34:31 Commencing optimization for 500 epochs, with 39324 positive edges\n16:34:31 Using rng type: pcg\n16:34:32 Optimization finished\n\n# Visualize the Leiden clustering and the batches on the UMAP. \n# Remember, the clustering is stored in @meta.data in column seurat_clusters and the technology is\n# stored in the column tech. Remember you can also use DimPlot\nDimPlot(gcdata, reduction = \"umap\", group.by = \"seurat_clusters\")\n\n\n\n\n\n\nDimPlot(gcdata, reduction = \"umap\", group.by = \"tech\")\n\n\n\n\n\n\n\n\n\n\nAre you surprised by the results? Compare to your expectations from the PC biplot of PC1 vs PC2.\nWhat explains these results?\n\n\nWe can assess the quality of the clustering by calculating the adjusted rand index (ARI) between the technology and the cluster labels. This goes between 0 (completely dissimilar clustering) to 1 (identical clustering). The adjustment corrects for chance grouping between cluster elements.\n\n\n\nR\n\nlibrary(fossil)\n\n\nLoading required package: maps\n\n\nLoading required package: shapefiles\n\n\nLoading required package: foreign\n\n\n\nAttaching package: 'shapefiles'\n\n\nThe following objects are masked from 'package:foreign':\n\n    read.dbf, write.dbf\n\nari &lt;- dplyr::select(gcdata[[]], tech, seurat_clusters)\nari$tech &lt;- plyr::mapvalues(ari$tech, from = c(\"celseq\", \"celseq2\", \"fluidigmc1\", \"smartseq2\"), to = c(0, 1, 2, 3))\nadj.rand.index(as.numeric(ari$tech), as.numeric(ari$seurat_clusters))\n\n[1] 0.788981",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Lab 6: Batch correction</span>"
    ]
  },
  {
    "objectID": "content/day3/Lab6_batch_correction.html#batch-correction-canonical-correlation-analysis-cca-mutual-nearest-neighbors-mnn",
    "href": "content/day3/Lab6_batch_correction.html#batch-correction-canonical-correlation-analysis-cca-mutual-nearest-neighbors-mnn",
    "title": "\n11  Lab 6: Batch correction\n",
    "section": "\n11.4 Batch correction: canonical correlation analysis (CCA)+ mutual nearest neighbors (MNN)",
    "text": "11.4 Batch correction: canonical correlation analysis (CCA)+ mutual nearest neighbors (MNN)\nWe will now use Seurat to see to what extent it can remove potential batch effects.\nThe first piece of code will identify variable genes that are highly variable in at least 2/4 datasets. We will use these variable genes in our batch correction.\nWhy would we implement such a requirement?\n\n\n\n\n\n\nQuestion\n\n\n\nThe integration workflow in Seurat requires the identification of variable genes that are variable across most samples. Use the IntegrateLayers function, with the CCAIntegration method, to identify anchors on the 4 pancreatic islet datasets, commonly shared variable genes across samples, and integrate samples.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ngcdata &lt;- IntegrateLayers(object = gcdata, method = CCAIntegration, orig.reduction = \"pca\", new.reduction = \"integrated.cca\", verbose = FALSE)\n\n\n\n\n\n\n\nNow that the integration anchors have been used to integrate multiple datasets, we will perform the same clustering analysis as before.\n\n\n\n\n\n\nQuestion\n\n\n\n\nPerform analysis in the new integrated.cca dimensional reduction space.\nCluster the cells.\nPerform UMAP embedding and visualize clustering results in 2D.\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\n# Re-join the four layers after integration.\ngcdata[[\"RNA\"]] &lt;- JoinLayers(gcdata[[\"RNA\"]])\n\n# Clustering\ngcdata &lt;- FindNeighbors(gcdata, reduction = \"integrated.cca\", dims = 1:20, k.param = 20)\n\n\nComputing nearest neighbor graph\n\n\nComputing SNN\n\ngcdata &lt;- FindClusters(gcdata, resolution = 0.8, algorithm = 1, random.seed = 100)\n\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 2000\nNumber of edges: 84898\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.8422\nNumber of communities: 8\nElapsed time: 0 seconds\n\n# UMAP\ngcdata &lt;- RunUMAP(gcdata, dims = 1:30, reduction = \"integrated.cca\", n.neighbors = 15, min.dist = 0.5, spread = 1, metric = \"euclidean\", seed.use = 1)\n\n16:34:44 UMAP embedding parameters a = 0.583 b = 1.334\n\n\n16:34:44 Read 2000 rows and found 30 numeric columns\n\n\n16:34:44 Using FNN for neighbor search, n_neighbors = 15\n\n\n16:34:44 Commencing smooth kNN distance calibration using 1 thread with target n_neighbors = 15\n16:34:45 Initializing from normalized Laplacian + noise (using RSpectra)\n16:34:45 Commencing optimization for 500 epochs, with 44152 positive edges\n16:34:45 Using rng type: pcg\n16:34:46 Optimization finished\n\n# Visualize the Louvain clustering and the batches on the UMAP. \np1 &lt;- DimPlot(gcdata, reduction = \"umap\", group.by = \"seurat_clusters\")\np2 &lt;- DimPlot(gcdata, reduction = \"umap\", group.by = \"tech\")\np1 + p2\n\n\n\n\n\n\n# Individually Visualize each technology dataset.\nDimPlot(gcdata, reduction = \"umap\", split.by = \"tech\")\n\n\n\n\n\n\n\n\n\n\n\n\nLet’s look again to see how the adjusted rand index changed compared to using no batch correction.\n\n\n\nR\n\nari &lt;- dplyr::select(gcdata[[]], tech, seurat_clusters)\nari$tech &lt;- plyr::mapvalues(ari$tech, from = c(\"celseq\", \"celseq2\", \"fluidigmc1\", \"smartseq2\"), to = c(0, 1, 2, 3))\nadj.rand.index(as.numeric(ari$tech), as.numeric(ari$seurat_clusters))\n\n\n[1] 0.2974902\n\n\n\n11.4.1 Differential gene expression and visualization\nWe can also identify conserved marker genes across the batches. Differential gene expression is done across each batch, and the p-values are combined. (requires metap package installation). Note that we use the original expression data in all visualization and DE tests. We should never use values from the integrated data in DE tests, as they violate assumptions of independence among samples that are required for DE tests!\n\n\n\nR\n\nmarkers &lt;- FindConservedMarkers(gcdata, ident.1 = 0, grouping.var = \"tech\", assay = \"RNA\", print.bar = TRUE)\n\n\nTesting group celseq: (0) vs (3, 2, 1, 4, 5, 7, 6)\n\n\nFor a (much!) faster implementation of the Wilcoxon Rank Sum Test,\n(default method for FindMarkers) please install the presto package\n--------------------------------------------\ninstall.packages('devtools')\ndevtools::install_github('immunogenomics/presto')\n--------------------------------------------\nAfter installation of presto, Seurat will automatically use the more \nefficient implementation (no further action necessary).\nThis message will be shown once per session\n\n\nTesting group celseq2: (0) vs (2, 3, 6, 7, 1, 4, 5)\n\n\nTesting group fluidigmc1: (0) vs (2, 1, 4, 7, 3, 6, 5)\n\n\nTesting group smartseq2: (0) vs (1, 5, 4, 6, 3, 2, 7)\n\nhead(markers)\n\n       celseq_p_val celseq_avg_log2FC celseq_pct.1 celseq_pct.2 celseq_p_val_adj celseq2_p_val celseq2_avg_log2FC celseq2_pct.1 celseq2_pct.2 celseq2_p_val_adj fluidigmc1_p_val fluidigmc1_avg_log2FC fluidigmc1_pct.1 fluidigmc1_pct.2\nIRX2   1.843476e-64          4.347707        0.921        0.090     6.200163e-60  1.283278e-51           2.570787         0.973         0.235      4.316050e-47     7.368958e-57              2.929098            0.902            0.151\nGCG    1.587414e-38          4.459474        0.987        0.833     5.338949e-34  8.000277e-48           2.934182         1.000         1.000      2.690733e-43     3.258800e-62              3.802857            1.000            0.961\nTTR    3.773468e-40          4.030896        0.987        0.851     1.269131e-35  7.743786e-49           2.524005         1.000         1.000      2.604468e-44     1.942824e-55              2.552459            1.000            0.927\nPCSK2  1.457780e-42          3.574145        0.987        0.495     4.902950e-38  6.129371e-43           1.955597         1.000         0.938      2.061491e-38     5.514796e-32              1.541255            1.000            0.860\nF10    2.770889e-25          3.810780        0.447        0.050     9.319332e-21  1.445770e-34           2.437768         0.726         0.145      4.862557e-30     1.590705e-40              2.116824            0.762            0.134\nCRYBA2 4.420424e-51          4.426638        0.974        0.250     1.486721e-46  1.105901e-39           2.274519         0.920         0.310      3.719477e-35     1.305567e-31              2.144770            0.944            0.451\n       fluidigmc1_p_val_adj smartseq2_p_val smartseq2_avg_log2FC smartseq2_pct.1 smartseq2_pct.2 smartseq2_p_val_adj     max_pval minimump_p_val\nIRX2           2.478402e-52    2.668250e-79             4.677732           0.932           0.079        8.974126e-75 1.283278e-51   1.067300e-78\nGCG            1.096032e-57    1.614807e-78             5.761539           1.000           0.979        5.431082e-74 1.587414e-38   6.459230e-78\nTTR            6.534299e-51    3.340090e-78             3.909933           1.000           0.986        1.123373e-73 3.773468e-40   1.336036e-77\nPCSK2          1.854791e-27    1.412789e-70             2.832042           1.000           0.664        4.751634e-66 5.514796e-32   5.651156e-70\nF10            5.350019e-36    2.711033e-69             3.565487           0.968           0.304        9.118018e-65 2.770889e-25   1.084413e-68\nCRYBA2         4.391014e-27    4.470082e-69             4.510868           0.986           0.546        1.503423e-64 1.305567e-31   1.788033e-68\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nVisualize the expression of the first 5 marker genes on UMAP across the different batches using DoHeatmap.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ngcdata &lt;- ScaleData(gcdata, features = rownames(gcdata), do.center = T, do.scale = F)\n\n\nCentering data matrix\n\n\nWarning: Different features in new layer data than already exists for scale.data\n\nDoHeatmap(gcdata, features = rownames(markers)[1:5], group.by = \"tech\", disp.max = 3)\n\n\n\n\n\n\n\n\n\n\nCheck the expression of some known marker genes for pancreatic cells (see the Human pancreas cell atlas).\n\n\n\nR\n\ngenes &lt;- c(\"GCG\", \"INS\", \"SST\", \"PPY\", \"PRSS1\", \"KRT19\", \"PECAM1\", \"COL1A1\")\nFeaturePlot(gcdata, genes, ncol = 4)",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Lab 6: Batch correction</span>"
    ]
  },
  {
    "objectID": "content/day3/Lab6_batch_correction.html#batch-correction-integrative-non-negative-matrix-factorization-nmf",
    "href": "content/day3/Lab6_batch_correction.html#batch-correction-integrative-non-negative-matrix-factorization-nmf",
    "title": "\n11  Lab 6: Batch correction\n",
    "section": "\n11.5 Batch correction: integrative non-negative matrix factorization (NMF)",
    "text": "11.5 Batch correction: integrative non-negative matrix factorization (NMF)\nHere we use integrative non-negative matrix factorization (NMF/LIGER) to see to what extent it can remove potential batch effects.\nThe important parameters in the batch correction are the number of factors (k), the penalty parameter (lambda), and the clustering resolution. The number of factors sets the number of factors (consisting of shared and dataset-specific factors) used in factorizing the matrix. The penalty parameter sets the balance between factors shared across the batches and factors specific to the individual batches. The default setting of lambda=5.0 is usually used by the Macosko lab. Resolution=1.0 is used in the Louvain clustering of the shared neighbor factors that have been quantile normalized.\n\n\n\nR\n\nob.list &lt;- list(\"celseq\" = celseq, \"celseq2\" = celseq2, \"fluidigmc1\" = fluidigmc1, \"smartseq2\" = smartseq2)\n\n# Create a LIGER object with raw counts data from each batch.\nlibrary(rliger)\n\n\nPackage `rliger` has been updated massively since version 1.99.0, including the object structure which is not compatible with old versions.\n\nWe recommand you backup your old analysis before overwriting any existing result.\n\n`readLiger()` is provided for reading an RDS file storing an old object and it converts the object to the up-to-date structure.\n\ndata.liger &lt;- createLiger(sapply(ob.list, function(data) LayerData(data[['RNA']], 'counts')[, colnames(data)]))\n\n! No human mitochondrial gene found in the union of dataset \"celseq\"\n\n\nℹ calculating QC for dataset \"celseq\"\n\n\nℹ Updated QC variables: \"nUMI\", \"nGene\", \"mito\", \"ribo\", and \"hemo\"\n\n\nℹ calculating QC for dataset \"celseq\"\n✔ calculating QC for dataset \"celseq\" ... done\n\n! No human mitochondrial gene found in the union of dataset \"celseq2\"\nℹ calculating QC for dataset \"celseq2\"\nℹ Updated QC variables: \"nUMI\", \"nGene\", \"mito\", \"ribo\", and \"hemo\"\nℹ calculating QC for dataset \"celseq2\"\n✔ calculating QC for dataset \"celseq2\" ... done\n\nℹ calculating QC for dataset \"fluidigmc1\"\nℹ Updated QC variables: \"nUMI\", \"nGene\", \"mito\", \"ribo\", and \"hemo\"\nℹ calculating QC for dataset \"fluidigmc1\"\n✔ calculating QC for dataset \"fluidigmc1\" ... done\n\n! No human mitochondrial gene found in the union of dataset \"smartseq2\"\nℹ calculating QC for dataset \"smartseq2\"\nℹ Updated QC variables: \"nUMI\", \"nGene\", \"mito\", \"ribo\", and \"hemo\"\nℹ calculating QC for dataset \"smartseq2\"\n✔ calculating QC for dataset \"smartseq2\" ... done\n\n# Normalize gene expression for each batch.\ndata.liger &lt;- rliger::normalize(data.liger)\n\nℹ Normalizing datasets \"celseq\"\n✔ Normalizing datasets \"celseq\" ... done\n\nℹ Normalizing datasets \"celseq2\"\n✔ Normalizing datasets \"celseq2\" ... done\n\nℹ Normalizing datasets \"fluidigmc1\"\n✔ Normalizing datasets \"fluidigmc1\" ... done\n\nℹ Normalizing datasets \"smartseq2\"\n✔ Normalizing datasets \"smartseq2\" ... done\n\n# Find variable genes for LIGER analysis. Identify variable genes that are variable across most samples.\nvar.genes &lt;- SelectIntegrationFeatures(ob.list, nfeatures = 2000, verbose = TRUE, fvf.nfeatures = 2000, selection.method = \"vst\")\n\nNo variable features found for object1 in the object.list. Running FindVariableFeatures ...\nFinding variable features for layer counts\nNo variable features found for object2 in the object.list. Running FindVariableFeatures ...\nFinding variable features for layer counts\nNo variable features found for object3 in the object.list. Running FindVariableFeatures ...\nFinding variable features for layer counts\nNo variable features found for object4 in the object.list. Running FindVariableFeatures ...\nFinding variable features for layer counts\n\ndata.liger@varFeatures &lt;- var.genes\nprint(length(varFeatures(data.liger)))\n\n[1] 2000\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nScale the gene expression across the datasets.\nWhy does LIGER not center the data?\nHint: think about the use of non-negative matrix factorization and the constraints that this imposes.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ndata.liger &lt;- scaleNotCenter(data.liger)\n\n\n\n\n\n\n\nNext, we will run the integrative non-negative matrix factorization.\n\n\n\n\n\n\nQuestion\n\n\n\nUse the runIntegration function to perform the integrative non-negative matrix factorization.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ndata.liger &lt;- runIntegration(data.liger, k = 30)\n\n\n\n\n\nWhat do matrices H, V, and W represent, and what are their dimensions?\n\n\n\nR\n\ndim(getMatrix(data.liger, \"H\")$celseq)\ndim(getMatrix(data.liger, \"V\")$celseq)\ndim(getMatrix(data.liger, \"W\"))\n\n\n\n\nNext, do normalization and clustering of cells in shared nearest factor space.\n\n\n\n\n\n\nQuestion\n\n\n\nDo quantile normalization, cluster quantile normalized data\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ndata.liger &lt;- quantileNorm(data.liger, resolution = 1)\ndata.liger &lt;- runCluster(data.liger)\n\n\n\n\n\nWhat are the dimensions of H.norm. What does this represent?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ndim(getMatrix(data.liger, \"H.norm\"))\n\n\n\n\n\n\n\nLet’s see what the liger data looks like mapped onto a UMAP visualization.\n\n\n\n\n\n\nQuestion\n\n\n\nRun UMAP on the quantile normalized data and visualize the clusters.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ndata.liger &lt;- runUMAP(data.liger, n_neighbors = 15, min_dist = 0.5)\np &lt;- plotByDatasetAndCluster(data.liger) \np\n\nclusterUmapList &lt;- plotClusterDimRed(data.liger, splitBy = \"dataset\", title = names(data.liger))\nplot_grid(plotlist = c(clusterUmapList), align = \"hv\")\n\n\n\n\n\n\n\nFinally, let’s look at the adjusted rand index between the clusters and technology, and also the genes that load the factors used in data integration.\n\n# Let's look to see how the adjusted rand index changed compared to using no batch correction.\ntech &lt;- cellMeta(data.liger)$dataset\nclusters &lt;- cellMeta(data.liger)$leiden_cluster\nari &lt;- data.frame(\"tech\" = tech, \"clusters\" = clusters)\nari$tech &lt;- plyr::mapvalues(ari$tech, from = c(\"celseq\", \"celseq2\", \"fluidigmc1\", \"smartseq2\"), to = c(0, 1, 2, 3))\nadj.rand.index(as.numeric(ari$tech), as.numeric(ari$clusters))\n\n# Identify shared and batch-specific marker genes from liger factorization.\n# Use the getFactorMarkers function and choose 2 datasets.\n# Then plot some genes of interest using plotGene functions.\nmarkers &lt;- getFactorMarkers(data.liger, dataset1 = \"celseq2\", dataset2 = \"smartseq2\")\nplotGeneDimRed(data.liger, features = \"INS\")\n\n# Look at factor loadings in factor 9, celseq2 vs smartseq2.\nplotGeneLoadings(data.liger, markerTable = markers, useFactor = 9)",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Lab 6: Batch correction</span>"
    ]
  },
  {
    "objectID": "content/day3/Lab6_batch_correction.html#additional-exploration",
    "href": "content/day3/Lab6_batch_correction.html#additional-exploration",
    "title": "\n11  Lab 6: Batch correction\n",
    "section": "\n11.6 Additional exploration",
    "text": "11.6 Additional exploration\n\n11.6.1 Regressing out unwanted covariates\nLearn how to regress out different technical covariates (number of UMIs, number of genes, percent mitochondrial reads) by studying Seurat’s PBMC tutorial and the ScaleData() function.\n\n11.6.2 kBET\nWithin your RStudio session, install k-nearest neighbour batch effect test and learn how to use its functionality to quantify batch effects in the pancreatic data.",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Lab 6: Batch correction</span>"
    ]
  },
  {
    "objectID": "content/day3/Lab6_batch_correction.html#acknowledgements",
    "href": "content/day3/Lab6_batch_correction.html#acknowledgements",
    "title": "\n11  Lab 6: Batch correction\n",
    "section": "\n11.7 Acknowledgements",
    "text": "11.7 Acknowledgements\nThis document builds off a tutorial from the Seurat website and a tutorial from the LIGER website.",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Lab 6: Batch correction</span>"
    ]
  },
  {
    "objectID": "content/day3/Lab6_batch_correction.html#session-info",
    "href": "content/day3/Lab6_batch_correction.html#session-info",
    "title": "\n11  Lab 6: Batch correction\n",
    "section": "\n11.8 Session info",
    "text": "11.8 Session info\n\n\n─ Session info ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.5.1 (2025-06-13)\n os       Ubuntu 24.04.2 LTS\n system   x86_64, linux-gnu\n ui       X11\n language (EN)\n collate  en_IN.utf8\n ctype    en_IN.utf8\n tz       Europe/Paris\n date     2025-11-14\n pandoc   3.1.3 @ /usr/bin/ (via rmarkdown)\n quarto   1.5.55 @ /opt/quarto/bin/quarto\n\n─ Packages ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n package          * version    date (UTC) lib source\n abind              1.4-8      2024-09-12 [1] CRAN (R 4.5.1)\n beeswarm           0.4.0      2021-06-01 [1] CRAN (R 4.5.1)\n Biobase            2.70.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocGenerics       0.56.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n cachem             1.1.0      2024-05-16 [1] CRAN (R 4.5.1)\n cli                3.6.5      2025-04-23 [1] CRAN (R 4.5.1)\n cluster            2.1.8.1    2025-03-12 [2] CRAN (R 4.5.1)\n codetools          0.2-20     2024-03-31 [2] CRAN (R 4.5.1)\n cowplot            1.2.0      2025-07-07 [1] CRAN (R 4.5.1)\n data.table         1.17.8     2025-07-10 [1] CRAN (R 4.5.1)\n DelayedArray       0.36.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n deldir             2.0-4      2024-02-28 [1] CRAN (R 4.5.1)\n devtools           2.4.6      2025-10-03 [1] CRAN (R 4.5.1)\n dichromat          2.0-0.1    2022-05-02 [1] CRAN (R 4.5.1)\n digest             0.6.38     2025-11-12 [1] CRAN (R 4.5.1)\n dotCall64          1.2        2024-10-04 [1] CRAN (R 4.5.1)\n dplyr              1.1.4      2023-11-17 [1] CRAN (R 4.5.1)\n ellipsis           0.3.2      2021-04-29 [1] CRAN (R 4.5.1)\n evaluate           1.0.5      2025-08-27 [1] CRAN (R 4.5.1)\n farver             2.1.2      2024-05-13 [1] CRAN (R 4.5.1)\n fastDummies        1.7.5      2025-01-20 [1] CRAN (R 4.5.0)\n fastmap            1.2.0      2024-05-15 [1] CRAN (R 4.5.1)\n fitdistrplus       1.2-4      2025-07-03 [1] CRAN (R 4.5.1)\n FNN                1.1.4.1    2024-09-22 [1] CRAN (R 4.5.1)\n foreign          * 0.8-90     2025-03-31 [2] CRAN (R 4.5.1)\n fossil           * 0.4.0      2020-03-23 [1] CRAN (R 4.5.1)\n fs                 1.6.6      2025-04-12 [1] CRAN (R 4.5.1)\n future           * 1.67.0     2025-07-29 [1] CRAN (R 4.5.1)\n future.apply       1.20.0     2025-06-06 [1] CRAN (R 4.5.1)\n generics           0.1.4      2025-05-09 [1] CRAN (R 4.5.1)\n ggbeeswarm         0.7.2      2023-04-29 [1] CRAN (R 4.5.1)\n ggplot2            4.0.1      2025-11-14 [1] CRAN (R 4.5.1)\n ggrastr            1.0.2      2023-06-01 [1] CRAN (R 4.5.1)\n ggrepel            0.9.6      2024-09-07 [1] CRAN (R 4.5.1)\n ggridges           0.5.7      2025-08-27 [1] CRAN (R 4.5.1)\n globals            0.18.0     2025-05-08 [1] CRAN (R 4.5.1)\n glue               1.8.0      2024-09-30 [1] CRAN (R 4.5.1)\n goftest            1.2-3      2021-10-07 [1] CRAN (R 4.5.1)\n gridExtra          2.3        2017-09-09 [1] CRAN (R 4.5.1)\n gtable             0.3.6      2024-10-25 [1] CRAN (R 4.5.1)\n h5mread            1.2.0      2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n HDF5Array          1.38.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n htmltools          0.5.8.1    2024-04-04 [1] CRAN (R 4.5.1)\n htmlwidgets        1.6.4      2023-12-06 [1] CRAN (R 4.5.1)\n httpuv             1.6.16     2025-04-16 [1] CRAN (R 4.5.1)\n httr               1.4.7      2023-08-15 [1] CRAN (R 4.5.1)\n ica                1.0-3      2022-07-08 [1] CRAN (R 4.5.1)\n igraph             2.2.1      2025-10-27 [1] CRAN (R 4.5.1)\n IRanges            2.44.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n irlba              2.3.5.1    2022-10-03 [1] CRAN (R 4.5.1)\n jsonlite           2.0.0      2025-03-27 [1] CRAN (R 4.5.1)\n KernSmooth         2.23-26    2025-01-01 [2] CRAN (R 4.5.1)\n knitr              1.50       2025-03-16 [1] CRAN (R 4.5.1)\n labeling           0.4.3      2023-08-29 [1] CRAN (R 4.5.1)\n later              1.4.4      2025-08-27 [1] CRAN (R 4.5.1)\n lattice            0.22-7     2025-04-02 [2] CRAN (R 4.5.1)\n lazyeval           0.2.2      2019-03-15 [1] CRAN (R 4.5.1)\n lifecycle          1.0.4      2023-11-07 [1] CRAN (R 4.5.1)\n limma              3.66.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n listenv            0.10.0     2025-11-02 [1] CRAN (R 4.5.1)\n lmtest             0.9-40     2022-03-21 [1] CRAN (R 4.5.1)\n magrittr           2.0.4      2025-09-12 [1] CRAN (R 4.5.1)\n maps             * 3.4.3      2025-05-26 [1] CRAN (R 4.5.1)\n MASS               7.3-65     2025-02-28 [2] CRAN (R 4.5.1)\n mathjaxr           1.8-0      2025-04-30 [1] CRAN (R 4.5.1)\n Matrix           * 1.7-3      2025-03-11 [1] CRAN (R 4.5.1)\n MatrixGenerics     1.22.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n matrixStats        1.5.0      2025-01-07 [1] CRAN (R 4.5.0)\n memoise            2.0.1      2021-11-26 [1] CRAN (R 4.5.1)\n metap              1.12       2025-03-15 [1] CRAN (R 4.5.1)\n mime               0.13       2025-03-17 [1] CRAN (R 4.5.1)\n miniUI             0.1.2      2025-04-17 [1] CRAN (R 4.5.1)\n mnormt             2.1.1      2022-09-26 [1] CRAN (R 4.5.1)\n multcomp           1.4-29     2025-10-20 [1] CRAN (R 4.5.1)\n multtest           2.66.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n mutoss             0.1-13     2023-03-14 [1] CRAN (R 4.5.1)\n mvtnorm            1.3-3      2025-01-10 [1] CRAN (R 4.5.1)\n nlme               3.1-168    2025-03-31 [2] CRAN (R 4.5.1)\n numDeriv           2016.8-1.1 2019-06-06 [1] CRAN (R 4.5.1)\n otel               0.2.0      2025-08-29 [1] CRAN (R 4.5.1)\n parallelly         1.45.1     2025-07-24 [1] CRAN (R 4.5.1)\n patchwork          1.3.2      2025-08-25 [1] CRAN (R 4.5.1)\n pbapply            1.7-4      2025-07-20 [1] CRAN (R 4.5.1)\n pillar             1.11.1     2025-09-17 [1] CRAN (R 4.5.1)\n pkgbuild           1.4.8      2025-05-26 [1] CRAN (R 4.5.1)\n pkgconfig          2.0.3      2019-09-22 [1] CRAN (R 4.5.1)\n pkgload            1.4.1      2025-09-23 [1] CRAN (R 4.5.1)\n plotly             4.11.0     2025-06-19 [1] CRAN (R 4.5.1)\n plotrix            3.8-4      2023-11-10 [1] CRAN (R 4.5.1)\n plyr               1.8.9      2023-10-02 [1] CRAN (R 4.5.1)\n png                0.1-8      2022-11-29 [1] CRAN (R 4.5.1)\n polyclip           1.10-7     2024-07-23 [1] CRAN (R 4.5.1)\n progressr          0.18.0     2025-11-06 [1] CRAN (R 4.5.1)\n promises           1.5.0      2025-11-01 [1] CRAN (R 4.5.1)\n purrr              1.2.0      2025-11-04 [1] CRAN (R 4.5.1)\n qqconf             1.3.2      2023-04-14 [1] CRAN (R 4.5.1)\n R6                 2.6.1      2025-02-15 [1] CRAN (R 4.5.0)\n RANN               2.6.2      2024-08-25 [1] CRAN (R 4.5.1)\n rbibutils          2.4        2025-11-07 [1] CRAN (R 4.5.1)\n RColorBrewer       1.1-3      2022-04-03 [1] CRAN (R 4.5.1)\n Rcpp               1.1.0      2025-07-02 [1] CRAN (R 4.5.1)\n RcppAnnoy          0.0.22     2024-01-23 [1] CRAN (R 4.5.1)\n RcppHNSW           0.6.0      2024-02-04 [1] CRAN (R 4.5.1)\n Rdpack             2.6.4      2025-04-09 [1] CRAN (R 4.5.1)\n remotes            2.5.0      2024-03-17 [1] CRAN (R 4.5.1)\n reshape2           1.4.5      2025-11-12 [1] CRAN (R 4.5.1)\n reticulate         1.44.0     2025-10-25 [1] CRAN (R 4.5.1)\n rhdf5              2.54.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n rhdf5filters       1.22.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n Rhdf5lib           1.32.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n rlang              1.1.6      2025-04-11 [1] CRAN (R 4.5.1)\n rliger           * 2.2.1      2025-08-26 [1] CRAN (R 4.5.1)\n rmarkdown          2.30       2025-09-28 [1] CRAN (R 4.5.1)\n ROCR               1.0-11     2020-05-02 [1] CRAN (R 4.5.1)\n RSpectra           0.16-2     2024-07-18 [1] CRAN (R 4.5.1)\n Rtsne              0.17       2023-12-07 [1] CRAN (R 4.5.1)\n S4Arrays           1.10.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n S4Vectors          0.48.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n S7                 0.2.0      2024-11-07 [1] CRAN (R 4.5.1)\n sandwich           3.1-1      2024-09-15 [1] CRAN (R 4.5.1)\n scales             1.4.0      2025-04-24 [1] CRAN (R 4.5.1)\n scattermore        1.2        2023-06-12 [1] CRAN (R 4.5.1)\n sctransform        0.4.2      2025-04-30 [1] CRAN (R 4.5.1)\n sessioninfo        1.2.3      2025-02-05 [1] CRAN (R 4.5.0)\n Seurat           * 5.3.1      2025-10-29 [1] CRAN (R 4.5.1)\n SeuratObject     * 5.2.0      2025-08-27 [1] CRAN (R 4.5.1)\n shapefiles       * 0.7.2      2022-08-25 [1] CRAN (R 4.5.1)\n shiny              1.11.1     2025-07-03 [1] CRAN (R 4.5.1)\n sn                 2.1.1      2023-04-04 [1] CRAN (R 4.5.1)\n sp               * 2.2-0      2025-02-01 [1] CRAN (R 4.5.0)\n spam               2.11-1     2025-01-20 [1] CRAN (R 4.5.0)\n SparseArray        1.10.1     2025-10-31 [1] Bioconductor 3.22 (R 4.5.1)\n spatstat.data      3.1-9      2025-10-18 [1] CRAN (R 4.5.1)\n spatstat.explore   3.5-3      2025-09-22 [1] CRAN (R 4.5.1)\n spatstat.geom      3.6-0      2025-09-20 [1] CRAN (R 4.5.1)\n spatstat.random    3.4-2      2025-09-21 [1] CRAN (R 4.5.1)\n spatstat.sparse    3.1-0      2024-06-21 [1] CRAN (R 4.5.1)\n spatstat.univar    3.1-4      2025-07-13 [1] CRAN (R 4.5.1)\n spatstat.utils     3.2-0      2025-09-20 [1] CRAN (R 4.5.1)\n statmod            1.5.1      2025-10-09 [1] CRAN (R 4.5.1)\n stringi            1.8.7      2025-03-27 [1] CRAN (R 4.5.1)\n stringr            1.6.0      2025-11-04 [1] CRAN (R 4.5.1)\n survival           3.8-3      2024-12-17 [2] CRAN (R 4.5.1)\n tensor             1.5.1      2025-06-17 [1] CRAN (R 4.5.1)\n TFisher            0.2.0      2018-03-21 [1] CRAN (R 4.5.1)\n TH.data            1.1-4      2025-09-02 [1] CRAN (R 4.5.1)\n tibble             3.3.0      2025-06-08 [1] CRAN (R 4.5.1)\n tidyr              1.3.1      2024-01-24 [1] CRAN (R 4.5.1)\n tidyselect         1.2.1      2024-03-11 [1] CRAN (R 4.5.1)\n usethis            3.2.1      2025-09-06 [1] CRAN (R 4.5.1)\n uwot               0.2.4      2025-11-10 [1] CRAN (R 4.5.1)\n vctrs              0.6.5      2023-12-01 [1] CRAN (R 4.5.1)\n vipor              0.4.7      2023-12-18 [1] CRAN (R 4.5.1)\n viridisLite        0.4.2      2023-05-02 [1] CRAN (R 4.5.1)\n withr              3.0.2      2024-10-28 [1] CRAN (R 4.5.1)\n xfun               0.54       2025-10-30 [1] CRAN (R 4.5.1)\n xtable             1.8-4      2019-04-21 [1] CRAN (R 4.5.1)\n XVector            0.50.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n zoo                1.8-14     2025-04-10 [1] CRAN (R 4.5.1)\n\n [1] /home/rsg/R/x86_64-pc-linux-gnu-library/4.5\n [2] /opt/R/4.5.1/lib/R/library\n * ── Packages attached to the search path.\n\n──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────",
    "crumbs": [
      "Day 3",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Lab 6: Batch correction</span>"
    ]
  },
  {
    "objectID": "content/day4/Lecture6_ATAC.html",
    "href": "content/day4/Lecture6_ATAC.html",
    "title": "12  Lecture 6 - Advances in single-cell genomics: the epigenome",
    "section": "",
    "text": "Slides here",
    "crumbs": [
      "Day 4",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>Lecture 6 - Advances in single-cell genomics: the epigenome</span>"
    ]
  },
  {
    "objectID": "content/day4/Lab7_atac-seq.html",
    "href": "content/day4/Lab7_atac-seq.html",
    "title": "\n13  Lab 7: Single-cell ATAC-seq analysis workflow\n",
    "section": "",
    "text": "13.1 Process human PBMC dataset",
    "crumbs": [
      "Day 4",
      "<span class='chapter-number'>13</span>  <span class='chapter-title'>Lab 7: Single-cell ATAC-seq analysis workflow</span>"
    ]
  },
  {
    "objectID": "content/day4/Lab7_atac-seq.html#process-human-pbmc-dataset",
    "href": "content/day4/Lab7_atac-seq.html#process-human-pbmc-dataset",
    "title": "\n13  Lab 7: Single-cell ATAC-seq analysis workflow\n",
    "section": "",
    "text": "13.1.1 Import data\nPre-downloaded data files are available in the ~/Share/scATAC/ folder. Notice how the count matrix is in a .h5 format. We have already encountered this format in Lab3. Back then, we imported it with DropletUtils::read10xCounts.\n\n\n\n\n\n\nQuestion\n\n\n\nDoes this function work here?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nscatac &lt;- DropletUtils::read10xCounts(\"~/Share/scATAC/atac_v1_pbmc_10k_filtered_peak_bc_matrix.h5\")\nscatac\n\n\nclass: SingleCellExperiment \ndim: 89796 8728 \nmetadata(1): Samples\nassays(1): counts\nrownames(89796): chr1:565107-565550 chr1:569174-569639 ... chrY:59001782-59002175 chrY:59017143-59017246\nrowData names(3): ID Symbol Type\ncolnames: NULL\ncolData names(2): Sample Barcode\nreducedDimNames(0):\nmainExpName: NULL\naltExpNames(0):\n\n\n\n\n\n\n\nThis works because 10X Genomics make sure to distribute files in .h5 format that are consistent accross single-cell sequencing methodologies.\nHowever, the SingleCellExperiment obtained with this approach is not the most convenient, as it cannot natively leverage fragments file (see below).\nInstead, we can create a Signac object, a flavour of Seurat objects.\n\n\n\n\n\n\nQuestion\n\n\n\nImport counts matrix and feature annotations using an import function provided by Seurat.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nlibrary(Seurat)\n\n\nLoading required package: SeuratObject\n\n\nLoading required package: sp\n\n\n\nAttaching package: 'SeuratObject'\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, t\n\nlibrary(Signac)\nlibrary(rtracklayer)\n\nLoading required package: GenomicRanges\n\n\nLoading required package: stats4\n\n\nLoading required package: BiocGenerics\n\n\nLoading required package: generics\n\n\n\nAttaching package: 'generics'\n\n\nThe following objects are masked from 'package:base':\n\n    as.difftime, as.factor, as.ordered, intersect, is.element, setdiff, setequal, union\n\n\n\nAttaching package: 'BiocGenerics'\n\n\nThe following objects are masked from 'package:stats':\n\n    IQR, mad, sd, var, xtabs\n\n\nThe following objects are masked from 'package:base':\n\n    anyDuplicated, aperm, append, as.data.frame, basename, cbind, colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep, grepl, is.unsorted, lapply, Map, mapply, match, mget, order, paste,\n    pmax, pmax.int, pmin, pmin.int, Position, rank, rbind, Reduce, rownames, sapply, saveRDS, table, tapply, unique, unsplit, which.max, which.min\n\n\nLoading required package: S4Vectors\n\n\n\nAttaching package: 'S4Vectors'\n\n\nThe following object is masked from 'package:utils':\n\n    findMatches\n\n\nThe following objects are masked from 'package:base':\n\n    expand.grid, I, unname\n\n\nLoading required package: IRanges\n\n\n\nAttaching package: 'IRanges'\n\n\nThe following object is masked from 'package:sp':\n\n    %over%\n\n\nLoading required package: Seqinfo\n\nlibrary(stringr)\ncnts &lt;- Read10X_h5('~/Share/scATAC/atac_v1_pbmc_10k_filtered_peak_bc_matrix.h5')\nfeatures &lt;- import('~/Share/scATAC/atac_v1_pbmc_10k_peaks.bed')\nfeatures$peak &lt;- as.character(features) |&gt; str_replace(':', '-')\nmetadata &lt;- read.csv(\n  file = \"~/Share/scATAC/atac_v1_pbmc_10k_singlecell.csv\",\n  header = TRUE,\n  row.names = 1\n)\n\n\n\n\nHow many accessible genomic segments were found in this dataset?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nfeatures\n\n\nGRanges object with 89796 ranges and 1 metadata column:\n          seqnames            ranges strand |                   peak\n             &lt;Rle&gt;         &lt;IRanges&gt;  &lt;Rle&gt; |            &lt;character&gt;\n      [1]     chr1     565108-565550      * |     chr1-565108-565550\n      [2]     chr1     569175-569639      * |     chr1-569175-569639\n      [3]     chr1     713461-714823      * |     chr1-713461-714823\n      [4]     chr1     752423-753038      * |     chr1-752423-753038\n      [5]     chr1     762107-763359      * |     chr1-762107-763359\n      ...      ...               ...    ... .                    ...\n  [89792]     chrY 58993393-58993760      * | chrY-58993393-58993760\n  [89793]     chrY 58994572-58994823      * | chrY-58994572-58994823\n  [89794]     chrY 58996353-58997331      * | chrY-58996353-58997331\n  [89795]     chrY 59001783-59002175      * | chrY-59001783-59002175\n  [89796]     chrY 59017144-59017246      * | chrY-59017144-59017246\n  -------\n  seqinfo: 24 sequences from an unspecified genome; no seqlengths\n\nlength(features)\n\n[1] 89796\n\n\n\n\n\n\n\n\n13.1.2 Create a Seurat object\nThe next step is to aggregate counts and features into a ChromatinAssay, a scATAC-seq flavour of Seurat standard Assays. The documentation for ?CreateChromatinAssay indicates that the user can provide:\n\nA fragments file, corresponding to the full list of all unique fragments mapped across all single cells.\nGenomic annotations to the ChromatinAssay, corresponding to gene annotations, promoter positions, etc. Such annotations can be generated from Ensembl.\n\n\n\n\n\n\n\nQuestion\n\n\n\nGenerate human annotations from Ensembl using a parsing function from Seurat.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\n## - Get human gene annotations (hg19/GRCh37) to feed it into the future `ChromatinAssay`\nBiocManager::install('EnsDb.Hsapiens.v75')\n\n\n'getOption(\"repos\")' replaces Bioconductor standard repositories, see 'help(\"repositories\", package = \"BiocManager\")' for details.\nReplacement repositories:\n    CRAN: https://cloud.r-project.org\n\n\nBioconductor version 3.22 (BiocManager 1.30.27), R 4.5.1 (2025-06-13)\n\n\nWarning: package(s) not installed when version(s) same as or greater than current; use `force = TRUE` to re-install: 'EnsDb.Hsapiens.v75'\n\n\nInstallation paths not writeable, unable to update packages\n  path: /opt/R/4.5.1/lib/R/library\n  packages:\n    boot, mgcv\n\n\nOld packages: 'affy', 'affyio', 'alphashape3d', 'AnnotationForge', 'AnnotationHubData', 'apeglm', 'aplot', 'arrow', 'aws.s3', 'AzureStor', 'basilisk.utils', 'BiocBook', 'BiocCheck', 'BiocPkgTools', 'biocthis', 'biocViews', 'biomformat',\n  'broom.helpers', 'BrowserViz', 'bs4Dash', 'bumphunter', 'BumpyMatrix', 'cards', 'CGHbase', 'CGHcall', 'ChIPpeakAnno', 'ChIPseeker', 'clusterProfiler', 'collections', 'ComplexHeatmap', 'corrr', 'covr', 'crisprBase', 'crisprBowtie',\n  'crisprScore', 'crisprScoreData', 'csaw', 'curatedMetagenomicData', 'curatedTCGAData', 'data.tree', 'dbscan', 'dearseq', 'DECIPHER', 'decontam', 'decoupleR', 'densvis', 'derfinder', 'derfinderHelper', 'DESeq2', 'DFplyr', 'dials',\n  'diffHic', 'DNAcopy', 'DNAZooData', 'DOSE', 'DropletTestFiles', 'easylift', 'EBImage', 'ellmer', 'emmeans', 'EnrichedHeatmap', 'enrichplot', 'eulerr', 'excluderanges', 'ExperimentHubData', 'fgsea', 'fission', 'fourDNData', 'fresh',\n  'genefilter', 'GenomeInfoDbData', 'GenomicFiles', 'GenomicInteractions', 'GEOquery', 'GGally', 'ggbio', 'ggExtra', 'ggimage', 'ggplotify', 'ggpubr', 'ggsci', 'ggstar', 'ggstats', 'ggtangle', 'ggtree', 'ggtreeExtra', 'gld', 'glmmTMB',\n  'GO.db', 'GOSemSim', 'GOTHiC', 'gprofiler2', 'gsl', 'GSVA', 'gtrellis', 'GUniFrac', 'Gviz', 'hardhat', 'HCAData', 'HiCcompare', 'HiCDataLymphoblast', 'HiCDOC', 'HiCExperiment', 'HiContacts', 'HiContactsData', 'igvR', 'impute',\n  'InteractionSet', 'interactiveDisplayBase', 'labelled', 'latticeExtra', 'lava', 'leaflet', 'lemon', 'LimROTS', 'litedown', 'lobstr', 'macrophage', 'magick', 'mariner', 'marray', 'MAST', 'Matrix', 'mclust', 'megadepth', 'memes',\n  'MetaboCoreUtils', 'metagene2', 'mia', 'miaViz', 'microbiomeDataSets', 'MicrobiotaProcess', 'mixOmics', 'MOFA2', 'monaLisa', 'MotifDb', 'motifmatchr', 'msa', 'MsBackendMetaboLights', 'msdata', 'msmsEDA', 'msmsTests', 'MSnbase', 'MSnID',\n  'MultiAssayExperiment', 'multiHiCcompare', 'muscat', 'mzID', 'mzR', 'NOISeq', 'nucleR', 'nullranges', 'oct4', 'ontoProc', 'ORFik', 'org.Hs.eg.db', 'org.Mm.eg.db', 'org.Sc.sgd.db', 'OrganismDbi', 'Orthology.eg.db', 'parsnip',\n  'pcaMethods', 'pdftools', 'periodicDNA', 'philentropy', 'philr', 'phyloseq', 'PKI', 'plotgardener', 'plyinteractions', 'plyranges', 'pracma', 'preprocessCore', 'PSMatch', 'QDNAseq', 'QFeatures', 'quarto', 'qvalue', 'RaggedExperiment',\n  'RBGL', 'Rbowtie', 'RcppParallel', 'rcrossref', 'REDseq', 'reformulas', 'regioneR', 'remaCor', 'Rfast', 'Rgraphviz', 'Rmpfr', 'ROC', 'rpx', 'rsconnect', 'rspm', 'rstatix', 'Rsubread', 'scatterpie', 'scmap', 'sechm', 'seriation',\n  'shadowtext', 'shinydashboardPlus', 'ShortRead', 'singscore', 'snowflakeauth', 'SpatialExperiment', 'Spectra', 'spelling', 'SRAdb', 'styler', 'subSeq', 'survey', 'svglite', 'svUnit', 'TCC', 'terra', 'tidybulk', 'tidyCoverage',\n  'tidySingleCellExperiment', 'tidySummarizedExperiment', 'timeDate', 'TMB', 'treeio', 'TreeSummarizedExperiment', 'tune', 'TxDb.Hsapiens.UCSC.hg19.knownGene', 'txdbmaker', 'tximeta', 'tximport', 'units', 'universalmotif',\n  'variancePartition', 'vegan', 'VplotR', 'vsn', 'waiter', 'workflows', 'Wrench', 'yulab.utils', 'zinbwave'\n\nannotations &lt;- GetGRangesFromEnsDb(ensdb = EnsDb.Hsapiens.v75::EnsDb.Hsapiens.v75)\n\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\n\n\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\nWarning in .merge_two_Seqinfo_objects(x, y): The 2 combined objects have no sequence levels in common. (Use\n  suppressWarnings() to suppress this warning.)\n\nGenomeInfoDb::seqlevelsStyle(annotations) &lt;- 'UCSC'\n\n\n\n\nCreate a ChromatinAssay using counts, features, fragments and annotations.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\n## - Create Chromatin Assay\nassay &lt;- Signac::CreateChromatinAssay(\n    counts = cnts,\n    ranges = features,\n    fragments = \"~/Share/scATAC/atac_v1_pbmc_10k_fragments.tsv.gz\",\n    annotation = annotations,\n    genome = \"hg19\",\n    min.cells = 10, \n    min.features = 10\n)\n\n\nComputing hash\n\nassay\n\nChromatinAssay data with 87561 features for 8728 cells\nVariable features: 0 \nGenome: hg19 \nAnnotation present: TRUE \nMotifs present: FALSE \nFragment files: 1 \n\n\n\n\n\nWhat are the dimensions of this object? Are they comparable to the count matrix? Comment.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ndim(cnts)\n\n\n[1] 89796  8728\n\ndim(assay)\n\n[1] 87561  8728\n\n\n\n\n\n\n\nIt’s finally time to wrap the ChromatinAssay into a Seurat standard object! This is done using the CreateSeuratObject, as already covered in Lab6\n\n\n\n\n\n\nQuestion\n\n\n\nCreate a Seurat object from the ChromatinAssay object.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\n## - Create Seurat object\nPBMC &lt;- Seurat::CreateSeuratObject(\n    counts = assay,\n    assay = 'ATAC', \n    meta.data = metadata[metadata$is__cell_barcode == 1, ]\n)\nPBMC\n\n\nAn object of class Seurat \n87561 features across 8728 samples within 1 assay \nActive assay: ATAC (87561 features, 0 variable features)\n 2 layers present: counts, data\n\nPBMC[['ATAC']]\n\nChromatinAssay data with 87561 features for 8728 cells\nVariable features: 0 \nGenome: hg19 \nAnnotation present: TRUE \nMotifs present: FALSE \nFragment files: 1 \n\ngranges(PBMC)\n\nGRanges object with 87561 ranges and 1 metadata column:\n          seqnames            ranges strand |                   peak\n             &lt;Rle&gt;         &lt;IRanges&gt;  &lt;Rle&gt; |            &lt;character&gt;\n      [1]     chr1     565108-565550      * |     chr1-565108-565550\n      [2]     chr1     569175-569639      * |     chr1-569175-569639\n      [3]     chr1     713461-714823      * |     chr1-713461-714823\n      [4]     chr1     752423-753038      * |     chr1-752423-753038\n      [5]     chr1     762107-763359      * |     chr1-762107-763359\n      ...      ...               ...    ... .                    ...\n  [87557]     chrY 58993393-58993760      * | chrY-58993393-58993760\n  [87558]     chrY 58994572-58994823      * | chrY-58994572-58994823\n  [87559]     chrY 58996353-58997331      * | chrY-58996353-58997331\n  [87560]     chrY 59001783-59002175      * | chrY-59001783-59002175\n  [87561]     chrY 59017144-59017246      * | chrY-59017144-59017246\n  -------\n  seqinfo: 24 sequences from an unspecified genome; no seqlengths\n\nAnnotation(PBMC)\n\nGRanges object with 3072120 ranges and 5 metadata columns:\n                  seqnames        ranges strand |           tx_id   gene_name         gene_id   gene_biotype     type\n                     &lt;Rle&gt;     &lt;IRanges&gt;  &lt;Rle&gt; |     &lt;character&gt; &lt;character&gt;     &lt;character&gt;    &lt;character&gt; &lt;factor&gt;\n  ENSE00001489430     chrX 192989-193061      + | ENST00000399012      PLCXD1 ENSG00000182378 protein_coding     exon\n  ENSE00001536003     chrX 192991-193061      + | ENST00000484611      PLCXD1 ENSG00000182378 protein_coding     exon\n  ENSE00002160563     chrX 193020-193061      + | ENST00000430923      PLCXD1 ENSG00000182378 protein_coding     exon\n  ENSE00001750899     chrX 197722-197788      + | ENST00000445062      PLCXD1 ENSG00000182378 protein_coding     exon\n  ENSE00001489388     chrX 197859-198351      + | ENST00000381657      PLCXD1 ENSG00000182378 protein_coding     exon\n              ...      ...           ...    ... .             ...         ...             ...            ...      ...\n  ENST00000361739    chrMT     7586-8269      + | ENST00000361739      MT-CO2 ENSG00000198712 protein_coding      cds\n  ENST00000361789    chrMT   14747-15887      + | ENST00000361789      MT-CYB ENSG00000198727 protein_coding      cds\n  ENST00000361851    chrMT     8366-8572      + | ENST00000361851     MT-ATP8 ENSG00000228253 protein_coding      cds\n  ENST00000361899    chrMT     8527-9207      + | ENST00000361899     MT-ATP6 ENSG00000198899 protein_coding      cds\n  ENST00000362079    chrMT     9207-9990      + | ENST00000362079      MT-CO3 ENSG00000198938 protein_coding      cds\n  -------\n  seqinfo: 25 sequences (1 circular) from hg19 genome\n\n\n\n\n\n\n\n\n13.1.3 Check QCs\n\n13.1.3.1 Cell-based QCs\nThe fraction of reads in peaks (FRiP) is a good indicator of how well each cell was handled during scATACseq processing.\n\n\n\nR\n\nPBMC$FRiP &lt;- PBMC$peak_region_fragments / PBMC$passed_filters\nPBMC$nCount_ATAC &lt;- colSums(GetAssayData(PBMC, layer = \"counts\"))\nPBMC$nFeature_ATAC &lt;- colSums(GetAssayData(PBMC, layer = \"counts\") &gt; 0)\n\nquantile(PBMC$FRiP, seq(0, 1, 0.1))\n\n\n        0%        10%        20%        30%        40%        50%        60%        70%        80%        90%       100% \n0.02770289 0.55266699 0.60895480 0.64086129 0.66583010 0.68520756 0.70194678 0.71993709 0.73801044 0.76004660 0.90383142 \n\nquantile(PBMC$nCount_ATAC, seq(0, 1, 0.1))\n\n      0%      10%      20%      30%      40%      50%      60%      70%      80%      90%     100% \n  1710.0   5079.1   7619.8   9522.5  11300.8  13367.5  15754.6  19005.5  23502.6  31316.2 249799.0 \n\nquantile(PBMC$nFeature_ATAC, seq(0, 1, 0.1))\n\n     0%     10%     20%     30%     40%     50%     60%     70%     80%     90%    100% \n  654.0  2308.4  3349.4  4108.1  4765.0  5447.0  6234.2  7100.9  8241.6  9983.4 30313.0 \n\n\n\n13.1.3.2 Peaks-based QCs\n\n\n\n\n\n\nQuestion\n\n\n\nWhich analysis are the fragments required for, exactly?\nCould we still perform normalization/clustering/annotation without them? And motif enrichment analysis?\nSince we do have the fragments file at hand, most of the QC steps are available (e.g. TSSEnrichment, NucleosomeSignal or fragment size distribution). Let’s go through them one by one.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\n# compute nucleosome signal score per cell\nPBMC &lt;- NucleosomeSignal(object = PBMC)\nPBMC\n\n\nAn object of class Seurat \n87561 features across 8728 samples within 1 assay \nActive assay: ATAC (87561 features, 0 variable features)\n 2 layers present: counts, data\n\n# compute TSS enrichment score per cell\nPBMC &lt;- Signac::TSSEnrichment(object = PBMC, fast = FALSE)\n\nExtracting TSS positions\n\n\nFinding + strand cut sites\n\n\nFinding - strand cut sites\n\n\nComputing mean insertion frequency in flanking regions\n\n\nNormalizing TSS score\n\nPBMC\n\nAn object of class Seurat \n87561 features across 8728 samples within 1 assay \nActive assay: ATAC (87561 features, 0 variable features)\n 2 layers present: counts, data\n\n\n\n\n\n\n\nThe TSSPlot function from Signac can be used to plot the fragment count per peak ~ TSS enrichment.\n\n\n\nR\n\nPBMC$high.tss &lt;- ifelse(PBMC$TSS.enrichment &gt; 3.5, 'High', 'Low')\nTSSPlot(PBMC, group.by = 'high.tss') + NoLegend()\n\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\nℹ The deprecated feature was likely used in the Signac package.\n  Please report the issue at &lt;https://github.com/stuart-lab/signac/issues&gt;.\n\n\n\n\n\n\n\nPBMC$high.tss &lt;- ifelse(PBMC$TSS.enrichment &gt; 2.5, 'High', 'Low')\nTSSPlot(PBMC, group.by = 'high.tss') + NoLegend()\n\n\n\n\n\n\n\nThe FragmentHistogram function from Signac can be used to plot the fragment size distribution in peaks with different nucleosome signals.\n\n\n\n\n\n\nQuestion\n\n\n\nGroup genomic loci by their nucleosome signal (&gt; 4 or &lt; 4) and plot the fragment size distribution.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nPBMC$nucleosome_group &lt;- ifelse(PBMC$nucleosome_signal &gt; 4, 'NS &gt; 4', 'NS &lt; 4')\nFragmentHistogram(object = PBMC, group.by = 'nucleosome_group')\n\n\nWarning: Removed 92 rows containing non-finite outside the scale range (`stat_bin()`).\n\n\nWarning: Removed 4 rows containing missing values or values outside the scale range (`geom_bar()`).\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n13.1.4 Filter cells and features\nJust like standard scRNAseq data, scATACseq data needs to be filtered to remove low-quality cells and peaks.\n\n\n\n\n\n\nQuestion\n\n\n\nFilter the Seurat object (cells and features) as deemed appropriate.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\n## - Filter data \nPBMC &lt;- subset(PBMC, subset = nCount_ATAC &gt; 3000 & nCount_ATAC &lt; 100000) \nPBMC &lt;- subset(PBMC, subset = nFeature_ATAC &gt; 1000 & nFeature_ATAC &lt; 20000) \nPBMC &lt;- subset(PBMC, subset = FRiP &gt; 0.30) \nPBMC\n\n\nAn object of class Seurat \n87561 features across 8231 samples within 1 assay \nActive assay: ATAC (87561 features, 0 variable features)\n 2 layers present: counts, data\n\n## - Remove peaks with low coverage\nPBMC &lt;- PBMC[rowSums(GetAssayData(PBMC, layer = \"counts\")) &gt; 10, ]\nPBMC &lt;- PBMC[rowSums(GetAssayData(PBMC, layer = \"counts\") &gt; 0) &gt; 10, ]\nPBMC\n\nAn object of class Seurat \n87212 features across 8231 samples within 1 assay \nActive assay: ATAC (87212 features, 0 variable features)\n 2 layers present: counts, data\n\n\n\n\n\n\n\n\n13.1.5 Dimensionality reduction and clustering\nNow that the dataset is filtered, we can proceed to data normalization, dimensionality reduction and clustering. Compared to scRNAseq, scATACseq data is much sparser and has a higher dimensionality. This has important implications for the choice of normalization and dimensionality reduction methods. scATACseq data are generally normalized using a TF-IDF normalization, which is implemented in the RunTFIDF function in Signac, and dimensionality reduction is performed using LSI (Latent Semantic Indexing) implemented in the RunSVD function.\n\n\n\n\n\n\nQuestion\n\n\n\nNormalize then further reduce the dimensionality for visualization purposes.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\n## - Normalize data \nPBMC &lt;- RunTFIDF(PBMC) \n\n\nPerforming TF-IDF normalization\n\n## - Reduce dimensionality\nPBMC &lt;- FindTopFeatures(PBMC, min.cutoff = 'q50') \nPBMC &lt;- RunSVD(PBMC) \n\nRunning SVD\n\n\nScaling cell embeddings\n\n## - Embed in 2D UMAP\nPBMC &lt;- RunUMAP(object = PBMC, reduction = 'lsi', dims = 2:30)\n\nWarning: The default method for RunUMAP has changed from calling Python UMAP via reticulate to the R-native UWOT using the cosine metric\nTo use Python UMAP via reticulate, set umap.method to 'umap-learn' and metric to 'correlation'\nThis message will be shown once per session\n\n\n20:24:04 UMAP embedding parameters a = 0.9922 b = 1.112\n\n\n20:24:04 Read 8231 rows and found 29 numeric columns\n\n\n20:24:04 Using Annoy for neighbor search, n_neighbors = 30\n\n\n20:24:04 Building Annoy index with metric = cosine, n_trees = 50\n\n\n0%   10   20   30   40   50   60   70   80   90   100%\n\n\n[----|----|----|----|----|----|----|----|----|----|\n\n\n**************************************************|\n20:24:05 Writing NN index file to temp file /data/.cache/R//RtmpaFe87f/file16a08c51315069\n20:24:05 Searching Annoy index using 1 thread, search_k = 3000\n20:24:07 Annoy recall = 100%\n20:24:08 Commencing smooth kNN distance calibration using 1 thread with target n_neighbors = 30\n20:24:09 Initializing from normalized Laplacian + noise (using RSpectra)\n20:24:09 Commencing optimization for 500 epochs, with 316686 positive edges\n20:24:09 Using rng type: pcg\n20:24:16 Optimization finished\n\n## - Cluster cells\nPBMC &lt;- FindNeighbors(object = PBMC, reduction = 'lsi', dims = 2:30)\n\nComputing nearest neighbor graph\nComputing SNN\n\nPBMC &lt;- FindClusters(object = PBMC, verbose = FALSE, algorithm = 3)\n\n## - Visualize data \nDimPlot(PBMC, label = TRUE) + NoLegend()\n\n\n\n\n\n\n\n\n\n\nWhat can you observe in the UMAP projection of the dataset? Comment on the separation of some cell types into different spatially-resolved clusters.",
    "crumbs": [
      "Day 4",
      "<span class='chapter-number'>13</span>  <span class='chapter-title'>Lab 7: Single-cell ATAC-seq analysis workflow</span>"
    ]
  },
  {
    "objectID": "content/day4/Lab7_atac-seq.html#compute-gene-activity-scores",
    "href": "content/day4/Lab7_atac-seq.html#compute-gene-activity-scores",
    "title": "\n13  Lab 7: Single-cell ATAC-seq analysis workflow\n",
    "section": "\n13.2 Compute gene activity scores",
    "text": "13.2 Compute gene activity scores\nSignac’s GeneActivity() function require scATACseq fragment information. Since we have them, we can estimate a gene activity score for each gene in the annotations.\n\n\n\nR\n\ngene.activities &lt;- GeneActivity(PBMC)\n\n\nExtracting gene coordinates\n\n\nWarning in SingleFeatureMatrix(fragment = fragments[[x]], features = features, : 13 features are on seqnames not present in the fragment file. These will be removed.\n\n\nExtracting reads overlapping genomic regions\n\n\nWe can now save this new object as an Assay in the PBMC object and normalize it.\n\n\n\nR\n\nPBMC[['RNA']] &lt;- CreateAssayObject(counts = gene.activities)\n\n\nWarning: Non-unique features (rownames) present in the input matrix, making unique\n\n# - Normalize the new RNA assay.\nPBMC &lt;- NormalizeData(object = PBMC, assay = 'RNA', normalization.method = 'LogNormalize', scale.factor = median(PBMC$nCount_RNA))\nPBMC\n\nAn object of class Seurat \n107222 features across 8231 samples within 2 assays \nActive assay: ATAC (87212 features, 43610 variable features)\n 2 layers present: counts, data\n 1 other assay present: RNA\n 2 dimensional reductions calculated: lsi, umap\n\n\nOne can now visualize expression of individual markers across clusters to infer cluster identity.\n\n\n\n\n\n\nQuestion\n\n\n\nAssess the expression of known markers across clusters, projecting the cells in a 2D UMAP.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nVlnPlot(\n  object = PBMC,\n  features = c(\n    'MS4A1', # B-cell\n    'CD3D', # T-cell\n    'NKG7', # NK cell\n    'TREM1' # Monocytes\n  ), \n  assay = \"RNA\"\n)\n\n\n\n\n\n\n\nPBMC$annotation &lt;- dplyr::case_when(\n  Idents(PBMC) %in% c(0, 5, 9, 12) ~ \"Monocytes\", \n  Idents(PBMC) %in% c(1, 2, 3, 4, 7, 10) ~ \"T-cells\", \n  Idents(PBMC) %in% c(6) ~ \"NK-cells\", \n  Idents(PBMC) %in% c(8, 11) ~ \"B-cells\", \n  Idents(PBMC) %in% c(13, 14) ~ \"DC\"\n)\nDimPlot(PBMC, group.by = 'annotation', label = TRUE) + NoLegend()",
    "crumbs": [
      "Day 4",
      "<span class='chapter-number'>13</span>  <span class='chapter-title'>Lab 7: Single-cell ATAC-seq analysis workflow</span>"
    ]
  },
  {
    "objectID": "content/day4/Lab7_atac-seq.html#find-peaks-differentially-accessible-across-clusters",
    "href": "content/day4/Lab7_atac-seq.html#find-peaks-differentially-accessible-across-clusters",
    "title": "\n13  Lab 7: Single-cell ATAC-seq analysis workflow\n",
    "section": "\n13.3 Find peaks differentially accessible across clusters",
    "text": "13.3 Find peaks differentially accessible across clusters\nFinally, we can perform differential peak accessibility analysis to identify peaks that are differentially accessible between clusters. This is done using the FindMarkers function in Signac, which is similar to FindAllMarkers in Seurat.\n\n\n\nR\n\nIdents(PBMC) &lt;- PBMC$annotation\nda_peaks &lt;- FindMarkers(\n  object = PBMC,\n  ident.1 = \"Monocytes\",\n  ident.2 = \"B-cells\",\n  test.use = 'LR',\n  latent.vars = 'nCount_ATAC'\n)\nVlnPlot(\n  object = PBMC,\n  features = rownames(da_peaks)[1],\n  pt.size = 0.1,\n  idents = c(\"Monocytes\",\"B-cells\")\n)",
    "crumbs": [
      "Day 4",
      "<span class='chapter-number'>13</span>  <span class='chapter-title'>Lab 7: Single-cell ATAC-seq analysis workflow</span>"
    ]
  },
  {
    "objectID": "content/day4/Lab7_atac-seq.html#session-info",
    "href": "content/day4/Lab7_atac-seq.html#session-info",
    "title": "\n13  Lab 7: Single-cell ATAC-seq analysis workflow\n",
    "section": "\n13.4 Session info",
    "text": "13.4 Session info\n\n\n─ Session info ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.5.1 (2025-06-13)\n os       Ubuntu 24.04.2 LTS\n system   x86_64, linux-gnu\n ui       X11\n language (EN)\n collate  en_IN.utf8\n ctype    en_IN.utf8\n tz       Europe/Paris\n date     2025-11-14\n pandoc   3.1.3 @ /usr/bin/ (via rmarkdown)\n quarto   1.5.55 @ /opt/quarto/bin/quarto\n\n─ Packages ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n package              * version   date (UTC) lib source\n abind                  1.4-8     2024-09-12 [1] CRAN (R 4.5.1)\n AnnotationDbi          1.72.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n AnnotationFilter       1.34.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n backports              1.5.0     2024-05-23 [1] CRAN (R 4.5.1)\n base64enc              0.1-3     2015-07-28 [1] CRAN (R 4.5.1)\n beachmat               2.26.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n beeswarm               0.4.0     2021-06-01 [1] CRAN (R 4.5.1)\n Biobase                2.70.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocGenerics         * 0.56.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocIO                 1.20.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocManager            1.30.27   2025-11-14 [1] CRAN (R 4.5.1)\n BiocParallel           1.44.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n Biostrings             2.78.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n biovizBase             1.58.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n bit                    4.6.0     2025-03-06 [1] CRAN (R 4.5.0)\n bit64                  4.6.0-1   2025-01-16 [1] CRAN (R 4.5.0)\n bitops                 1.0-9     2024-10-03 [1] CRAN (R 4.5.1)\n blob                   1.2.4     2023-03-17 [1] CRAN (R 4.5.1)\n BSgenome               1.78.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n cachem                 1.1.0     2024-05-16 [1] CRAN (R 4.5.1)\n checkmate              2.3.3     2025-08-18 [1] CRAN (R 4.5.1)\n cigarillo              1.0.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n cli                    3.6.5     2025-04-23 [1] CRAN (R 4.5.1)\n cluster                2.1.8.1   2025-03-12 [2] CRAN (R 4.5.1)\n codetools              0.2-20    2024-03-31 [2] CRAN (R 4.5.1)\n colorspace             2.1-2     2025-09-22 [1] CRAN (R 4.5.1)\n cowplot                1.2.0     2025-07-07 [1] CRAN (R 4.5.1)\n crayon                 1.5.3     2024-06-20 [1] CRAN (R 4.5.1)\n curl                   7.0.0     2025-08-19 [1] CRAN (R 4.5.1)\n data.table             1.17.8    2025-07-10 [1] CRAN (R 4.5.1)\n DBI                    1.2.3     2024-06-02 [1] CRAN (R 4.5.1)\n DelayedArray           0.36.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n DelayedMatrixStats     1.32.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n deldir                 2.0-4     2024-02-28 [1] CRAN (R 4.5.1)\n devtools               2.4.6     2025-10-03 [1] CRAN (R 4.5.1)\n dichromat              2.0-0.1   2022-05-02 [1] CRAN (R 4.5.1)\n digest                 0.6.38    2025-11-12 [1] CRAN (R 4.5.1)\n dotCall64              1.2       2024-10-04 [1] CRAN (R 4.5.1)\n dplyr                  1.1.4     2023-11-17 [1] CRAN (R 4.5.1)\n dqrng                  0.4.1     2024-05-28 [1] CRAN (R 4.5.1)\n DropletUtils           1.30.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n edgeR                  4.8.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n ellipsis               0.3.2     2021-04-29 [1] CRAN (R 4.5.1)\n EnsDb.Hsapiens.v75     2.99.0    2025-07-16 [1] Bioconductor\n ensembldb              2.34.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n evaluate               1.0.5     2025-08-27 [1] CRAN (R 4.5.1)\n farver                 2.1.2     2024-05-13 [1] CRAN (R 4.5.1)\n fastDummies            1.7.5     2025-01-20 [1] CRAN (R 4.5.0)\n fastmap                1.2.0     2024-05-15 [1] CRAN (R 4.5.1)\n fastmatch              1.1-6     2024-12-23 [1] CRAN (R 4.5.0)\n fitdistrplus           1.2-4     2025-07-03 [1] CRAN (R 4.5.1)\n foreign                0.8-90    2025-03-31 [2] CRAN (R 4.5.1)\n Formula                1.2-5     2023-02-24 [1] CRAN (R 4.5.1)\n fs                     1.6.6     2025-04-12 [1] CRAN (R 4.5.1)\n future               * 1.67.0    2025-07-29 [1] CRAN (R 4.5.1)\n future.apply           1.20.0    2025-06-06 [1] CRAN (R 4.5.1)\n generics             * 0.1.4     2025-05-09 [1] CRAN (R 4.5.1)\n GenomeInfoDb           1.46.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n GenomicAlignments      1.46.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n GenomicFeatures        1.62.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n GenomicRanges        * 1.62.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n ggbeeswarm             0.7.2     2023-04-29 [1] CRAN (R 4.5.1)\n ggplot2                4.0.1     2025-11-14 [1] CRAN (R 4.5.1)\n ggrastr                1.0.2     2023-06-01 [1] CRAN (R 4.5.1)\n ggrepel                0.9.6     2024-09-07 [1] CRAN (R 4.5.1)\n ggridges               0.5.7     2025-08-27 [1] CRAN (R 4.5.1)\n globals                0.18.0    2025-05-08 [1] CRAN (R 4.5.1)\n glue                   1.8.0     2024-09-30 [1] CRAN (R 4.5.1)\n goftest                1.2-3     2021-10-07 [1] CRAN (R 4.5.1)\n gridExtra              2.3       2017-09-09 [1] CRAN (R 4.5.1)\n gtable                 0.3.6     2024-10-25 [1] CRAN (R 4.5.1)\n h5mread                1.2.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n HDF5Array              1.38.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n hdf5r                  1.3.12    2025-01-20 [1] CRAN (R 4.5.1)\n Hmisc                  5.2-4     2025-10-05 [1] CRAN (R 4.5.1)\n htmlTable              2.4.3     2024-07-21 [1] CRAN (R 4.5.1)\n htmltools              0.5.8.1   2024-04-04 [1] CRAN (R 4.5.1)\n htmlwidgets            1.6.4     2023-12-06 [1] CRAN (R 4.5.1)\n httpuv                 1.6.16    2025-04-16 [1] CRAN (R 4.5.1)\n httr                   1.4.7     2023-08-15 [1] CRAN (R 4.5.1)\n ica                    1.0-3     2022-07-08 [1] CRAN (R 4.5.1)\n igraph                 2.2.1     2025-10-27 [1] CRAN (R 4.5.1)\n IRanges              * 2.44.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n irlba                  2.3.5.1   2022-10-03 [1] CRAN (R 4.5.1)\n jsonlite               2.0.0     2025-03-27 [1] CRAN (R 4.5.1)\n KEGGREST               1.50.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n KernSmooth             2.23-26   2025-01-01 [2] CRAN (R 4.5.1)\n knitr                  1.50      2025-03-16 [1] CRAN (R 4.5.1)\n labeling               0.4.3     2023-08-29 [1] CRAN (R 4.5.1)\n later                  1.4.4     2025-08-27 [1] CRAN (R 4.5.1)\n lattice                0.22-7    2025-04-02 [2] CRAN (R 4.5.1)\n lazyeval               0.2.2     2019-03-15 [1] CRAN (R 4.5.1)\n lifecycle              1.0.4     2023-11-07 [1] CRAN (R 4.5.1)\n limma                  3.66.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n listenv                0.10.0    2025-11-02 [1] CRAN (R 4.5.1)\n lmtest                 0.9-40    2022-03-21 [1] CRAN (R 4.5.1)\n locfit                 1.5-9.12  2025-03-05 [1] CRAN (R 4.5.0)\n magrittr               2.0.4     2025-09-12 [1] CRAN (R 4.5.1)\n MASS                   7.3-65    2025-02-28 [2] CRAN (R 4.5.1)\n Matrix                 1.7-3     2025-03-11 [1] CRAN (R 4.5.1)\n MatrixGenerics         1.22.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n matrixStats            1.5.0     2025-01-07 [1] CRAN (R 4.5.0)\n memoise                2.0.1     2021-11-26 [1] CRAN (R 4.5.1)\n mime                   0.13      2025-03-17 [1] CRAN (R 4.5.1)\n miniUI                 0.1.2     2025-04-17 [1] CRAN (R 4.5.1)\n nlme                   3.1-168   2025-03-31 [2] CRAN (R 4.5.1)\n nnet                   7.3-20    2025-01-01 [2] CRAN (R 4.5.1)\n otel                   0.2.0     2025-08-29 [1] CRAN (R 4.5.1)\n parallelly             1.45.1    2025-07-24 [1] CRAN (R 4.5.1)\n patchwork              1.3.2     2025-08-25 [1] CRAN (R 4.5.1)\n pbapply                1.7-4     2025-07-20 [1] CRAN (R 4.5.1)\n pillar                 1.11.1    2025-09-17 [1] CRAN (R 4.5.1)\n pkgbuild               1.4.8     2025-05-26 [1] CRAN (R 4.5.1)\n pkgconfig              2.0.3     2019-09-22 [1] CRAN (R 4.5.1)\n pkgload                1.4.1     2025-09-23 [1] CRAN (R 4.5.1)\n plotly                 4.11.0    2025-06-19 [1] CRAN (R 4.5.1)\n plyr                   1.8.9     2023-10-02 [1] CRAN (R 4.5.1)\n png                    0.1-8     2022-11-29 [1] CRAN (R 4.5.1)\n polyclip               1.10-7    2024-07-23 [1] CRAN (R 4.5.1)\n progressr              0.18.0    2025-11-06 [1] CRAN (R 4.5.1)\n promises               1.5.0     2025-11-01 [1] CRAN (R 4.5.1)\n ProtGenerics           1.42.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n purrr                  1.2.0     2025-11-04 [1] CRAN (R 4.5.1)\n R.methodsS3            1.8.2     2022-06-13 [1] CRAN (R 4.5.1)\n R.oo                   1.27.1    2025-05-02 [1] CRAN (R 4.5.1)\n R.utils                2.13.0    2025-02-24 [1] CRAN (R 4.5.0)\n R6                     2.6.1     2025-02-15 [1] CRAN (R 4.5.0)\n RANN                   2.6.2     2024-08-25 [1] CRAN (R 4.5.1)\n RColorBrewer           1.1-3     2022-04-03 [1] CRAN (R 4.5.1)\n Rcpp                   1.1.0     2025-07-02 [1] CRAN (R 4.5.1)\n RcppAnnoy              0.0.22    2024-01-23 [1] CRAN (R 4.5.1)\n RcppHNSW               0.6.0     2024-02-04 [1] CRAN (R 4.5.1)\n RcppRoll               0.3.1     2024-07-07 [1] CRAN (R 4.5.1)\n RCurl                  1.98-1.17 2025-03-22 [1] CRAN (R 4.5.1)\n remotes                2.5.0     2024-03-17 [1] CRAN (R 4.5.1)\n reshape2               1.4.5     2025-11-12 [1] CRAN (R 4.5.1)\n restfulr               0.0.16    2025-06-27 [1] CRAN (R 4.5.1)\n reticulate             1.44.0    2025-10-25 [1] CRAN (R 4.5.1)\n rhdf5                  2.54.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n rhdf5filters           1.22.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n Rhdf5lib               1.32.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n rjson                  0.2.23    2024-09-16 [1] CRAN (R 4.5.1)\n rlang                  1.1.6     2025-04-11 [1] CRAN (R 4.5.1)\n rmarkdown              2.30      2025-09-28 [1] CRAN (R 4.5.1)\n ROCR                   1.0-11    2020-05-02 [1] CRAN (R 4.5.1)\n rpart                  4.1.24    2025-01-07 [2] CRAN (R 4.5.1)\n Rsamtools              2.26.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n RSpectra               0.16-2    2024-07-18 [1] CRAN (R 4.5.1)\n RSQLite                2.4.4     2025-11-10 [1] CRAN (R 4.5.1)\n rstudioapi             0.17.1    2024-10-22 [1] CRAN (R 4.5.1)\n rtracklayer          * 1.70.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n Rtsne                  0.17      2023-12-07 [1] CRAN (R 4.5.1)\n S4Arrays               1.10.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n S4Vectors            * 0.48.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n S7                     0.2.0     2024-11-07 [1] CRAN (R 4.5.1)\n scales                 1.4.0     2025-04-24 [1] CRAN (R 4.5.1)\n scattermore            1.2       2023-06-12 [1] CRAN (R 4.5.1)\n sctransform            0.4.2     2025-04-30 [1] CRAN (R 4.5.1)\n scuttle                1.20.0    2025-10-30 [1] Bioconductor 3.22 (R 4.5.1)\n Seqinfo              * 1.0.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n sessioninfo            1.2.3     2025-02-05 [1] CRAN (R 4.5.0)\n Seurat               * 5.3.1     2025-10-29 [1] CRAN (R 4.5.1)\n SeuratObject         * 5.2.0     2025-08-27 [1] CRAN (R 4.5.1)\n shiny                  1.11.1    2025-07-03 [1] CRAN (R 4.5.1)\n Signac               * 1.16.0    2025-10-10 [1] CRAN (R 4.5.1)\n SingleCellExperiment   1.32.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n sp                   * 2.2-0     2025-02-01 [1] CRAN (R 4.5.0)\n spam                   2.11-1    2025-01-20 [1] CRAN (R 4.5.0)\n SparseArray            1.10.1    2025-10-31 [1] Bioconductor 3.22 (R 4.5.1)\n sparseMatrixStats      1.22.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n spatstat.data          3.1-9     2025-10-18 [1] CRAN (R 4.5.1)\n spatstat.explore       3.5-3     2025-09-22 [1] CRAN (R 4.5.1)\n spatstat.geom          3.6-0     2025-09-20 [1] CRAN (R 4.5.1)\n spatstat.random        3.4-2     2025-09-21 [1] CRAN (R 4.5.1)\n spatstat.sparse        3.1-0     2024-06-21 [1] CRAN (R 4.5.1)\n spatstat.univar        3.1-4     2025-07-13 [1] CRAN (R 4.5.1)\n spatstat.utils         3.2-0     2025-09-20 [1] CRAN (R 4.5.1)\n statmod                1.5.1     2025-10-09 [1] CRAN (R 4.5.1)\n stringi                1.8.7     2025-03-27 [1] CRAN (R 4.5.1)\n stringr              * 1.6.0     2025-11-04 [1] CRAN (R 4.5.1)\n SummarizedExperiment   1.40.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n survival               3.8-3     2024-12-17 [2] CRAN (R 4.5.1)\n tensor                 1.5.1     2025-06-17 [1] CRAN (R 4.5.1)\n tibble                 3.3.0     2025-06-08 [1] CRAN (R 4.5.1)\n tidyr                  1.3.1     2024-01-24 [1] CRAN (R 4.5.1)\n tidyselect             1.2.1     2024-03-11 [1] CRAN (R 4.5.1)\n UCSC.utils             1.6.0     2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n usethis                3.2.1     2025-09-06 [1] CRAN (R 4.5.1)\n uwot                   0.2.4     2025-11-10 [1] CRAN (R 4.5.1)\n VariantAnnotation      1.56.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n vctrs                  0.6.5     2023-12-01 [1] CRAN (R 4.5.1)\n vipor                  0.4.7     2023-12-18 [1] CRAN (R 4.5.1)\n viridisLite            0.4.2     2023-05-02 [1] CRAN (R 4.5.1)\n withr                  3.0.2     2024-10-28 [1] CRAN (R 4.5.1)\n xfun                   0.54      2025-10-30 [1] CRAN (R 4.5.1)\n XML                    3.99-0.20 2025-11-08 [1] CRAN (R 4.5.1)\n xtable                 1.8-4     2019-04-21 [1] CRAN (R 4.5.1)\n XVector                0.50.0    2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n yaml                   2.3.10    2024-07-26 [1] CRAN (R 4.5.1)\n zoo                    1.8-14    2025-04-10 [1] CRAN (R 4.5.1)\n\n [1] /home/rsg/R/x86_64-pc-linux-gnu-library/4.5\n [2] /opt/R/4.5.1/lib/R/library\n * ── Packages attached to the search path.\n\n──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────",
    "crumbs": [
      "Day 4",
      "<span class='chapter-number'>13</span>  <span class='chapter-title'>Lab 7: Single-cell ATAC-seq analysis workflow</span>"
    ]
  },
  {
    "objectID": "content/day4/Lecture7_pseudotime.html",
    "href": "content/day4/Lecture7_pseudotime.html",
    "title": "14  Lecture 7 - Trajectories and pseudotimes",
    "section": "",
    "text": "Slides here",
    "crumbs": [
      "Day 4",
      "<span class='chapter-number'>14</span>  <span class='chapter-title'>Lecture 7 - Trajectories and pseudotimes</span>"
    ]
  },
  {
    "objectID": "content/day4/Lab8_pseudotime.html",
    "href": "content/day4/Lab8_pseudotime.html",
    "title": "\n15  Lab 8: Pseudotime analyses\n",
    "section": "",
    "text": "15.1 Process testis data in R",
    "crumbs": [
      "Day 4",
      "<span class='chapter-number'>15</span>  <span class='chapter-title'>Lab 8: Pseudotime analyses</span>"
    ]
  },
  {
    "objectID": "content/day4/Lab8_pseudotime.html#process-testis-data-in-r",
    "href": "content/day4/Lab8_pseudotime.html#process-testis-data-in-r",
    "title": "\n15  Lab 8: Pseudotime analyses\n",
    "section": "",
    "text": "15.1.1 Import testis data from GSE112013 and pre-process it\nWe will work on a testis dataset, from the “The adult human testis transcriptional cell atlas” study (Guo et al., 2018). This dataset contains single-cell RNAseq data from human testis. It is available on the GEO database under the accession number GSE112013.\nThe pre-processing of the testis dataset has already been done for you. We have applied the different analysis steps we have learned over the past three days to the count matrix GSE112013_Combined_UMI_table.txt.gz. See the code below for the details of pre-processing steps.\n\n\n\n\n\n\n👀 Data pre-processing 👇\n\n\n\n\n\nCheck the GEO page for supplementary processed data, and download the GSE112013_Combined_UMI_table.txt.gz table.\nWith this data, we will:\n\nImport the dataset in R as a SingleCellExperiment object,\nRemove doublets,\nFilter genes,\nNormalize counts,\nCorrect for batch effect,\nCluster cells.\n\n\n\n\nR\n\nlibrary(SingleCellExperiment)\nlibrary(tidyverse)\n\n# Download raw file\ndir.create('Guo_testis')\ndownload.file(\n    'https://ftp.ncbi.nlm.nih.gov/geo/series/GSE112nnn/GSE112013/suppl/GSE112013_Combined_UMI_table.txt.gz', \n    'Guo_testis/GSE112013_Combined_UMI_table.txt.gz'\n)\nsystem('gunzip Guo_testis/GSE112013_Combined_UMI_table.txt.gz')\n\n# Create SingleCellExperiment object\nx &lt;- vroom::vroom('Guo_testis/GSE112013_Combined_UMI_table.txt')\ncounts &lt;- as.matrix(x[, -1])\ncounts &lt;- as(counts, 'dgCMatrix')\ngenes &lt;- as.data.frame(x[, 1])\ncells &lt;- data.frame(cellid = colnames(x[, -1]))\ntestis &lt;- SingleCellExperiment(\n    assays = list(counts = counts), \n    colData = cells, \n    rowData = genes\n)\ntestis$Barcode &lt;- str_replace(testis$cellid, 'Donor.-', '') |&gt; str_replace('-.', '')\ntestis &lt;- testis[, !duplicated(testis$Barcode)]\ntestis$donor &lt;- str_replace(testis$cellid, '-.*', '')\ntestis$replicate &lt;- str_replace(testis$cellid, '.*-', '')\nrownames(testis) &lt;- rowData(testis)$Gene\nset.seed(1000)\n\n# Remove doublets\ntestis &lt;- scDblFinder::scDblFinder(testis)\ntestis &lt;- testis[, testis$scDblFinder.class == 'singlet']\n\n# Recover human genomic, protein-coding gene informations\nlibrary(plyranges)\nah &lt;- AnnotationHub::AnnotationHub()\nAnnotationHub::query(ah, c('gene annotation', 'ensembl', '102', 'homo_sapiens', 'GRCh38'))\ngtf &lt;- AnnotationHub::query(ah, c('Homo_sapiens.GRCh38.102.chr.gtf'))[[1]]\ngenes &lt;- gtf |&gt; \n    filter(type == 'gene') |&gt; \n    filter(gene_biotype == 'protein_coding') |&gt; \n    filter(gene_source == 'ensembl_havana') \ngenes &lt;- genes[!duplicated(genes$gene_name)]\n\n# Annotate genes in testis dataset and filter out non-relevant genes\ntestis &lt;- testis[genes$gene_name[genes$gene_name %in% rownames(testis)], ]\nrowRanges(testis) &lt;- genes[match(rownames(testis), genes$gene_name)]\nrowData(testis) &lt;- rowData(testis)[, c('gene_name', 'gene_id')]\nrownames(testis) &lt;- scuttle::uniquifyFeatureNames(rowData(testis)$gene_id, rowData(testis)$gene_name)\n\n# Get preliminary QCs per cell and per gene\ntestis &lt;- scuttle::addPerCellQCMetrics(testis)\ntestis &lt;- scuttle::addPerFeatureQCMetrics(testis)\n\n# Filter out genes not expressed in at least 10 cells\ntestis &lt;- testis[rowSums(assay(testis, 'counts') &gt; 0) &gt;= 10, ]\n\n# Normalize counts using VST\ncnts &lt;- as(assay(testis, 'counts'), 'dgCMatrix')\ncolnames(cnts) &lt;- testis$cellid\nrownames(cnts) &lt;- rownames(testis)\ntestis_vst &lt;- sctransform::vst(cnts, return_cell_attr = TRUE)\ncorrected_cnts &lt;- sctransform::correct(testis_vst)\nassay(testis, 'corrected_counts', withDimnames = FALSE) &lt;- corrected_cnts\nassay(testis, 'logcounts', withDimnames = FALSE) &lt;- log1p(corrected_cnts)\n\n# Computing biological variance of each gene\ntestis_variance &lt;- scran::modelGeneVar(testis)\nHVGs &lt;- scran::getTopHVGs(testis_variance, prop = 0.1)\nrowData(testis)$isHVG &lt;- rownames(testis) %in% HVGs\n\n# Embedding dataset in PCA space, correcting for batch effect\nmergedBatches &lt;- batchelor::fastMNN(\n    testis, \n    batch = testis$donor, \n    subset.row = HVGs, \n    BPPARAM = BiocParallel::MulticoreParam(workers = 12)\n)\nreducedDim(testis, 'corrected') &lt;- reducedDim(mergedBatches, 'corrected')\n\n# Embedding dataset in shared k-nearest neighbors graph for clustering \ngraph &lt;- scran::buildSNNGraph(testis, use.dimred = 'corrected')\n\n# Cluster cells using Louvain community finding algorithm\ntestis_clust &lt;- igraph::cluster_louvain(graph)$membership\ntable(testis_clust)\ntestis$cluster &lt;- factor(testis_clust)\n\n# Embedding dataset in TSNE space for visualization\nset.seed(10)\ntestis &lt;- scater::runTSNE(testis, dimred = 'corrected')\n\n# Visualize embeddings\np &lt;- cowplot::plot_grid(\n    scater::plotReducedDim(testis, 'corrected', colour_by = 'donor'),\n    scater::plotReducedDim(testis, 'corrected', colour_by = 'cluster'),\n    scater::plotReducedDim(testis, 'TSNE', colour_by = 'donor'),\n    scater::plotReducedDim(testis, 'TSNE', colour_by = 'cluster')\n)\np\nsaveRDS(testis, '~/Share/Guo_testis.rds')\n\n\n\n\n\n\n15.1.2 Annotate cells using HPA resources\nThe Human Protein Atlas (HPA) is a valuable resource for cell type annotations. It provides single-cell RNAseq data for a large number of cell types.\n\n\n\n\n\n\nQuestion\n\n\n\nDownload HPA scRNAseq atlas (combined per cell type) from here, and import it in R as a SummarizedExperiment object.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nlibrary(SingleCellExperiment)\n\n\nLoading required package: SummarizedExperiment\n\n\nLoading required package: MatrixGenerics\n\n\nLoading required package: matrixStats\n\n\n\nAttaching package: 'MatrixGenerics'\n\n\nThe following objects are masked from 'package:matrixStats':\n\n    colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse, colCounts, colCummaxs, colCummins, colCumprods, colCumsums, colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs, colMads, colMaxs, colMeans2,\n    colMedians, colMins, colOrderStats, colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds, colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads, colWeightedMeans, colWeightedMedians,\n    colWeightedSds, colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet, rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods, rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,\n    rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins, rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks, rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars, rowWeightedMads,\n    rowWeightedMeans, rowWeightedMedians, rowWeightedSds, rowWeightedVars\n\n\nLoading required package: GenomicRanges\n\n\nLoading required package: stats4\n\n\nLoading required package: BiocGenerics\n\n\nLoading required package: generics\n\n\n\nAttaching package: 'generics'\n\n\nThe following objects are masked from 'package:base':\n\n    as.difftime, as.factor, as.ordered, intersect, is.element, setdiff, setequal, union\n\n\n\nAttaching package: 'BiocGenerics'\n\n\nThe following objects are masked from 'package:stats':\n\n    IQR, mad, sd, var, xtabs\n\n\nThe following objects are masked from 'package:base':\n\n    anyDuplicated, aperm, append, as.data.frame, basename, cbind, colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep, grepl, is.unsorted, lapply, Map, mapply, match, mget, order, paste,\n    pmax, pmax.int, pmin, pmin.int, Position, rank, rbind, Reduce, rownames, sapply, saveRDS, table, tapply, unique, unsplit, which.max, which.min\n\n\nLoading required package: S4Vectors\n\n\n\nAttaching package: 'S4Vectors'\n\n\nThe following object is masked from 'package:utils':\n\n    findMatches\n\n\nThe following objects are masked from 'package:base':\n\n    expand.grid, I, unname\n\n\nLoading required package: IRanges\n\n\nLoading required package: Seqinfo\n\n\nLoading required package: Biobase\n\n\nWelcome to Bioconductor\n\n    Vignettes contain introductory material; view with 'browseVignettes()'. To cite Bioconductor, see 'citation(\"Biobase\")', and for packages 'citation(\"pkgname\")'.\n\n\n\nAttaching package: 'Biobase'\n\n\nThe following object is masked from 'package:MatrixGenerics':\n\n    rowMedians\n\n\nThe following objects are masked from 'package:matrixStats':\n\n    anyMissing, rowMedians\n\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.1     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.2.0     \n\n\n── Conflicts ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──\n✖ lubridate::%within%() masks IRanges::%within%()\n✖ dplyr::collapse()     masks IRanges::collapse()\n✖ dplyr::combine()      masks Biobase::combine(), BiocGenerics::combine()\n✖ dplyr::count()        masks matrixStats::count()\n✖ dplyr::desc()         masks IRanges::desc()\n✖ tidyr::expand()       masks S4Vectors::expand()\n✖ dplyr::filter()       masks stats::filter()\n✖ dplyr::first()        masks S4Vectors::first()\n✖ dplyr::lag()          masks stats::lag()\n✖ ggplot2::Position()   masks BiocGenerics::Position(), base::Position()\n✖ purrr::reduce()       masks GenomicRanges::reduce(), IRanges::reduce()\n✖ dplyr::rename()       masks S4Vectors::rename()\n✖ lubridate::second()   masks S4Vectors::second()\n✖ lubridate::second&lt;-() masks S4Vectors::second&lt;-()\n✖ dplyr::slice()        masks IRanges::slice()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nHPA &lt;- read_tsv('~/Share/rna_single_cell_type.tsv.zip') |&gt; \n    pivot_wider(names_from = `Cell type`, values_from = 'nTPM') |&gt; \n    dplyr::select(-Gene) |&gt; \n    distinct(`Gene name`, .keep_all = TRUE) |&gt; \n    column_to_rownames('Gene name')\n\nRows: 1626642 Columns: 4\n── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\nDelimiter: \"\\t\"\nchr (3): Gene, Gene name, Cell type\ndbl (1): nTPM\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\nHPA_se &lt;- SummarizedExperiment::SummarizedExperiment(HPA, colData = tibble(cell_type = colnames(HPA)), assays = list('logcounts' = HPA))\n\n\n\n\nHow many and what cell types are profiled?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nlength(HPA_se$cell_type)\n\n\n[1] 81\n\nHPA_se$cell_type\n\n [1] \"Adipocytes\"                      \"Alveolar cells type 1\"           \"Alveolar cells type 2\"           \"Astrocytes\"                      \"B-cells\"                         \"Basal keratinocytes\"            \n [7] \"Basal prostatic cells\"           \"Basal respiratory cells\"         \"Basal squamous epithelial cells\" \"Bipolar cells\"                   \"Breast glandular cells\"          \"Breast myoepithelial cells\"     \n[13] \"Cardiomyocytes\"                  \"Cholangiocytes\"                  \"Ciliated cells\"                  \"Club cells\"                      \"Collecting duct cells\"           \"Cone photoreceptor cells\"       \n[19] \"Cytotrophoblasts\"                \"dendritic cells\"                 \"Distal enterocytes\"              \"Distal tubular cells\"            \"Ductal cells\"                    \"Early spermatids\"               \n[25] \"Endometrial stromal cells\"       \"Endothelial cells\"               \"Enteroendocrine cells\"           \"Erythroid cells\"                 \"Excitatory neurons\"              \"Exocrine glandular cells\"       \n[31] \"Extravillous trophoblasts\"       \"Fibroblasts\"                     \"Gastric mucus-secreting cells\"   \"Glandular and luminal cells\"     \"granulocytes\"                    \"Granulosa cells\"                \n[37] \"Hepatocytes\"                     \"Hofbauer cells\"                  \"Horizontal cells\"                \"Inhibitory neurons\"              \"Intestinal goblet cells\"         \"Ionocytes\"                      \n[43] \"Kupffer cells\"                   \"Langerhans cells\"                \"Late spermatids\"                 \"Leydig cells\"                    \"Lymphatic endothelial cells\"     \"Macrophages\"                    \n[49] \"Melanocytes\"                     \"Mesothelial cells\"               \"Microglial cells\"                \"monocytes\"                       \"Mucus glandular cells\"           \"Muller glia cells\"              \n[55] \"NK-cells\"                        \"Oligodendrocyte precursor cells\" \"Oligodendrocytes\"                \"Oocytes\"                         \"Ovarian stromal cells\"           \"Pancreatic endocrine cells\"     \n[61] \"Paneth cells\"                    \"Peritubular cells\"               \"Plasma cells\"                    \"Prostatic glandular cells\"       \"Proximal enterocytes\"            \"Proximal tubular cells\"         \n[67] \"Rod photoreceptor cells\"         \"Salivary duct cells\"             \"Schwann cells\"                   \"Secretory cells\"                 \"Serous glandular cells\"          \"Sertoli cells\"                  \n[73] \"Skeletal myocytes\"               \"Smooth muscle cells\"             \"Spermatocytes\"                   \"Spermatogonia\"                   \"Squamous epithelial cells\"       \"Suprabasal keratinocytes\"       \n[79] \"Syncytiotrophoblasts\"            \"T-cells\"                         \"Undifferentiated cells\"         \n\n\n\n\n\n\n\nWe can use the HPA reference to annotate cell types in the testis dataset.\n\n\n\n\n\n\nQuestion\n\n\n\nUse SingleR to annotate cell types in the testis dataset using HPA reference.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ntestis &lt;- readRDS('~/Share/Guo_testis.rds')\npredictions &lt;- SingleR::SingleR(\n    test = testis, \n    ref = HPA_se, \n    labels = colData(HPA_se)$cell_type, \n    clusters = testis$cluster\n)\ntestis$annotation &lt;- predictions$labels[testis$cluster]\ncowplot::plot_grid(\n    scater::plotReducedDim(testis, dimred = 'corrected', colour_by = 'cluster', text_by = 'cluster') + ggtitle('Testis data, PCA, graph-based clusters'), \n    scater::plotReducedDim(testis, dimred = 'corrected', colour_by = 'annotation', text_by = 'annotation') + ggtitle('PCA, Annotations transferred from HPA'),\n    scater::plotReducedDim(testis, dimred = 'TSNE', colour_by = 'cluster', text_by = 'cluster') + ggtitle('Testis data, tSNE, graph-based clusters'), \n    scater::plotReducedDim(testis, dimred = 'TSNE', colour_by = 'annotation', text_by = 'annotation') + ggtitle('tSNE, Annotations transferred from HPA')\n)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n15.1.3 Filter the testis dataset to only germinal cells.\nIn this notebook, we will focus on germinal cells only.\n\n\n\n\n\n\nQuestion\n\n\n\nFilter the testis dataset to only retain germinal cells.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ngermcells &lt;- testis[\n    , \n    testis$annotation %in% c(\"Spermatogonia\", \"Spermatocytes\", \"Early spermatids\", \"Late spermatids\")\n]",
    "crumbs": [
      "Day 4",
      "<span class='chapter-number'>15</span>  <span class='chapter-title'>Lab 8: Pseudotime analyses</span>"
    ]
  },
  {
    "objectID": "content/day4/Lab8_pseudotime.html#trajectory-inference-ti-in-scrnaseq",
    "href": "content/day4/Lab8_pseudotime.html#trajectory-inference-ti-in-scrnaseq",
    "title": "\n15  Lab 8: Pseudotime analyses\n",
    "section": "\n15.2 Trajectory inference (TI) in scRNAseq",
    "text": "15.2 Trajectory inference (TI) in scRNAseq\nAn important question in scRNAseq field of research is: how to identify a cell trajectory from high-dimensional expression data and map individual cells onto it? A large number of methods have currently emerged, each one with their own specificities, assumptions, and strengths. A nice breakdown (from 2019, so already very outdated!) is available from Saelens et al., Nat. Biotech. 2018 (doi: 10.1038/s41587-019-0071-9):\n\n\n15.2.1 Trajectory\nSlingshot is perhaps one of the most widely used algorithms for users who want to focus on R-based approaches.\n\n\n\n\n\n\nQuestion\n\n\n\nRead Slingshot documentation to understand how to identify lineages in a scRNAseq dataset in R.\nWhy is it recommended to infer lineages from PCA space rather than t-SNE or UMAP space, even though these spaces do “reveal” an obvious trajectory in 2D?\nInfer lineages, using cluster annotations as information to build the MST. Note that you will first need to remove the 50th PCA dimension for slingshot to work (bug reported).\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\nreducedDim(germcells, 'corrected_2') &lt;- reducedDim(germcells, 'corrected')[, 1:49]\ngermcells_slingshot &lt;- slingshot::slingshot(\n    germcells, \n    reducedDim = 'corrected_2', \n    clusterLabels = germcells$annotation\n)\nslingshot::slingLineages(germcells_slingshot)\n\n\n$Lineage1\n[1] \"Late spermatids\"  \"Early spermatids\" \"Spermatocytes\"    \"Spermatogonia\"   \n\n\n\n\n\n\n\n\n15.2.2 Pseudotime\nslingshot automatically deduces a pseudotime for each cell, based on the inferred lineage. It can be useful to visualize the trajectory of cells in a 2D space, and to order cells along the trajectory.\n\n\n\n\n\n\nQuestion\n\n\n\nRecover pseudotime values and principal curves from slingshot output.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\n# Fetching pseudotime\ngermcells$pseudotime &lt;- slingshot::slingPseudotime(germcells_slingshot)[, 'Lineage1']\n\n# Fetching principal curve in PCA space\npca_curve &lt;- slingshot::slingCurves(germcells_slingshot, as.df = TRUE)\ncolnames(pca_curve) &lt;- paste0('PC', 1:ncol(pca_curve))\nhead(pca_curve)\n\n\n        PC1       PC2        PC3        PC4        PC5         PC6       PC7          PC8        PC9        PC10       PC11          PC12        PC13        PC14        PC15       PC16         PC17        PC18         PC19        PC20\n1 0.5325495 0.1276968 -0.3338294 0.03607803 -0.2867371 -0.04204578 0.1373407 -0.009995032 0.02694292 -0.05042603 0.02989087  0.0052385866 -0.01891094 -0.02557450 -0.01074822 0.02006208 -0.004049899 0.005945587 -0.008946025 -0.01650377\n2 0.5331398 0.1257388 -0.3247271 0.03485780 -0.2736647 -0.04013422 0.1309875 -0.009137282 0.02570672 -0.04767513 0.02789986  0.0036906281 -0.01921118 -0.02469666 -0.01185168 0.02123153 -0.005693288 0.008123469 -0.008691642 -0.01882372\n3 0.5337301 0.1237808 -0.3156248 0.03363757 -0.2605924 -0.03822266 0.1246343 -0.008279533 0.02447052 -0.04492423 0.02590885  0.0021426696 -0.01951141 -0.02381882 -0.01295515 0.02240099 -0.007336677 0.010301352 -0.008437259 -0.02114368\n4 0.5343203 0.1218225 -0.3065221 0.03241733 -0.2475201 -0.03631096 0.1182814 -0.007421829 0.02323440 -0.04217374 0.02391820  0.0005949673 -0.01981168 -0.02294110 -0.01405882 0.02357044 -0.008979922 0.012479056 -0.008182887 -0.02346336\n5 0.5349071 0.1198600 -0.2974091 0.03119693 -0.2344467 -0.03439599 0.1119345 -0.006565157 0.02200032 -0.03943262 0.02193567 -0.0009469702 -0.02011281 -0.02206623 -0.01516704 0.02473980 -0.010619931 0.014652768 -0.007928743 -0.02577685\n6 0.5354859 0.1178876 -0.2882723 0.02997607 -0.2213710 -0.03247363 0.1056018 -0.005710976 0.02077099 -0.03671313 0.01997189 -0.0024758689 -0.02041580 -0.02119776 -0.01628533 0.02590878 -0.012252541 0.016817534 -0.007674945 -0.02807629\n           PC21        PC22         PC23        PC24          PC25        PC26        PC27         PC28         PC29         PC30        PC31         PC32         PC33        PC34          PC35        PC36         PC37         PC38\n1 -0.0029292732 -0.01740418 -0.008778491 0.007464003  5.469541e-05 0.010087137 -0.01025984 -0.003594421 -0.006246169 -0.006892746 0.007830963 -0.001501482 -0.006010969 0.008765395 -5.878827e-04 0.008315953 -0.004101814 -0.002588275\n2 -0.0023672892 -0.01709908 -0.009320922 0.007174715 -6.963008e-04 0.010016335 -0.01051595 -0.003669928 -0.006987168 -0.006512014 0.008072177 -0.001601186 -0.005422918 0.008652475 -2.692971e-04 0.008265890 -0.004417917 -0.002858201\n3 -0.0018053053 -0.01679399 -0.009863353 0.006885427 -1.447297e-03 0.009945533 -0.01077205 -0.003745435 -0.007728167 -0.006131283 0.008313391 -0.001700890 -0.004834868 0.008539555  4.928844e-05 0.008215826 -0.004734021 -0.003128126\n4 -0.0012433614 -0.01648882 -0.010405773 0.006596116 -2.198223e-03 0.009874717 -0.01102819 -0.003820893 -0.008469058 -0.005750444 0.008554561 -0.001800608 -0.004246773 0.008426616  3.678258e-04 0.008165781 -0.005050146 -0.003398065\n5 -0.0006823155 -0.01618220 -0.010947931 0.006306299 -2.947566e-03 0.009803577 -0.01128523 -0.003895246 -0.009207520 -0.005367197 0.008794751 -0.001900646 -0.003657683 0.008313243  6.852795e-04 0.008116147 -0.005366749 -0.003668313\n6 -0.0001230492 -0.01587233 -0.011489337 0.006015552 -3.693320e-03 0.009731523 -0.01154415 -0.003967304 -0.009940636 -0.004978854 0.009032770 -0.002001198 -0.003066598 0.008199056  1.000334e-03 0.008067239 -0.005684088 -0.003939072\n         PC39        PC40          PC41        PC42         PC43         PC44         PC45        PC46         PC47          PC48          PC49 PC50 PC51\n1 0.005797593 0.001019230 -1.190253e-03 0.002487841 -0.002784071 0.0006400310 0.0034053070 0.005315365 -0.002891229 -0.0001925498 -0.0022104639    1    1\n2 0.006058814 0.001529594 -9.689303e-04 0.002640566 -0.002655263 0.0007108583 0.0028290951 0.004851459 -0.002537740 -0.0002736222 -0.0017384198    2    1\n3 0.006320035 0.002039959 -7.476072e-04 0.002793292 -0.002526455 0.0007816857 0.0022528832 0.004387553 -0.002184250 -0.0003546946 -0.0012663757    3    1\n4 0.006581281 0.002550333 -5.262806e-04 0.002946005 -0.002397629 0.0008525023 0.0016766696 0.003923651 -0.001830763 -0.0004357665 -0.0007943262    4    1\n5 0.006843073 0.003060905 -3.048751e-04 0.003098456 -0.002268415 0.0009230780 0.0011004229 0.003459854 -0.001477308 -0.0005168298 -0.0003221607    5    1\n6 0.007105849 0.003571608 -8.337284e-05 0.003250342 -0.002138492 0.0009931212 0.0005243531 0.002996226 -0.001123931 -0.0005980446  0.0001500939    6    1\n\n\n\n\n\nWe would like to visualize the trajectory of cells in our TSNE space, but the principal curve is only available in PCA space. We can use slingshot to embed it in the TSNE space!\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ntsne_curve &lt;- slingshot::embedCurves(germcells_slingshot, 'TSNE', smoother = 'loess', span = 0.1) |&gt; \n    slingshot::slingCurves(as.df = TRUE)\ntsne_curve &lt;- tsne_curve[order(tsne_curve$Order), ]\nhead(tsne_curve)\n\n\n                              TSNE1    TSNE2 Order Lineage\nDonor1-TTTATGCCATGACATC-1 -25.23033 11.72853     1       1\nDonor1-GAACATCGTTTCCACC-1 -25.23033 11.72853     2       1\nDonor1-GACCTGGCAGGGTATG-1 -25.23033 11.72853     3       1\nDonor1-GCACTCTTCCCAAGTA-1 -25.23033 11.72853     4       1\nDonor1-GCCAAATAGCGATAGC-1 -25.23033 11.72853     5       1\nDonor1-GGCTCGATCCTAGAAC-1 -25.23033 11.72853     6       1\n\n\n\n\n\nPlot PCA and tSNE embeddings, coloring cells by either their annotation or their pseudotime value. Overlay the principal curves to each embedding.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ndf &lt;- tibble(\n    PC1 = reducedDim(germcells, 'corrected')[,1], \n    PC2 = reducedDim(germcells, 'corrected')[,2], \n    TSNE1 = reducedDim(germcells, 'TSNE')[,1], \n    TSNE2 = reducedDim(germcells, 'TSNE')[,2], \n    annotation = germcells$annotation, \n    pseudotime = germcells$pseudotime\n)\ncowplot::plot_grid(\n    df |&gt; \n        ggplot() + \n        geom_point(aes(PC1, PC2, col = annotation)) + \n        geom_path(data = pca_curve, aes(x = PC1, y = PC2)) + \n        theme_bw() + \n        coord_fixed(),\n    df |&gt; \n        ggplot() + \n        geom_point(aes(TSNE1, TSNE2, col = annotation)) + \n        geom_path(data = tsne_curve, aes(x = TSNE1, y = TSNE2)) + \n        theme_bw() + \n        coord_fixed(),\n    df |&gt; \n        ggplot() + \n        geom_point(aes(PC1, PC2, col = pseudotime)) + \n        geom_path(data = pca_curve, aes(x = PC1, y = PC2)) + \n        theme_bw() + \n        coord_fixed(),\n    df |&gt; \n        ggplot() + \n        geom_point(aes(TSNE1, TSNE2, col = pseudotime)) + \n        geom_path(data = tsne_curve, aes(x = TSNE1, y = TSNE2)) + \n        theme_bw() + \n        coord_fixed()\n)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nCheck the distribution of pseudotime values across the different cell clusters.\nWhat do you observe? Where you expecting this?\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ntibble(\n    annotation = factor(germcells$annotation, c(\"Spermatogonia\", \"Spermatocytes\", \"Early spermatids\", \"Late spermatids\")), \n    pseudotime = germcells$pseudotime\n) |&gt; \n    ggplot(aes(x = annotation, y = pseudotime, fill = annotation)) + \n    geom_violin(scale = 'width') + \n    geom_boxplot(outlier.shape = NULL, width = 0.1, fill = 'white') + \n    theme_bw() + \n    theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1)) \n\n\n\n\n\n\n\n\n\n\n\nCorrect pseudotime values as you would expect it to be\n\n\n\nR\n\ngermcells$pseudotime &lt;- scales::rescale((-1 * slingshot::slingPseudotime(germcells_slingshot)[, 'Lineage1']), c(0, 1))\n\n\n\n\n\n15.2.3 BONUS: Daunting snippet but that makes a cool figure for a paper: modeling pseudotime-dependent gene expression\nUsing pseudotime / cell, one can model gene expression along the differentiation process. This alleviates the need to study gene expression per cell, and allows one to focus on process-related effects (e.g. gene expression during a developmental trajectory).\n\n\n\n\n\n\nQuestion\n\n\n\nTry to do so for few markers of spermatogonia, spermatocytes and spermatids.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\ngenes &lt;- c('ID4', 'SYCP3', 'DMC1', 'ACR', 'PRM1', 'PGK2')\nfitExprs &lt;- logcounts(germcells[genes, ]) |&gt; # ----------------------------------- Get norm. counts for genes of interest\n    as.matrix() |&gt; \n    t() |&gt; \n    as_tibble() |&gt; \n    mutate(  # ----------------------------------------------------------------- Add information for each cell\n        cellID = colnames(germcells), \n        annotation = factor(germcells$annotation, c(\"Spermatogonia\", \"Spermatocytes\", \"Early spermatids\", \"Late spermatids\")), \n        pseudotime = germcells$pseudotime\n    ) |&gt; \n    pivot_longer(contains(genes), names_to = 'gene', values_to = 'obs_expr') |&gt; # - Pivot in \"long\" tidy format \n    mutate(gene = factor(gene, genes)) |&gt; \n    group_by(gene) |&gt; # ------------------------------------------------------- Group rows by genes\n    nest(.key = 'data') |&gt; # -------------------------------------------------- For each gene, extract the subtable into a column named data\n    mutate(\n        gamModel = map(data, ~mgcv::gam(obs_expr ~ s(pseudotime, bs = \"cs\"), data = .)), \n        gamFitted_expr = map(gamModel, predict) # ------------------------------ For each gene, fit the expression values ~ pseudotime with a GAM\n    ) |&gt; \n    dplyr::select(-ends_with('Model')) |&gt; \n    unnest(c(data, ends_with('_expr'))) # -------------------------------------- Unnest all the modelled expressions\nggplot(fitExprs) + \n    geom_point(aes(x = pseudotime, y = obs_expr, col = annotation), alpha = 0.5) + \n    geom_line(aes(x = pseudotime, y = gamFitted_expr), col = 'white', size = 2, alpha = 0.5) + \n    geom_line(aes(x = pseudotime, y = gamFitted_expr), col = '#af2d0c', size = 1) +\n    theme_bw() + \n    facet_grid(gene~., scales = 'free') + \n    labs(y = 'logcounts') + \n    ggtitle('Fitted models of pseudotime-dependent gene expression')\n\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.",
    "crumbs": [
      "Day 4",
      "<span class='chapter-number'>15</span>  <span class='chapter-title'>Lab 8: Pseudotime analyses</span>"
    ]
  },
  {
    "objectID": "content/day4/Lab8_pseudotime.html#ordering-trajectory-with-rna-velocity",
    "href": "content/day4/Lab8_pseudotime.html#ordering-trajectory-with-rna-velocity",
    "title": "\n15  Lab 8: Pseudotime analyses\n",
    "section": "\n15.3 Ordering trajectory with RNA velocity",
    "text": "15.3 Ordering trajectory with RNA velocity\nAs we saw earlier, TI does not necessarily know which direction is right for a given trajectory. This orientation can be sometimes refined using RNA velocity. Let’s see whether RNA velocity helps orientating our spermatocyte differentiation lineage trajectory here.\n\n\n\n\n\n\nQuestion\n\n\n\n\nRead velociraptor documentation. What do you need to compute RNA velocity scores in R?\nImport spliced and unspliced counts computed with velocyto in R.\nTry and compute RNA velocity.\n\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\n\n\nR\n\n## - Import entire GSE112013 dataset with spliced/unspliced counts \nfull_GSE112013_counts &lt;- LoomExperiment::import('~/Share/Guo_testis/Guo_testis_full-counts.loom')\nfull_GSE112013_counts\n\n## - Filter `germcells` genes and cells to only retain those present in `full_GSE112013_counts`\ngermcells &lt;- germcells[\n    rowData(germcells)$gene_id %in% rowData(full_GSE112013_counts)$Accession, \n    germcells$Barcode %in% full_GSE112013_counts$Barcode\n]\n\n## - Reorder rows of `full_GSE112013_counts_germcells` to match those of `germcells`\nfull_GSE112013_counts_germcells &lt;- full_GSE112013_counts[match(rowData(germcells)$gene_id, rowData(full_GSE112013_counts)$Accession), match(germcells$Barcode, full_GSE112013_counts$Barcode)]\ndim(germcells)\ndim(full_GSE112013_counts_germcells)\n\n## - Add spliced/unspliced counts to germcells\nassay(germcells, 'spliced', withDimnames=FALSE) &lt;- as(assay(full_GSE112013_counts_germcells, 'spliced'), 'dgCMatrix')\nassay(germcells, 'unspliced', withDimnames=FALSE) &lt;- as(assay(full_GSE112013_counts_germcells, 'unspliced'), 'dgCMatrix')\ngermcells\n\n## - Run velociraptor\nvelo_out &lt;- velociraptor::scvelo(\n    germcells, \n    assay.X = \"counts\", \n    subset.row = rowData(germcells)$isHVG, \n    use.dimred = \"corrected\"\n)\nvelo_out\n\n\n\n\n\n\n\n\nEmbed the velocity field in tSNE scRNAseq embedding and plot the RNA velocity field on top of tSNE projection. Conclude.\n\n\n\n\nR\n\nembedded_velo &lt;- velociraptor::embedVelocity(reducedDim(germcells, \"TSNE\"), velo_out)\nhead(embedded_velo)\ngrid_df &lt;- velociraptor::gridVectors(reducedDim(germcells, \"TSNE\"), embedded_velo, resolution = 30, scale = TRUE)\nhead(grid_df)\nscater::plotReducedDim(germcells, 'TSNE', colour_by = \"annotation\", point_alpha = 0.5) +\n    geom_segment(\n        data = grid_df, \n        mapping = aes(x = start.1, y = start.2, xend = end.1, yend = end.2), \n        arrow = arrow(length = unit(0.05, \"inches\"), type = \"closed\")\n    )",
    "crumbs": [
      "Day 4",
      "<span class='chapter-number'>15</span>  <span class='chapter-title'>Lab 8: Pseudotime analyses</span>"
    ]
  },
  {
    "objectID": "content/day4/Lab8_pseudotime.html#session-info",
    "href": "content/day4/Lab8_pseudotime.html#session-info",
    "title": "\n15  Lab 8: Pseudotime analyses\n",
    "section": "\n15.4 Session info",
    "text": "15.4 Session info\n\n\n─ Session info ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.5.1 (2025-06-13)\n os       Ubuntu 24.04.2 LTS\n system   x86_64, linux-gnu\n ui       X11\n language (EN)\n collate  en_IN.utf8\n ctype    en_IN.utf8\n tz       Europe/Paris\n date     2025-11-15\n pandoc   3.1.3 @ /usr/bin/ (via rmarkdown)\n quarto   1.5.55 @ /opt/quarto/bin/quarto\n\n─ Packages ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n package              * version date (UTC) lib source\n abind                  1.4-8   2024-09-12 [1] CRAN (R 4.5.1)\n beachmat               2.26.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n beeswarm               0.4.0   2021-06-01 [1] CRAN (R 4.5.1)\n Biobase              * 2.70.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocGenerics         * 0.56.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocNeighbors          2.4.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocParallel           1.44.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n BiocSingular           1.26.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n bit                    4.6.0   2025-03-06 [1] CRAN (R 4.5.0)\n bit64                  4.6.0-1 2025-01-16 [1] CRAN (R 4.5.0)\n cachem                 1.1.0   2024-05-16 [1] CRAN (R 4.5.1)\n cli                    3.6.5   2025-04-23 [1] CRAN (R 4.5.1)\n codetools              0.2-20  2024-03-31 [2] CRAN (R 4.5.1)\n cowplot                1.2.0   2025-07-07 [1] CRAN (R 4.5.1)\n crayon                 1.5.3   2024-06-20 [1] CRAN (R 4.5.1)\n DelayedArray           0.36.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n DelayedMatrixStats     1.32.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n devtools               2.4.6   2025-10-03 [1] CRAN (R 4.5.1)\n dichromat              2.0-0.1 2022-05-02 [1] CRAN (R 4.5.1)\n digest                 0.6.38  2025-11-12 [1] CRAN (R 4.5.1)\n dplyr                * 1.1.4   2023-11-17 [1] CRAN (R 4.5.1)\n ellipsis               0.3.2   2021-04-29 [1] CRAN (R 4.5.1)\n evaluate               1.0.5   2025-08-27 [1] CRAN (R 4.5.1)\n farver                 2.1.2   2024-05-13 [1] CRAN (R 4.5.1)\n fastmap                1.2.0   2024-05-15 [1] CRAN (R 4.5.1)\n forcats              * 1.0.1   2025-09-25 [1] CRAN (R 4.5.1)\n fs                     1.6.6   2025-04-12 [1] CRAN (R 4.5.1)\n generics             * 0.1.4   2025-05-09 [1] CRAN (R 4.5.1)\n GenomicRanges        * 1.62.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n ggbeeswarm             0.7.2   2023-04-29 [1] CRAN (R 4.5.1)\n ggplot2              * 4.0.1   2025-11-14 [1] CRAN (R 4.5.1)\n ggrepel                0.9.6   2024-09-07 [1] CRAN (R 4.5.1)\n glue                   1.8.0   2024-09-30 [1] CRAN (R 4.5.1)\n gridExtra              2.3     2017-09-09 [1] CRAN (R 4.5.1)\n gtable                 0.3.6   2024-10-25 [1] CRAN (R 4.5.1)\n hms                    1.1.4   2025-10-17 [1] CRAN (R 4.5.1)\n htmltools              0.5.8.1 2024-04-04 [1] CRAN (R 4.5.1)\n htmlwidgets            1.6.4   2023-12-06 [1] CRAN (R 4.5.1)\n igraph                 2.2.1   2025-10-27 [1] CRAN (R 4.5.1)\n IRanges              * 2.44.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n irlba                  2.3.5.1 2022-10-03 [1] CRAN (R 4.5.1)\n jsonlite               2.0.0   2025-03-27 [1] CRAN (R 4.5.1)\n knitr                  1.50    2025-03-16 [1] CRAN (R 4.5.1)\n labeling               0.4.3   2023-08-29 [1] CRAN (R 4.5.1)\n lattice                0.22-7  2025-04-02 [2] CRAN (R 4.5.1)\n lifecycle              1.0.4   2023-11-07 [1] CRAN (R 4.5.1)\n lubridate            * 1.9.4   2024-12-08 [1] CRAN (R 4.5.0)\n magrittr               2.0.4   2025-09-12 [1] CRAN (R 4.5.1)\n Matrix                 1.7-3   2025-03-11 [1] CRAN (R 4.5.1)\n MatrixGenerics       * 1.22.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n matrixStats          * 1.5.0   2025-01-07 [1] CRAN (R 4.5.0)\n memoise                2.0.1   2021-11-26 [1] CRAN (R 4.5.1)\n mgcv                   1.9-3   2025-04-04 [2] CRAN (R 4.5.1)\n nlme                   3.1-168 2025-03-31 [2] CRAN (R 4.5.1)\n pillar                 1.11.1  2025-09-17 [1] CRAN (R 4.5.1)\n pkgbuild               1.4.8   2025-05-26 [1] CRAN (R 4.5.1)\n pkgconfig              2.0.3   2019-09-22 [1] CRAN (R 4.5.1)\n pkgload                1.4.1   2025-09-23 [1] CRAN (R 4.5.1)\n princurve              2.1.6   2021-01-18 [1] CRAN (R 4.5.1)\n purrr                * 1.2.0   2025-11-04 [1] CRAN (R 4.5.1)\n R6                     2.6.1   2025-02-15 [1] CRAN (R 4.5.0)\n RColorBrewer           1.1-3   2022-04-03 [1] CRAN (R 4.5.1)\n Rcpp                   1.1.0   2025-07-02 [1] CRAN (R 4.5.1)\n readr                * 2.1.5   2024-01-10 [1] CRAN (R 4.5.1)\n remotes                2.5.0   2024-03-17 [1] CRAN (R 4.5.1)\n rlang                  1.1.6   2025-04-11 [1] CRAN (R 4.5.1)\n rmarkdown              2.30    2025-09-28 [1] CRAN (R 4.5.1)\n rsvd                   1.0.5   2021-04-16 [1] CRAN (R 4.5.1)\n S4Arrays               1.10.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n S4Vectors            * 0.48.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n S7                     0.2.0   2024-11-07 [1] CRAN (R 4.5.1)\n ScaledMatrix           1.18.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n scales                 1.4.0   2025-04-24 [1] CRAN (R 4.5.1)\n scater                 1.38.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n scrapper               1.4.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n scuttle                1.20.0  2025-10-30 [1] Bioconductor 3.22 (R 4.5.1)\n Seqinfo              * 1.0.0   2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n sessioninfo            1.2.3   2025-02-05 [1] CRAN (R 4.5.0)\n SingleCellExperiment * 1.32.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n SingleR                2.12.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n slingshot              2.18.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n SparseArray            1.10.1  2025-10-31 [1] Bioconductor 3.22 (R 4.5.1)\n sparseMatrixStats      1.22.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n stringi                1.8.7   2025-03-27 [1] CRAN (R 4.5.1)\n stringr              * 1.6.0   2025-11-04 [1] CRAN (R 4.5.1)\n SummarizedExperiment * 1.40.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n tibble               * 3.3.0   2025-06-08 [1] CRAN (R 4.5.1)\n tidyr                * 1.3.1   2024-01-24 [1] CRAN (R 4.5.1)\n tidyselect             1.2.1   2024-03-11 [1] CRAN (R 4.5.1)\n tidyverse            * 2.0.0   2023-02-22 [1] CRAN (R 4.5.1)\n timechange             0.3.0   2024-01-18 [1] CRAN (R 4.5.1)\n TrajectoryUtils        1.18.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n tzdb                   0.5.0   2025-03-15 [1] CRAN (R 4.5.1)\n usethis                3.2.1   2025-09-06 [1] CRAN (R 4.5.1)\n vctrs                  0.6.5   2023-12-01 [1] CRAN (R 4.5.1)\n vipor                  0.4.7   2023-12-18 [1] CRAN (R 4.5.1)\n viridis                0.6.5   2024-01-29 [1] CRAN (R 4.5.1)\n viridisLite            0.4.2   2023-05-02 [1] CRAN (R 4.5.1)\n vroom                  1.6.6   2025-09-19 [1] CRAN (R 4.5.1)\n withr                  3.0.2   2024-10-28 [1] CRAN (R 4.5.1)\n xfun                   0.54    2025-10-30 [1] CRAN (R 4.5.1)\n XVector                0.50.0  2025-10-29 [1] Bioconductor 3.22 (R 4.5.1)\n\n [1] /home/rsg/R/x86_64-pc-linux-gnu-library/4.5\n [2] /opt/R/4.5.1/lib/R/library\n * ── Packages attached to the search path.\n\n──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────",
    "crumbs": [
      "Day 4",
      "<span class='chapter-number'>15</span>  <span class='chapter-title'>Lab 8: Pseudotime analyses</span>"
    ]
  },
  {
    "objectID": "content/extra.html",
    "href": "content/extra.html",
    "title": "Extra resources",
    "section": "",
    "text": "General bioinformatics",
    "crumbs": [
      "Extra resources"
    ]
  },
  {
    "objectID": "content/extra.html#general-bioinformatics",
    "href": "content/extra.html#general-bioinformatics",
    "title": "Extra resources",
    "section": "",
    "text": "A comprehensive overview of the different types of bioinformatic analyses, divided in 4 fundamental modules: LINK",
    "crumbs": [
      "Extra resources"
    ]
  },
  {
    "objectID": "content/extra.html#rbioconductor",
    "href": "content/extra.html#rbioconductor",
    "title": "Extra resources",
    "section": "R/Bioconductor",
    "text": "R/Bioconductor\n\nThe excellent R guide for beginners, by Emmanuel Paradis: PDF\nThe 150+ pages comprehensive book to learn everything about Bioconductor. This ebook has been published by Kasper D. Hansen and is freely available under the CC BY-NC-SA 4.0 license: Link to EPUB",
    "crumbs": [
      "Extra resources"
    ]
  },
  {
    "objectID": "content/extra.html#scientific-readings",
    "href": "content/extra.html#scientific-readings",
    "title": "Extra resources",
    "section": "Scientific readings",
    "text": "Scientific readings\n\n2014 Nat. Methods paper from Bioconductor core team describing important object classes\nTo see from how far Bioc comes from...",
    "crumbs": [
      "Extra resources"
    ]
  }
]